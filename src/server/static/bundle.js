var ProteinViewer=function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e,n){var r,i,o;i=[],void 0===(o="function"==typeof(r=function(){var t,e,n,r,i,o,s,a,u,h,c,l,f,d,_,v,m,b,p,g,y,A,w,S,C,E,R,x,T,M,F,N,I,D,P,V,L,O,k,B,q;return t=function(){var t={};if(!e)var e=1e-6;if(!n)var n="undefined"!=typeof Float32Array?Float32Array:Array;if(!r)var r=Math.random;var i={setMatrixArrayType:function(t){n=t}};t.glMatrix=i;var o={create:function(){var t=new n(3);return t[0]=0,t[1]=0,t[2]=0,t},clone:function(t){var e=new n(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},fromValues:function(t,e,r){var i=new n(3);return i[0]=t,i[1]=e,i[2]=r,i},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},set:function(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},subtract:function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}};o.sub=o.subtract,o.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t},o.mul=o.multiply,o.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},o.div=o.divide,o.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},o.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},o.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},o.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t},o.distance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+r*r+i*i)},o.dist=o.distance,o.squaredDistance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i},o.sqrDist=o.squaredDistance,o.length=function(t){var e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)},o.len=o.length,o.squaredLength=function(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r},o.sqrLen=o.squaredLength,o.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},o.normalize=function(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t},o.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},o.cross=function(t,e,n){var r=e[0],i=e[1],o=e[2],s=n[0],a=n[1],u=n[2];return t[0]=i*u-o*a,t[1]=o*s-r*u,t[2]=r*a-i*s,t},o.lerp=function(t,e,n,r){var i=e[0],o=e[1],s=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=s+r*(n[2]-s),t},o.random=function(t,e){e=e||1;var n=2*r()*Math.PI,i=2*r()-1,o=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(n)*o,t[1]=Math.sin(n)*o,t[2]=i*e,t},o.transformMat4=function(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12],t[1]=n[1]*r+n[5]*i+n[9]*o+n[13],t[2]=n[2]*r+n[6]*i+n[10]*o+n[14],t},o.transformMat3=function(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t},o.transformQuat=function(t,e,n){var r=e[0],i=e[1],o=e[2],s=n[0],a=n[1],u=n[2],h=n[3],c=h*r+a*o-u*i,l=h*i+u*r-s*o,f=h*o+s*i-a*r,d=-s*r-a*i-u*o;return t[0]=c*h+d*-s+l*-u-f*-a,t[1]=l*h+d*-a+f*-s-c*-u,t[2]=f*h+d*-u+c*-a-l*-s,t},o.forEach=function(){var t=o.create();return function(e,n,r,i,o,s){var a,u;for(n||(n=3),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,a=r;u>a;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],o(t,t,s),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}}(),o.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},t.vec3=o;var s={create:function(){var t=new n(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},clone:function(t){var e=new n(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},fromValues:function(t,e,r,i){var o=new n(4);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},set:function(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},subtract:function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}};s.sub=s.subtract,s.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t},s.mul=s.multiply,s.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t},s.div=s.divide,s.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},s.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},s.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},s.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t},s.distance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(n*n+r*r+i*i+o*o)},s.dist=s.distance,s.squaredDistance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return n*n+r*r+i*i+o*o},s.sqrDist=s.squaredDistance,s.length=function(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.sqrt(e*e+n*n+r*r+i*i)},s.len=s.length,s.squaredLength=function(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i},s.sqrLen=s.squaredLength,s.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},s.normalize=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=n*n+r*r+i*i+o*o;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s),t},s.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},s.lerp=function(t,e,n,r){var i=e[0],o=e[1],s=e[2],a=e[3];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=s+r*(n[2]-s),t[3]=a+r*(n[3]-a),t},s.random=function(t,e){return e=e||1,t[0]=r(),t[1]=r(),t[2]=r(),t[3]=r(),s.normalize(t,t),s.scale(t,t,e),t},s.transformMat4=function(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*s,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*s,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*s,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*s,t},s.transformQuat=function(t,e,n){var r=e[0],i=e[1],o=e[2],s=n[0],a=n[1],u=n[2],h=n[3],c=h*r+a*o-u*i,l=h*i+u*r-s*o,f=h*o+s*i-a*r,d=-s*r-a*i-u*o;return t[0]=c*h+d*-s+l*-u-f*-a,t[1]=l*h+d*-a+f*-s-c*-u,t[2]=f*h+d*-u+c*-a-l*-s,t},s.forEach=function(){var t=s.create();return function(e,n,r,i,o,s){var a,u;for(n||(n=4),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,a=r;u>a;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],o(t,t,s),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}(),s.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t.vec4=s;var a={create:function(){var t=new n(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromMat4:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},clone:function(t){var e=new n(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},transpose:function(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},invert:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],h=e[7],c=e[8],l=c*s-a*h,f=-c*o+a*u,d=h*o-s*u,_=n*l+r*f+i*d;return _?(_=1/_,t[0]=l*_,t[1]=(-c*r+i*h)*_,t[2]=(a*r-i*s)*_,t[3]=f*_,t[4]=(c*n-i*u)*_,t[5]=(-a*n+i*o)*_,t[6]=d*_,t[7]=(-h*n+r*u)*_,t[8]=(s*n-r*o)*_,t):null},adjoint:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],h=e[7],c=e[8];return t[0]=s*c-a*h,t[1]=i*h-r*c,t[2]=r*a-i*s,t[3]=a*u-o*c,t[4]=n*c-i*u,t[5]=i*o-n*a,t[6]=o*h-s*u,t[7]=r*u-n*h,t[8]=n*s-r*o,t},determinant:function(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],a=t[6],u=t[7],h=t[8];return e*(h*o-s*u)+n*(-h*i+s*a)+r*(u*i-o*a)},multiply:function(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=n[0],d=n[1],_=n[2],v=n[3],m=n[4],b=n[5],p=n[6],g=n[7],y=n[8];return t[0]=f*r+d*s+_*h,t[1]=f*i+d*a+_*c,t[2]=f*o+d*u+_*l,t[3]=v*r+m*s+b*h,t[4]=v*i+m*a+b*c,t[5]=v*o+m*u+b*l,t[6]=p*r+g*s+y*h,t[7]=p*i+g*a+y*c,t[8]=p*o+g*u+y*l,t}};a.mul=a.multiply,a.translate=function(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=n[0],d=n[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=s,t[4]=a,t[5]=u,t[6]=f*r+d*s+h,t[7]=f*i+d*a+c,t[8]=f*o+d*u+l,t},a.rotate=function(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=Math.sin(n),d=Math.cos(n);return t[0]=d*r+f*s,t[1]=d*i+f*a,t[2]=d*o+f*u,t[3]=d*s-f*r,t[4]=d*a-f*i,t[5]=d*u-f*o,t[6]=h,t[7]=c,t[8]=l,t},a.fromQuat=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=n+n,a=r+r,u=i+i,h=n*s,c=n*a,l=n*u,f=r*a,d=r*u,_=i*u,v=o*s,m=o*a,b=o*u;return t[0]=1-(f+_),t[3]=c+b,t[6]=l-m,t[1]=c-b,t[4]=1-(h+_),t[7]=d+v,t[2]=l+m,t[5]=d-v,t[8]=1-(h+f),t},a.normalFromMat4=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],h=e[7],c=e[8],l=e[9],f=e[10],d=e[11],_=e[12],v=e[13],m=e[14],b=e[15],p=n*a-r*s,g=n*u-i*s,y=n*h-o*s,A=r*u-i*a,w=r*h-o*a,S=i*h-o*u,C=c*v-l*_,E=c*m-f*_,R=c*b-d*_,x=l*m-f*v,T=l*b-d*v,M=f*b-d*m,F=p*M-g*T+y*x+A*R-w*E+S*C;return F?(F=1/F,t[0]=(a*M-u*T+h*x)*F,t[1]=(u*R-s*M-h*E)*F,t[2]=(s*T-a*R+h*C)*F,t[3]=(i*T-r*M-o*x)*F,t[4]=(n*M-i*R+o*E)*F,t[5]=(r*R-n*T-o*C)*F,t[6]=(v*S-m*w+b*A)*F,t[7]=(m*y-_*S-b*g)*F,t[8]=(_*w-v*y+b*p)*F,t):null},a.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},t.mat3=a;var u={create:function(){var t=new n(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromValues:function(t,e,r,i,o,s,a,u,h,c,l,f,d,_,v,m){var b=new n(16);return b[0]=t,b[1]=e,b[2]=r,b[3]=i,b[4]=o,b[5]=s,b[6]=a,b[7]=u,b[8]=h,b[9]=c,b[10]=l,b[11]=f,b[12]=d,b[13]=_,b[14]=v,b[15]=m,b},clone:function(t){var e=new n(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},transpose:function(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],s=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=s,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},invert:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],h=e[7],c=e[8],l=e[9],f=e[10],d=e[11],_=e[12],v=e[13],m=e[14],b=e[15],p=n*a-r*s,g=n*u-i*s,y=n*h-o*s,A=r*u-i*a,w=r*h-o*a,S=i*h-o*u,C=c*v-l*_,E=c*m-f*_,R=c*b-d*_,x=l*m-f*v,T=l*b-d*v,M=f*b-d*m,F=p*M-g*T+y*x+A*R-w*E+S*C;return F?(F=1/F,t[0]=(a*M-u*T+h*x)*F,t[1]=(i*T-r*M-o*x)*F,t[2]=(v*S-m*w+b*A)*F,t[3]=(f*w-l*S-d*A)*F,t[4]=(u*R-s*M-h*E)*F,t[5]=(n*M-i*R+o*E)*F,t[6]=(m*y-_*S-b*g)*F,t[7]=(c*S-f*y+d*g)*F,t[8]=(s*T-a*R+h*C)*F,t[9]=(r*R-n*T-o*C)*F,t[10]=(_*w-v*y+b*p)*F,t[11]=(l*y-c*w-d*p)*F,t[12]=(a*E-s*x-u*C)*F,t[13]=(n*x-r*E+i*C)*F,t[14]=(v*g-_*A-m*p)*F,t[15]=(c*A-l*g+f*p)*F,t):null},adjoint:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],h=e[7],c=e[8],l=e[9],f=e[10],d=e[11],_=e[12],v=e[13],m=e[14],b=e[15];return t[0]=a*(f*b-d*m)-l*(u*b-h*m)+v*(u*d-h*f),t[1]=-(r*(f*b-d*m)-l*(i*b-o*m)+v*(i*d-o*f)),t[2]=r*(u*b-h*m)-a*(i*b-o*m)+v*(i*h-o*u),t[3]=-(r*(u*d-h*f)-a*(i*d-o*f)+l*(i*h-o*u)),t[4]=-(s*(f*b-d*m)-c*(u*b-h*m)+_*(u*d-h*f)),t[5]=n*(f*b-d*m)-c*(i*b-o*m)+_*(i*d-o*f),t[6]=-(n*(u*b-h*m)-s*(i*b-o*m)+_*(i*h-o*u)),t[7]=n*(u*d-h*f)-s*(i*d-o*f)+c*(i*h-o*u),t[8]=s*(l*b-d*v)-c*(a*b-h*v)+_*(a*d-h*l),t[9]=-(n*(l*b-d*v)-c*(r*b-o*v)+_*(r*d-o*l)),t[10]=n*(a*b-h*v)-s*(r*b-o*v)+_*(r*h-o*a),t[11]=-(n*(a*d-h*l)-s*(r*d-o*l)+c*(r*h-o*a)),t[12]=-(s*(l*m-f*v)-c*(a*m-u*v)+_*(a*f-u*l)),t[13]=n*(l*m-f*v)-c*(r*m-i*v)+_*(r*f-i*l),t[14]=-(n*(a*m-u*v)-s*(r*m-i*v)+_*(r*u-i*a)),t[15]=n*(a*f-u*l)-s*(r*f-i*l)+c*(r*u-i*a),t},determinant:function(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],a=t[6],u=t[7],h=t[8],c=t[9],l=t[10],f=t[11],d=t[12],_=t[13],v=t[14],m=t[15],b=e*s-n*o,p=e*a-r*o,g=e*u-i*o,y=n*a-r*s,A=n*u-i*s,w=r*u-i*a,S=h*_-c*d,C=h*v-l*d,E=h*m-f*d,R=c*v-l*_,x=c*m-f*_,T=l*m-f*v;return b*T-p*x+g*R+y*E-A*C+w*S},multiply:function(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=e[9],d=e[10],_=e[11],v=e[12],m=e[13],b=e[14],p=e[15],g=n[0],y=n[1],A=n[2],w=n[3];return t[0]=g*r+y*a+A*l+w*v,t[1]=g*i+y*u+A*f+w*m,t[2]=g*o+y*h+A*d+w*b,t[3]=g*s+y*c+A*_+w*p,g=n[4],y=n[5],A=n[6],w=n[7],t[4]=g*r+y*a+A*l+w*v,t[5]=g*i+y*u+A*f+w*m,t[6]=g*o+y*h+A*d+w*b,t[7]=g*s+y*c+A*_+w*p,g=n[8],y=n[9],A=n[10],w=n[11],t[8]=g*r+y*a+A*l+w*v,t[9]=g*i+y*u+A*f+w*m,t[10]=g*o+y*h+A*d+w*b,t[11]=g*s+y*c+A*_+w*p,g=n[12],y=n[13],A=n[14],w=n[15],t[12]=g*r+y*a+A*l+w*v,t[13]=g*i+y*u+A*f+w*m,t[14]=g*o+y*h+A*d+w*b,t[15]=g*s+y*c+A*_+w*p,t},fromMat3:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t[4]=e[3],t[5]=e[4],t[6]=e[5],t[7]=0,t[8]=e[6],t[9]=e[7],t[10]=e[8],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}};u.mul=u.multiply,u.translate=function(t,e,n){var r,i,o,s,a,u,h,c,l,f,d,_,v=n[0],m=n[1],b=n[2];return e===t?(t[12]=e[0]*v+e[4]*m+e[8]*b+e[12],t[13]=e[1]*v+e[5]*m+e[9]*b+e[13],t[14]=e[2]*v+e[6]*m+e[10]*b+e[14],t[15]=e[3]*v+e[7]*m+e[11]*b+e[15]):(r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=e[9],d=e[10],_=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=s,t[4]=a,t[5]=u,t[6]=h,t[7]=c,t[8]=l,t[9]=f,t[10]=d,t[11]=_,t[12]=r*v+a*m+l*b+e[12],t[13]=i*v+u*m+f*b+e[13],t[14]=o*v+h*m+d*b+e[14],t[15]=s*v+c*m+_*b+e[15]),t},u.scale=function(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},u.rotate=function(t,n,r,i){var o,s,a,u,h,c,l,f,d,_,v,m,b,p,g,y,A,w,S,C,E,R,x,T,M=i[0],F=i[1],N=i[2],I=Math.sqrt(M*M+F*F+N*N);return Math.abs(I)<e?null:(M*=I=1/I,F*=I,N*=I,o=Math.sin(r),s=Math.cos(r),a=1-s,u=n[0],h=n[1],c=n[2],l=n[3],f=n[4],d=n[5],_=n[6],v=n[7],m=n[8],b=n[9],p=n[10],g=n[11],y=M*M*a+s,A=F*M*a+N*o,w=N*M*a-F*o,S=M*F*a-N*o,C=F*F*a+s,E=N*F*a+M*o,R=M*N*a+F*o,x=F*N*a-M*o,T=N*N*a+s,t[0]=u*y+f*A+m*w,t[1]=h*y+d*A+b*w,t[2]=c*y+_*A+p*w,t[3]=l*y+v*A+g*w,t[4]=u*S+f*C+m*E,t[5]=h*S+d*C+b*E,t[6]=c*S+_*C+p*E,t[7]=l*S+v*C+g*E,t[8]=u*R+f*x+m*T,t[9]=h*R+d*x+b*T,t[10]=c*R+_*x+p*T,t[11]=l*R+v*x+g*T,n!==t&&(t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t)},u.rotateX=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],s=e[5],a=e[6],u=e[7],h=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+h*r,t[5]=s*i+c*r,t[6]=a*i+l*r,t[7]=u*i+f*r,t[8]=h*i-o*r,t[9]=c*i-s*r,t[10]=l*i-a*r,t[11]=f*i-u*r,t},u.rotateY=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],s=e[1],a=e[2],u=e[3],h=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-h*r,t[1]=s*i-c*r,t[2]=a*i-l*r,t[3]=u*i-f*r,t[8]=o*r+h*i,t[9]=s*r+c*i,t[10]=a*r+l*i,t[11]=u*r+f*i,t},u.rotateZ=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],s=e[1],a=e[2],u=e[3],h=e[4],c=e[5],l=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+h*r,t[1]=s*i+c*r,t[2]=a*i+l*r,t[3]=u*i+f*r,t[4]=h*i-o*r,t[5]=c*i-s*r,t[6]=l*i-a*r,t[7]=f*i-u*r,t},u.fromRotationTranslation=function(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=r+r,u=i+i,h=o+o,c=r*a,l=r*u,f=r*h,d=i*u,_=i*h,v=o*h,m=s*a,b=s*u,p=s*h;return t[0]=1-(d+v),t[1]=l+p,t[2]=f-b,t[3]=0,t[4]=l-p,t[5]=1-(c+v),t[6]=_+m,t[7]=0,t[8]=f+b,t[9]=_-m,t[10]=1-(c+d),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},u.fromQuat=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=n+n,a=r+r,u=i+i,h=n*s,c=n*a,l=n*u,f=r*a,d=r*u,_=i*u,v=o*s,m=o*a,b=o*u;return t[0]=1-(f+_),t[1]=c+b,t[2]=l-m,t[3]=0,t[4]=c-b,t[5]=1-(h+_),t[6]=d+v,t[7]=0,t[8]=l+m,t[9]=d-v,t[10]=1-(h+f),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},u.frustum=function(t,e,n,r,i,o,s){var a=1/(n-e),u=1/(i-r),h=1/(o-s);return t[0]=2*o*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(i+r)*u,t[10]=(s+o)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*o*2*h,t[15]=0,t},u.perspective=function(t,e,n,r,i){var o=1/Math.tan(e/2),s=1/(r-i);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+r)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*r*s,t[15]=0,t},u.ortho=function(t,e,n,r,i,o,s){var a=1/(e-n),u=1/(r-i),h=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*u,t[14]=(s+o)*h,t[15]=1,t},u.lookAt=function(t,n,r,i){var o,s,a,h,c,l,f,d,_,v,m=n[0],b=n[1],p=n[2],g=i[0],y=i[1],A=i[2],w=r[0],S=r[1],C=r[2];return Math.abs(m-w)<e&&Math.abs(b-S)<e&&Math.abs(p-C)<e?u.identity(t):(f=m-w,d=b-S,_=p-C,v=1/Math.sqrt(f*f+d*d+_*_),o=y*(_*=v)-A*(d*=v),s=A*(f*=v)-g*_,a=g*d-y*f,(v=Math.sqrt(o*o+s*s+a*a))?(o*=v=1/v,s*=v,a*=v):(o=0,s=0,a=0),h=d*a-_*s,c=_*o-f*a,l=f*s-d*o,(v=Math.sqrt(h*h+c*c+l*l))?(h*=v=1/v,c*=v,l*=v):(h=0,c=0,l=0),t[0]=o,t[1]=h,t[2]=f,t[3]=0,t[4]=s,t[5]=c,t[6]=d,t[7]=0,t[8]=a,t[9]=l,t[10]=_,t[11]=0,t[12]=-(o*m+s*b+a*p),t[13]=-(h*m+c*b+l*p),t[14]=-(f*m+d*b+_*p),t[15]=1,t)},u.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},t.mat4=u;var h={create:function(){var t=new n(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}};return h.rotationTo=function(){var t=o.create(),e=o.fromValues(1,0,0),n=o.fromValues(0,1,0);return function(r,i,s){var a=o.dot(i,s);return-.999999>a?(o.cross(t,e,i),o.length(t)<1e-6&&o.cross(t,n,i),o.normalize(t,t),h.setAxisAngle(r,t,Math.PI),r):a>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(o.cross(t,i,s),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+a,h.normalize(r,r))}}(),h.setAxes=function(){var t=a.create();return function(e,n,r,i){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=n[0],t[5]=n[1],t[8]=n[2],h.normalize(e,h.fromMat3(e,t))}}(),h.clone=s.clone,h.fromValues=s.fromValues,h.copy=s.copy,h.set=s.set,h.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},h.setAxisAngle=function(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t},h.add=s.add,h.multiply=function(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=n[0],u=n[1],h=n[2],c=n[3];return t[0]=r*c+s*a+i*h-o*u,t[1]=i*c+s*u+o*a-r*h,t[2]=o*c+s*h+r*u-i*a,t[3]=s*c-r*a-i*u-o*h,t},h.mul=h.multiply,h.scale=s.scale,h.rotateX=function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(n),u=Math.cos(n);return t[0]=r*u+s*a,t[1]=i*u+o*a,t[2]=o*u-i*a,t[3]=s*u-r*a,t},h.rotateY=function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(n),u=Math.cos(n);return t[0]=r*u-o*a,t[1]=i*u+s*a,t[2]=o*u+r*a,t[3]=s*u-i*a,t},h.rotateZ=function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(n),u=Math.cos(n);return t[0]=r*u+i*a,t[1]=i*u-r*a,t[2]=o*u+s*a,t[3]=s*u-o*a,t},h.calculateW=function(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=-Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t},h.dot=s.dot,h.lerp=s.lerp,h.slerp=function(t,e,n,r){var i,o,s,a,u,h=e[0],c=e[1],l=e[2],f=e[3],d=n[0],_=n[1],v=n[2],m=n[3];return 0>(o=h*d+c*_+l*v+f*m)&&(o=-o,d=-d,_=-_,v=-v,m=-m),1-o>1e-6?(i=Math.acos(o),s=Math.sin(i),a=Math.sin((1-r)*i)/s,u=Math.sin(r*i)/s):(a=1-r,u=r),t[0]=a*h+u*d,t[1]=a*c+u*_,t[2]=a*l+u*v,t[3]=a*f+u*m,t},h.invert=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=n*n+r*r+i*i+o*o,a=s?1/s:0;return t[0]=-n*a,t[1]=-r*a,t[2]=-i*a,t[3]=o*a,t},h.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},h.length=s.length,h.len=h.length,h.squaredLength=s.squaredLength,h.sqrLen=h.squaredLength,h.normalize=s.normalize,h.fromMat3=function(){var t="undefined"!=typeof Int8Array?new Int8Array([1,2,0]):[1,2,0];return function(e,n){var r,i=n[0]+n[4]+n[8];if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(n[7]-n[5])*r,e[1]=(n[2]-n[6])*r,e[2]=(n[3]-n[1])*r;else{var o=0;n[4]>n[0]&&(o=1),n[8]>n[3*o+o]&&(o=2);var s=t[o],a=t[s];r=Math.sqrt(n[3*o+o]-n[3*s+s]-n[3*a+a]+1),e[o]=.5*r,r=.5/r,e[3]=(n[3*a+s]-n[3*s+a])*r,e[s]=(n[3*s+o]+n[3*o+s])*r,e[a]=(n[3*a+o]+n[3*o+a])*r}return e}}(),h.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t.quat=h,t}(),e=function(){function e(t,e){this._6=t;for(var n=0;n<this._6.length;++n)this._6[n]=o.forceRGB(this._6[n]);this._Q=e}function n(t,e,n){this.colorFor=t,this._dw=e,this._do=n}function r(t,e,r,i,o){return e||(e=h("rainbow")),new n(function(n,r,i){var s=0;this._y!==this._A&&(s=(o(n).prop(t)-this._y)/(this._A-this._y)),l(r,i,e,s)},function(e){return void 0!==r?(this._y=r[0],void(this._A=r[1])):(r=function(t,e,n){var r=null,i=null;return t[e](function(t){var e=t.prop(n);return null===r&&null===i?void(r=i=e):(r=Math.min(r,e),void(i=Math.max(i,e)))}),{min:r,max:i}}(e,i,t),this._y=r.min,void(this._A=r.max))},function(){})}var i=t.vec4,o={rgb:{}},s=o.rgb;o.rgb.create=i.create,o.rgb.scale=i.scale,o.rgb.copy=i.copy,o.rgb.fromValues=i.fromValues,o.rgb.mix=function(t,e,n,r){var i=1-r;return t[0]=e[0]*r+n[0]*i,t[1]=e[1]*r+n[1]*i,t[2]=e[2]*r+n[2]*i,t[3]=e[3]*r+n[3]*i,t};var a={white:s.fromValues(1,1,1,1),black:s.fromValues(0,0,0,1),grey:s.fromValues(.5,.5,.5,1),lightgrey:s.fromValues(.8,.8,.8,1),darkgrey:s.fromValues(.3,.3,.3,1),red:s.fromValues(1,0,0,1),darkred:s.fromValues(.5,0,0,1),lightred:s.fromValues(1,.5,.5,1),green:s.fromValues(0,1,0,1),darkgreen:s.fromValues(0,.5,0,1),lightgreen:s.fromValues(.5,1,.5,1),blue:s.fromValues(0,0,1,1),darkblue:s.fromValues(0,0,.5,1),lightblue:s.fromValues(.5,.5,1,1),yellow:s.fromValues(1,1,0,1),darkyellow:s.fromValues(.5,.5,0,1),lightyellow:s.fromValues(1,1,.5,1),cyan:s.fromValues(0,1,1,1),darkcyan:s.fromValues(0,.5,.5,1),lightcyan:s.fromValues(.5,1,1,1),magenta:s.fromValues(1,0,1,1),darkmagenta:s.fromValues(.5,0,.5,1),lightmagenta:s.fromValues(1,.5,1,1),orange:s.fromValues(1,.5,0,1),darkorange:s.fromValues(.5,.25,0,1),lightorange:s.fromValues(1,.75,.5,1)};o.hex2rgb=function(t){var e,n,r,i;if(4===t.length||5===t.length){e=parseInt(t[1],16),n=parseInt(t[2],16),r=parseInt(t[3],16),i=15,5===t.length&&(i=parseInt(t[4],16));var o=1/15;return s.fromValues(o*e,o*n,o*r,o*i)}if(7===t.length||9===t.length){e=parseInt(t.substr(1,2),16),n=parseInt(t.substr(3,2),16),r=parseInt(t.substr(5,2),16),i=255,9===t.length&&(i=parseInt(t.substr(7,2),16));var a=1/255;return s.fromValues(a*e,a*n,a*r,a*i)}},o.setColorPalette=function(t){a=t,o.initGradients()},o.forceRGB=function(t){if("string"==typeof t){var e=a[t];if(void 0!==e)return e;if(t.length>0&&"#"===t[0])return o.hex2rgb(t)}return 3===t.length?[t[0],t[1],t[2],1]:t},e.prototype={colorAt:function(t,e){if(e<=this._Q[0])return i.copy(t,this._6[0]);if(e>=this._Q[this._Q.length-1])return i.copy(t,this._6[this._Q.length-1]);for(var n=0,r=1;r<this._Q.length&&!(this._Q[r]>e);++r)n=r;var o=n+1,a=this._Q[n],u=this._Q[o],h=(e-a)/(u-a);return s.mix(t,this._6[o],this._6[n],h)}};var u={};o.gradient=function(t,n){if("string"==typeof t)return u[t];if("equal"===(n=n||"equal")){n=[];for(var r=0;r<t.length;++r)n.push(1*r/(t.length-1))}return new e(t,n)};var h=o.gradient;o.initGradients=function(){u.rainbow=h(["red","yellow","green","blue"]),u.reds=h(["lightred","darkred"]),u.greens=h(["lightgreen","darkgreen"]),u.blues=h(["lightblue","darkblue"]),u.trafficlight=h(["green","yellow","red"]),u.heatmap=h(["red","white","blue"])},n.prototype={begin:function(t){this._dw&&this._dw(t)},end:function(t){this._do&&this._do(t)}},o.ColorOp=n,o.uniform=function(t){return t=o.forceRGB(t||"white"),new n(function(e,n,r){n[r+0]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3]},null,null)};var c={H:[1,1,1],C:[.83,.83,.83],N:[.13,.2,1],O:[1,.13,0],F:[.12,.94,.12],CL:[.12,.94,.12],BR:[.6,.13,0],I:[.4,0,.73],HE:[0,1,1],NE:[0,1,1],AR:[0,1,1],XE:[0,1,1],KR:[0,1,1],P:[1,.6,0],S:[.87,.87,0],B:[1,.67,.47],LI:[.47,0,1],NA:[.47,0,1],K:[.47,0,1],RB:[.47,0,1],CS:[.47,0,1],FR:[.47,0,1],BE:[0,.47,0],MG:[0,.47,0],SR:[0,.47,0],BA:[0,.47,0],RA:[0,.47,0],TI:[.6,.6,.6],FE:[.87,.47,0]};o.byElement=function(){return new n(function(t,e,n){var r=t.element(),i=c[r];return void 0!==i?(e[n]=i[0],e[n+1]=i[1],e[n+2]=i[2],e[n+3]=1,e):(e[n]=1,e[n+1]=0,e[n+2]=1,e[n+3]=1,e)},null,null)},o.bySS=function(){return new n(function(t,e,n){switch(t.residue().ss()){case"C":return e[n]=.8,e[n+1]=.8,e[n+2]=.8,void(e[n+3]=1);case"H":return e[n]=.6,e[n+1]=.6,e[n+2]=.9,void(e[n+3]=1);case"E":return e[n]=.2,e[n+1]=.8,e[n+2]=.2,void(e[n+3]=1)}},null,null)},o.rainbow=function(t){t||(t=h("rainbow"));var e=new n(function(e,n,r){var i=0,o=this.chainLimits[e.residue().chain().name()];if(void 0!==o){var s=e.residue().index();i=(s-o[0])/(o[1]-o[0])}var a=[1,1,1,1];t.colorAt(a,i),n[r]=a[0],n[r+1]=a[1],n[r+2]=a[2],n[r+3]=a[3]},function(t){var e=t.chains();this.chainLimits={};for(var n=0;n<e.length;++n){var r=e[n].backboneTraces();if(0!==r.length){for(var i=r[0].residueAt(0).index(),o=r[0].residueAt(r[0].length()-1).index(),s=1;s<r.length;++s){var a=r[s];i=Math.min(i,a.residueAt(0).index()),o=Math.max(o,a.residueAt(a.length()-1).index())}i!==o&&(this.chainLimits[e[n].name()]=[i,o])}}},function(){this.chainLimits=null});return e},o.ssSuccession=function(t,e){t||(t=h("rainbow")),e||(e=o.forceRGB("lightgrey"));var r=new n(function(n,r,i){var o=n.residue().index(),s=this.chainLimits[n.residue().chain().name()],a=s.indices[o];if(-1===a)return r[i]=e[0],r[i+1]=e[1],r[i+2]=e[2],void(r[i+3]=e[3]);var u=0;s.max,null!==s.max&&(u=a/(s.max>0?s.max:1));var h=[0,0,0,0];t.colorAt(h,u),r[i]=h[0],r[i+1]=h[1],r[i+2]=h[2],r[i+3]=h[3]},function(t){var e=t.chains();this.chainLimits={};for(var n=0;n<e.length;++n){for(var r=e[n].residues(),i=null,o={},s=0,a="C",u=0;u<r.length;++u){var h=r[u].ss();"C"===h?("C"!==a&&s++,o[r[u].index()]=-1):(i=s,o[r[u].index()]=s),a=h}this.chainLimits[e[n].name()]={indices:o,max:i}}},function(){this.chainLimits=null});return r},o.byChain=function(t){t||(t=h("rainbow"));var e=new n(function(e,n,r){var i=this.chainIndices[e.residue().chain().name()],o=i*this.scale,s=[0,0,0,0];t.colorAt(s,o),n[r+0]=s[0],n[r+1]=s[1],n[r+2]=s[2],n[r+3]=s[3]},function(t){var e=t.chains();this.chainIndices={};for(var n=0;n<e.length;++n)this.chainIndices[e[n].name()]=n;this.scale=e.length>1?1/(e.length-1):1},function(){this.chainIndices=null});return e};var l=function(){var t=i.create();return function(e,n,r,i){r.colorAt(t,i),e[n+0]=t[0],e[n+1]=t[1],e[n+2]=t[2],e[n+3]=t[3]}}();return o.byAtomProp=function(t,e,n){return r(t,e,n,"eachAtom",function(t){return t})},o.byResidueProp=function(t,e,n){return r(t,e,n,"eachResidue",function(t){return t.residue()})},o.interpolateColor=function(t,e){for(var n=new Float32Array(4*(e*(t.length/4-1)+1)),r=0,o=i.create(),s=i.create(),a=1/e,u=0;u<t.length/4-1;++u){i.set(o,t[4*u+0],t[4*u+1],t[4*u+2],t[4*u+3]),i.set(s,t[4*u+4],t[4*u+5],t[4*u+6],t[4*u+7]);for(var h=0;e>h;++h){var c=a*h;n[r+0]=o[0]*(1-c)+s[0]*c,n[r+1]=o[1]*(1-c)+s[1]*c,n[r+2]=o[2]*(1-c)+s[2]*c,n[r+3]=o[3]*(1-c)+s[3]*c,r+=4}}return n[r+0]=s[0],n[r+1]=s[1],n[r+2]=s[2],n[r+3]=s[3],n},o.initGradients(),o}(),n=function(){function t(t,e,n){this._cW=t,this._bq=e,this._bx=e,this._dp=n}function e(){this.clear()}return t.prototype={nextId:function(t){var e=this._bx;return this._bx++,this._cW._m[e]=t,e},hasLeft:function(){return this._bx<this._dp},recycle:function(){this._cW.recycle(this)},length:function(){return this._dp-this._bq}},e.prototype={MAX_ID:16777216,getContinuousRange:function(e){for(var n=-1,r=null,i=0;i<this._bg.length;++i){var o=this._bg[i],s=o.length();s>=e&&(null===r||r>s)&&(r=s,n=i)}if(-1!==n){var a=this._bg[n];return this._bg.splice(n,1),this._bH++,a}var u=this._cG,h=u+e;if(h>this.MAX_ID)return null;this._cG=h;var c=new t(this,u,h);return this._bH++,c},clear:function(){this._m={},this._cG=1,this._bg=[],this._bH=0},recycle:function(t){for(var e=t._bq;e<t._bx;++e)delete this._m[e];t._bx=t._bq,this._bg.push(t),this._bH--,this._bg.length>0&&0===this._bH&&this.clear()},objectForId:function(t){return this._m[t]}},e}(),r=function(){function t(t,e){return e>t}function e(t,e){void 0===t||void 0===e?(this._bT=!0,this._y=this._A=null):(this._bT=!1,this._y=t,this._A=e)}var n={derive:function(t,e,n){for(var r in e.prototype)t.prototype[r]=e.prototype[r];if(void 0!==n)for(var i in n)t.prototype[i]=n[i]},bind:function(t,e){return function(){return e.apply(t,arguments)}},copy:function(t){t=t||{};var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},binarySearch:function(e,n,r){if(0===e.length)return-1;r=r||t;for(var i=0,o=e.length,s=i+o>>1;;){var a=e[s];if(r(n,a))o=s;else{if(!r(a,n))return s;i=s}var u=i+o>>1;if(u===s)return-1;s=u}return-1},indexFirstLargerEqualThan:function(e,n,r){if(r=r||t,0===e.length||r(e[e.length-1],n))return-1;for(var i=0,o=e.length,s=i+o>>1;;){var a=e[s];r(n,a)?o=s:r(a,n)?i=s+1:o=s;var u=i+o>>1;if(u===s)return s;s=u}},indexLastSmallerThan:function(e,n,r){if(r=r||t,0===e.length||r(e[e.length-1],n))return e.length-1;if(r(n,e[0])||!r(e[0],n))return-1;for(var i=0,o=e.length,s=i+o>>1;;){var a=e[s];r(n,a)||!r(a,n)?o=s:i=s;var u=i+o>>1;if(u===s)return s;s=u}},indexLastSmallerEqualThan:function(e,n,r){if(r=r||t,0===e.length||r(e[e.length-1],n))return e.length-1;if(r(n,e[0]))return-1;for(var i=0,o=e.length,s=i+o>>1;;){var a=e[s];r(n,a)?o=s:i=s;var u=i+o>>1;if(u===s)return s;s=u}}};return e.prototype={min:function(){return this._y},max:function(){return this._A},length:function(){return this._A-this._y},empty:function(){return this._bT},center:function(){return.5*(this._A+this._y)},extend:function(t){this._y-=t,this._A+=t},update:function(t){return this._bT?(this._y=this._A=t,void(this._bT=!1)):void(t<this._y?this._y=t:t>this._A&&(this._A=t))}},n.Range=e,n}(),i=function(){function t(t){if("complete"!==document.readyState&&"loaded"!==document.readyState&&"interactive"!==document.readyState)return!1;if(void 0===t)try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("experimental-webgl"))}catch(t){return!1}return!!t}function e(t,e){this._k=e.width,this._dy=e.antialias,this._l=e.height,this._2=!1,this._d9=null,this._E=t,this._cj(),this._cB=e.backgroundColor,this._dh=e.forceManualAntialiasing}return e.prototype={_cs:function(){if(this._2){this._2=!1;var t=this._k*this._br,e=this._l*this._br;this._bb=t,this._bc=e,this._b.viewport(0,0,t,e),this._c.width=t,this._c.height=e,this._br>1&&this._dd(this._br)}},resize:function(t,e){(t!==this._k||e!==this._l)&&(this._2=!0,this._k=t,this._l=e)},fitParent:function(){var t=this._E.getBoundingClientRect();this.resize(t.width,t.height)},gl:function(){return this._b},imageData:function(){return this._c.toDataURL()},_eh:function(){try{var t={antialias:this._dy&&!this._dh,preserveDrawingBuffer:!0};this._b=this._c.getContext("experimental-webgl",t)}catch(t){return!1}return!!this._b},_dd:function(t){var e=1/t,n=.5*-(1-e)*this._bb,r=.5*-(1-e)*this._bc,i="translate("+n+"px, "+r+"px)",o="scale("+e+", "+e+")",s=i+" "+o;this._c.style.webkitTransform=s,this._c.style.transform=s,this._c.style.ieTransform=s,this._c.width=this._bb,this._c.height=this._bc},initGL:function(){var t=1;if(!this._eh())return!1;var e=this._b;return e.getContextAttributes().antialias&&!this._dh||!this._dy||(t=2),this._bb=this._k*t,this._bc=this._l*t,this._br=t,t>1&&this._dd(t),e.viewportWidth=this._bb,e.viewportHeight=this._bc,e.clearColor(this._cB[0],this._cB[1],this._cB[2],1),e.lineWidth(2),e.cullFace(e.FRONT),e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST),!0},_cM:function(t,e,n){var r,i=this._b;if("fragment"===e)r=i.createShader(i.FRAGMENT_SHADER);else{if("vertex"!==e)return null;r=i.createShader(i.VERTEX_SHADER)}var o=t.replace("${PRECISION}",n);return i.shaderSource(r,o),i.compileShader(r),i.getShaderParameter(r,i.COMPILE_STATUS)?r:null},initShader:function(t,e,n){var i=this._b,o=this._cM(e,"fragment",n),s=this._cM(t,"vertex",n),a=i.createProgram();if(i.attachShader(a,s),i.attachShader(a,o),i.linkProgram(a),!i.getProgramParameter(a,i.LINK_STATUS))return null;var u=r.bind(i,i.getAttribLocation),h=r.bind(i,i.getUniformLocation);return a.posAttrib=u(a,"attrPos"),a.colorAttrib=u(a,"attrColor"),a.normalAttrib=u(a,"attrNormal"),a.objIdAttrib=u(a,"attrObjId"),a.selectAttrib=u(a,"attrSelect"),a.symId=h(a,"symId"),a.projection=h(a,"projectionMat"),a.modelview=h(a,"modelviewMat"),a.rotation=h(a,"rotationMat"),a.fog=h(a,"fog"),a.fogFar=h(a,"fogFar"),a.fogNear=h(a,"fogNear"),a.fogColor=h(a,"fogColor"),a.outlineColor=h(a,"outlineColor"),a.outlineWidth=h(a,"outlineWidth"),a.relativePixelSize=h(a,"relativePixelSize"),a.screenDoorTransparency=h(a,"screenDoorTransparency"),a.selectionColor=h(a,"selectionColor"),a.pointSize=h(a,"pointSize"),a.zoom=h(a,"zoom"),a},on:function(t,e){this._c.addEventListener(t,e,!1)},removeEventListener:function(t,e){this._c.removeEventListener(t,e,!1)},onWheel:function(t,e){"onwheel"in this._c?this.on("wheel",t):this.on("mousewheel",e)},domElement:function(){return this._c},bind:function(){this._cs(),this._b.viewport(0,0,this._bb,this._bc)},superSamplingFactor:function(){return this._br},viewportWidth:function(){return this._bb},viewportHeight:function(){return this._bc},width:function(){return this._k},height:function(){return this._l},_cj:function(){this._c=document.createElement("canvas"),this._c.width=this._k,this._c.height=this._l,this._E.appendChild(this._c)},isWebGLSupported:function(){return t(this._b)},destroy:function(){this._c.width=1,this._c.height=1,this._c.parentElement.removeChild(this._c),this._c=null}},{Canvas:e,isWebGLSupported:t}}(),o=function(){function t(t,e){this._k=e.width,this._l=e.height,this._dt=this._k,this._du=this._l,this._b=t,this._ds=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._ds),this._bB=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this._bB),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this._k,this._l),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this._bB),this._bD=t.createTexture(),this._ei()}return t.prototype={width:function(){return this._k},height:function(){return this._l},bind:function(){var t=this._b;t.bindFramebuffer(t.FRAMEBUFFER,this._ds),t.bindRenderbuffer(t.RENDERBUFFER,this._bB),(this._dt!==this._k||this._du!==this._l)&&this._dN(),t.viewport(0,0,this._k,this._l)},colorTexture:function(){return this._bD},_ei:function(){this.bind();var t=this._b;t.bindTexture(t.TEXTURE_2D,this._bD),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this._k,this._l,0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this._bD,0),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null),this.release()},_dN:function(){var t=this._b;t.bindRenderbuffer(t.RENDERBUFFER,this._bB),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this._k,this._l),t.bindTexture(t.TEXTURE_2D,this._bD),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this._k,this._l,0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this._bD,0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this._bB),t.bindTexture(t.TEXTURE_2D,null),this._dt=this._k,this._du=this._l},resize:function(t,e){this._k=t,this._l=e},release:function(){var t=this._b;t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null)}},t}(),s=function(){function t(t){this._bA=[],this._ev=t}return t.prototype.request=function(t){for(var e=-1,n=null,r=0;r<this._bA.length;++r){var i=this._bA[r],o=i.length;o>=t&&(null===n||n>o)&&(n=o,e=r)}if(-1!==e){var s=this._bA[e];return this._bA.splice(e,1),s}return new this._ev(t)},t.prototype.release=function(t){this._bA.push(t)},t}(),a=function(){function e(t){this._b7=r.create(),this._N=r.create(),this._c6=r.create(),this._o=r.create(),this._bI=r.create(),this._bd=.1,this._5=4e3,this._di=-5,this._dj=50,this._bS=!0,this._cp=45*Math.PI/180,this._dk=n.fromValues(1,1,1),this._c0=n.fromValues(.1,.1,.1),this._ca=1,this._cO=n.fromValues(.1,1,.1),this._U=n.create(),this._L=50,this._cP=!1,this._7=!0,this._F=!0,this._0=1,this._b=t,this._bU=null,this._bp=0,this.setViewportSize(t.viewportWidth,t.viewportHeight)}var n=t.vec3,r=t.mat4;return e.prototype={_bz:function(){this._bp+=1,this._bp>68719476735&&(this._bp=0)},setScreenDoorTransparency:function(t){this._cP=t,this._bz()},setOutlineWidth:function(t){this._ca!==t&&(this._ca=t,this._bz())},setRotation:function(t){16===t.length?r.copy(this._o,t):r.fromMat3(this._o,t),this._F=!0},upsamplingFactor:function(){return this._0},setUpsamplingFactor:function(t){if(this._0!==t){this._bz(),this._0=t;var e=this._0/this._k,n=this._0/this._l;this._cS=new Float32Array([e,n])}},mainAxes:function(){return[n.fromValues(this._o[0],this._o[4],this._o[8]),n.fromValues(this._o[1],this._o[5],this._o[9]),n.fromValues(this._o[2],this._o[6],this._o[10])]},fieldOfViewY:function(){return this._cp},setFieldOfViewY:function(t){this._cp=t,this._7=!0},aspectRatio:function(){return this._k/this._l},rotation:function(){return this._o},_dE:function(){var t=!1;return this._F&&(r.identity(this._N),r.translate(this._N,this._N,[-this._U[0],-this._U[1],-this._U[2]]),r.mul(this._N,this._o,this._N),r.identity(this._bI),r.translate(this._bI,this._bI,[0,0,-this._L]),r.mul(this._N,this._bI,this._N),t=!0),this._7&&(r.identity(this._b7),r.perspective(this._b7,this._cp,this._k/this._l,this._bd,this._5),t=!0),this._7=!1,this._F=!1,t&&this._bz(),t},setViewportSize:function(t,e){this._7=!0,this._k=t,this._l=e,this._cS=new Float32Array([this._0/t,this._0/e])},viewportWidth:function(){return this._k},viewportHeight:function(){return this._l},setCenter:function(t){this._F=!0,n.copy(this._U,t)},fog:function(t){return void 0!==t&&t!==this._bS&&(this._bS=t,this._bz()),this._bS},rotateZ:function(){var t=r.create();return function(e){r.identity(t),this._F=!0,r.rotate(t,t,e,[0,0,1]),r.mul(this._o,t,this._o)}}(),rotateX:function(){var t=r.create();return function(e){r.identity(t),this._F=!0,r.rotate(t,t,e,[1,0,0]),r.mul(this._o,t,this._o)}}(),rotateY:function(){var t=r.create();return function(e){r.identity(t),this._F=!0,r.rotate(t,t,e,[0,1,0]),r.mul(this._o,t,this._o)}}(),panX:function(t){return this.panXY(t,0)},panY:function(t){return this.panXY(0,t)},panXY:function(){var t=r.create(),e=n.create();return function(i,o){r.transpose(t,this._o),this._F=!0,n.set(e,-i,o,0),n.transformMat4(e,e,t),n.add(e,e,this._U),this.setCenter(e)}}(),nearOffset:function(){return this._bd},farOffset:function(){return this._5},setNearFar:function(t,e){(t!==this._bd||e!==this._5)&&(this._bd=t,this._5=e,this._7=!0)},setFogNearFar:function(t,e){this._di=t,this._dj=e,this._7=!0},setZoom:function(t){return this._F=!0,this._L=t,this._L},zoom:function(t){if(void 0===t)return this._L;this._F=!0;var e=1+.1*t;return this._L=Math.min(1e3,Math.max(2,e*this._L)),this._L},center:function(){return this._U},setFogColor:function(t){this._dk=n.clone(t)},currentShader:function(){return this._bU},invalidateCurrentShader:function(){this._bU=null},setOutlineColor:function(t){this._c0=n.clone(t)},setSelectionColor:function(t){this._cO=n.clone(t)},bind:function(t,e){var n=!1,i=this._b;if(this._bU!==t&&(this._bU=t,i.useProgram(t),n=!0),n=this._dE()||n,e?(r.mul(this._c6,this._N,e),i.uniformMatrix4fv(t.modelview,!1,this._c6)):i.uniformMatrix4fv(t.modelview,!1,this._N),this._bp!==t.stateId){t.stateId=this._bp,i.uniformMatrix4fv(t.projection,!1,this._b7),t.rotation&&i.uniformMatrix4fv(t.rotation,!1,this._o),i.uniform1i(t.fog,this._bS);var o=this._L;i.uniform1f(t.fogFar,this._dj+o),i.uniform1f(t.zoom,this._L),i.uniform1f(t.fogNear,this._di+o),i.uniform3fv(t.fogColor,this._dk),i.uniform3fv(t.outlineColor,this._c0),i.uniform3fv(t.selectionColor,this._cO),i.uniform2fv(t.relativePixelSize,this._cS),i.uniform1f(t.outlineWidth,this._ca),i.uniform1i(t.screenDoorTransparency,this._cP)}}},e}(),u={PRELUDE_FS:"\nprecision ${PRECISION} float;\nuniform bool screenDoorTransparency;\nvec4 handleAlpha(vec4 inColor) {\n  if (screenDoorTransparency) {\n    ivec2 pxCoord = ivec2(gl_FragCoord.xy);\n    ivec2 mod = pxCoord - (pxCoord/2) * 2;\n    if (inColor.a < 0.99 &&\n        (inColor.a < 0.01 || mod.x != 0 || mod.y != 0)) { discard; }\n    return vec4(inColor.rgb, 1.0);\n  } else {\n    if (inColor.a == 0.0) { discard; }\n    return inColor;\n  } \n} \nuniform vec3 selectionColor;\n\nvec3 handleSelect(vec3 inColor, float vertSelect) { \n  return mix(inColor, selectionColor, step(0.5, vertSelect) * 0.7); \n} \n\nuniform bool fog;\nuniform float fogNear;\nuniform float fogFar;\nuniform vec3 fogColor;\nvec3 handleFog(vec3 inColor) {\n  if (fog) {\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    float fogFactor = smoothstep(fogNear, fogFar, depth);\n    return mix(inColor, fogColor, fogFactor);\n  } else {\n    return inColor;\n  }\n}",LINES_FS:"\nvarying vec4 vertColor;\nvarying vec3 vertNormal;\n\nvoid main(void) {\n  gl_FragColor = handleAlpha(vertColor);\n  gl_FragColor.rgb = handleFog(gl_FragColor.rgb);\n}",SELECT_LINES_FS:"\nprecision ${PRECISION} float;\n\nvarying float vertSelect;\nvarying vec3 vertNormal;\nuniform float fogNear;\nuniform float fogFar;\nuniform vec3 fogColor;\nuniform bool fog;\nuniform vec3 selectionColor;\n\nvoid main(void) {\n  gl_FragColor = mix(vec4(0.0, 0.0, 0.0, 0.0), vec4(selectionColor, 1.0), \n                     vertSelect);\n  gl_FragColor.a = step(0.5, vertSelect);\n  if (gl_FragColor.a == 0.0) { discard; }\n  float depth = gl_FragCoord.z / gl_FragCoord.w;\n  if (fog) {\n    float fog_factor = smoothstep(fogNear, fogFar, depth);\n    gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w),\n                        fog_factor);\n  }\n}",SELECT_LINES_VS:"\nattribute vec3 attrPos;\nattribute float attrSelect;\n\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nuniform float pointSize;\nvarying float vertSelect;\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  gl_Position.z += gl_Position.w * 0.000001; \n  float distToCamera = vec4(modelviewMat * vec4(attrPos, 1.0)).z;\n  gl_PointSize = pointSize * 200.0 / abs(distToCamera); \n  vertSelect = attrSelect;\n}",SELECT_VS:"\nprecision ${PRECISION} float;\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nuniform float pointSize;\nattribute vec3 attrPos;\nattribute float attrObjId;\n\nvarying float objId;\n\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  float distToCamera = vec4(modelviewMat * vec4(attrPos, 1.0)).z;\n  gl_PointSize = pointSize * 200.0 / abs(distToCamera); \n  objId = attrObjId;\n}",SELECT_FS:"\nprecision ${PRECISION} float;\n\nvarying float objId;\nuniform int symId;\n\nint intMod(int x, int y) { \n  int z = x/y;\n  return x-y*z;\n}\nvoid main(void) {\n  // ints are only required to be 7bit...\n  int integralObjId = int(objId+0.5);\n  int red = intMod(integralObjId, 256);\n  integralObjId/=256;\n  int green = intMod(integralObjId, 256);\n  integralObjId/=256;\n  int blue = intMod(integralObjId, 256);\n  int alpha = symId;\n  gl_FragColor = vec4(float(red), float(green), \n                      float(blue), float(alpha))/255.0;\n}",LINES_VS:"\nattribute vec3 attrPos;\nattribute vec4 attrColor;\n\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nvarying vec4 vertColor;\nuniform float pointSize;\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  float distToCamera = vec4(modelviewMat * vec4(attrPos, 1.0)).z;\n  gl_PointSize = pointSize * 200.0 / abs(distToCamera); \n  vertColor = attrColor;\n}",HEMILIGHT_FS:"\nvarying vec4 vertColor;\nvarying vec3 vertNormal;\nvarying float vertSelect;\n\nvoid main(void) {\n  float dp = dot(vertNormal, vec3(0.0, 0.0, 1.0));\n  float hemi = min(1.0, max(0.0, dp)*0.6+0.5);\n  gl_FragColor = vec4(vertColor.rgb*hemi, vertColor.a);\n  gl_FragColor.rgb = handleFog(handleSelect(gl_FragColor.rgb, vertSelect));\n  gl_FragColor = handleAlpha(gl_FragColor);\n}",PHONG_FS:"\nvarying vec4 vertColor;\nvarying vec3 vertNormal;\nvarying vec3 vertPos;\nuniform float zoom;\nvarying float vertSelect;\n\nvoid main(void) {\n  vec3 eyePos = vec3(0.0, 0.0, zoom);\n  float dp = dot(vertNormal, normalize(eyePos - vertPos));\n  float hemi = min(1.0, max(0.3, dp)+0.2);\n  //hemi *= vertColor.a;\n  vec3 rgbColor = vertColor.rgb * hemi; \n  rgbColor += min(vertColor.rgb, 0.8) * pow(max(0.0, dp), 18.0);\n  rgbColor = handleSelect(rgbColor, vertSelect);\n  gl_FragColor = vec4(clamp(rgbColor, 0.0, 1.0), vertColor.a);\n  gl_FragColor.rgb = handleFog(gl_FragColor.rgb);\n  gl_FragColor = handleAlpha(gl_FragColor);\n}",HEMILIGHT_VS:"\nattribute vec3 attrPos;\nattribute vec4 attrColor;\nattribute vec3 attrNormal;\nattribute float attrSelect;\n\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nvarying vec4 vertColor;\nvarying vec3 vertNormal;\nvarying vec3 vertPos;\nvarying float vertSelect;\nvoid main(void) {\n  vertPos = (modelviewMat * vec4(attrPos, 1.0)).xyz;\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  vec4 n = (modelviewMat * vec4(attrNormal, 0.0));\n  vertNormal = n.xyz;\n  vertColor = attrColor;\n  vertSelect = attrSelect;\n}",OUTLINE_FS:"\nvarying float vertAlpha;\nvarying float vertSelect;\n\nuniform vec3 outlineColor;\n\nvoid main() {\n  gl_FragColor = vec4(mix(outlineColor, selectionColor, \n                          step(0.5, vertSelect)), \n                      vertAlpha);\n  gl_FragColor.rgb = handleFog(gl_FragColor.rgb);\n  gl_FragColor = handleAlpha(gl_FragColor);\n}",OUTLINE_VS:"\nprecision ${PRECISION} float;\n\nattribute vec3 attrPos;\nattribute vec3 attrNormal;\nattribute vec4 attrColor;\nattribute float attrSelect;\n\nuniform vec3 outlineColor;\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nvarying float vertAlpha;\nvarying float vertSelect;\nuniform vec2 relativePixelSize;\nuniform float outlineWidth;\n\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  vec4 normal = modelviewMat * vec4(attrNormal, 0.0);\n  vertAlpha = attrColor.a;\n  vertSelect = attrSelect;\n  vec2 expansion = relativePixelSize * \n       (outlineWidth + 2.0 * step(0.5, attrSelect));\n  vec2 offset = normal.xy * expansion;\n  gl_Position.xy += gl_Position.w * offset;\n}",TEXT_VS:"\nprecision ${PRECISION} float;\n\nattribute vec3 attrCenter;\nattribute vec2 attrCorner;\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nuniform mat4 rotationMat;\nvarying vec2 vertTex;\nuniform float width;\nuniform float height;\nvoid main() { \n  vec4 pos = modelviewMat* vec4(attrCenter, 1.0);\n  pos.z += 4.0;\n  gl_Position = projectionMat * pos;\n  gl_Position.xy += vec2(width,height)*attrCorner*gl_Position.w; \n  vertTex = (attrCorner+abs(attrCorner))/(2.0*abs(attrCorner)); \n}",TEXT_FS:"\nprecision ${PRECISION} float;\n\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nuniform sampler2D sampler;\nuniform float xScale;\nuniform float yScale;\nvarying vec2 vertTex;\nvoid main() { \n  vec2 texCoord = vec2(vertTex.x*xScale, vertTex.y*yScale);\n  gl_FragColor = texture2D(sampler, texCoord);\n  if (gl_FragColor.a == 0.0) { discard; }\n}"},h=function(){function t(t,e,n){this._bh=t,this._bh.addEventListener("touchmove",r.bind(this,this._dG)),this._bh.addEventListener("touchstart",r.bind(this,this._dF)),this._bh.addEventListener("touchend",r.bind(this,this._cH)),this._bh.addEventListener("touchcancel",r.bind(this,this._cH)),this._8={scale:1,rotation:0,center:null},this._bP=null,this._w=e,this._d=n}function e(t,e){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}function n(t,n){var r=e(t[0],t[1]),i=e(n[0],n[1]);return i/(0===r?1:r)}function i(t,e){var n=e.x-t.x,r=e.y-t.y;return Math.atan2(r,n)}function o(t,e){return i(e[1],e[0])-i(t[1],t[0])}return t.prototype={_dm:function(t,e){var r={};r.center=function(t){for(var e=0,n=0,r=0;r<t.length;++r)e+=t[r].clientX,n+=t[r].clientY;return e/=t.length,n/=t.length,{x:e,y:n}}(e.targetTouches),r.pointers=[];for(var i=0;i<e.targetTouches.length;++i){var s=e.targetTouches[i];r.pointers.push({x:s.clientX,y:s.clientY})}return r.numTouches=e.targetTouches.length,r.rotation=0,r.scale=1,r.deltaScale=0,r.deltaRotation=0,t.center&&(r.deltaCenter={x:r.center.x-t.center.x,y:r.center.y-t.center.y}),2!==t.numTouches||2!==r.numTouches?r:(r.initialPointers=t.initialPointers?t.initialPointers:t.pointers,r.scale=n(r.initialPointers,r.pointers),r.deltaScale=r.scale-t.scale,r.rotation=o(r.initialPointers,r.pointers),r.deltaRotation=r.rotation-t.rotation,r)},_dG:function(t){t.preventDefault();var e=this._dm(this._8,t),n=4*-e.deltaScale;if(0!==n&&this._d.zoom(n),2===e.numTouches&&2===this._8.numTouches){var r=.002*Math.tan(.5*this._d.fieldOfViewY())*this._d.zoom();this._d.panXY(e.deltaCenter.x*r,e.deltaCenter.y*r)}var i=-e.deltaRotation;this._d.rotateZ(i),1===e.numTouches&&1===this._8.numTouches&&(this._d.rotateX(.005*e.deltaCenter.y),this._d.rotateY(.005*e.deltaCenter.x)),this._w.requestRedraw(),this._8=e},_dF:function(t){if(t.preventDefault(),1===t.targetTouches.length){var e=(new Date).getTime();if(null!==this._bP){var n=e-this._bP;500>n&&this._w._c4({clientX:t.targetTouches[0].clientX,clientY:t.targetTouches[0].clientY})}this._bP=e}else this._bP=null;this._8=this._dm(this._8,t)},_cH:function(t){t.preventDefault()}},t}(),c=function(){function t(t,e,n,r){this._w=e,this._c=t,this._d=n,this._c=t,this._ey=r,this._cg=null,this._ej()}return t.prototype={_es:function(t){null!==t&&this._w.setCenter(t.pos(),this._ey)},_d2:function(t){var e=this._c,n=(new Date).getTime();if((null===this._cg||n-this._cg>300)&n-this._ea<300){var r=this._c.domElement().getBoundingClientRect(),i=this._w.pick({x:t.clientX-r.left,y:t.clientY-r.top});this._w._cv(t,"click",i)}this._cg=n,e.removeEventListener("mousemove",this._bN),e.removeEventListener("mousemove",this._bO),e.removeEventListener("mouseup",this._bM),document.removeEventListener("mouseup",this._bM),document.removeEventListener("mousemove",this._bN),document.removeEventListener("mousemove",this._bO)},setCam:function(t){this._d=t},_ej:function(){return this._bO=r.bind(this,this._d4),this._bN=r.bind(this,this._d3),this._bM=r.bind(this,this._d2),this._c.onWheel(r.bind(this,this._d0),r.bind(this,this._d1)),this._c.on("dblclick",r.bind(this,this._c4)),this._c.on("mousedown",r.bind(this,this._d5)),!0},_d1:function(t){this._d.zoom(t.wheelDelta<0?-1:1),t.preventDefault(),this._w.requestRedraw()},_d0:function(t){this._d.zoom(t.deltaY<0?1:-1),t.preventDefault(),this._w.requestRedraw()},_c4:function(t){var e=this._c.domElement().getBoundingClientRect(),n=this._w.pick({x:t.clientX-e.left,y:t.clientY-e.top});this._w._cv(t,"doubleClick",n),this._w.requestRedraw()},_d5:function(t){0===t.button&&(this._ea=(new Date).getTime(),t.preventDefault(),!0===t.shiftKey?(this._c.on("mousemove",this._bO),document.addEventListener("mousemove",this._bO,!1)):(this._c.on("mousemove",this._bN),document.addEventListener("mousemove",this._bN,!1)),this._c.on("mouseup",this._bM),document.addEventListener("mouseup",this._bM,!1),this._be={x:t.pageX,y:t.pageY})},_d3:function(t){var e={x:t.pageX,y:t.pageY},n={x:e.x-this._be.x,y:e.y-this._be.y};this._d.rotateX(.005*n.y),this._d.rotateY(.005*n.x),this._be=e,this._w.requestRedraw()},_d4:function(t){var e={x:t.pageX,y:t.pageY},n={x:e.x-this._be.x,y:e.y-this._be.y},r=.002*Math.tan(.5*this._d.fieldOfViewY())*this._d.zoom();this._d.panXY(r*n.x,r*n.y),this._be=e,this._w.requestRedraw()}},t}(),l=function(){function e(t,e,n){return n?t*e:e*(t-1)+1}function n(t,e){this._U=t||r.create(),this._dP=e||1}var r=t.vec3,i=t.vec4,o=t.mat3,s=t.quat,a=function(){var t=r.create();return function(e,n,i){return r.cross(t,e,n),Math.atan2(r.dot(t,i),r.dot(e,n))}}(),u=function(){var t=r.create();return function(e,n){return r.copy(t,n),Math.abs(n[0])<Math.abs(n[1])?Math.abs(n[0])<Math.abs(n[2])?t[0]+=1:t[2]+=1:Math.abs(n[1])<Math.abs(n[2])?t[1]+=1:t[2]+=1,r.cross(e,n,t)}}(),h=function(){var t=r.create();return function(e,n,i,o,s,a,u){var h=a*a,c=3-2*a,l=h*c,f=1-l,d=h*(a-2)+a,_=h*(a-1);r.copy(t,n),r.scale(t,t,f),r.scaleAndAdd(t,t,i,d),r.scaleAndAdd(t,t,o,l),r.scaleAndAdd(t,t,s,_),e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2]}}(),c=function(){var t=o.create(),e=o.create(),n=o.create(),a=o.create(),u=s.create(),h=r.create(),c=r.create();return function(l){for(var f=s.fromValues(0,0,0,1),d=0;24>d;++d){o.fromQuat(t,f);var _=o.transpose(n,t);o.mul(e,t,o.mul(a,l,_)),r.set(h,e[5],e[2],e[1]),r.set(c,Math.abs(h[0]),Math.abs(h[1]),Math.abs(h[2]));var v=c[0]>c[1]&&c[0]>c[2]?0:c[1]>c[2]?1:2,m=(v+1)%3,b=(v+2)%3;if(0===h[v])break;var p=(e[3*b+b]-e[3*m+m])/(2*h[v]),g=p>0?1:-1,y=(p*=g)+(1e6>p?Math.sqrt(p*p+1):p),A=g/y,w=1/Math.sqrt(A*A+1);if(1===w)break;if(i.set(u,0,0,0,0),u[v]=g*Math.sqrt((1-w)/2),u[v]*=-1,u[3]=Math.sqrt(1-u[v]*u[v]),1===u[3])break;f=s.mul(f,f,u),s.normalize(f,f)}return f}}();n.prototype.center=function(){return this._U},n.prototype.radius=function(){return this._dP};var l=function(t,e,n,i,o){o?r.cross(i,e,n):u(i,e),r.cross(n,i,e),r.normalize(i,i),r.normalize(n,n),t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=i[0],t[4]=i[1],t[5]=i[2],t[6]=e[0],t[7]=e[1],t[8]=e[2]};return{signedAngle:a,axisRotation:function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],s=e[1],a=e[2],u=o*o,h=o*s,c=o*a,l=s*s,f=s*a,d=a*a;return t[0]=u+i-u*i,t[1]=h-i*h-r*a,t[2]=c-i*c+r*s,t[3]=h-i*h+r*a,t[4]=l+i-i*l,t[5]=f-i*f-r*o,t[6]=c-i*c-r*s,t[7]=f-i*f+r*o,t[8]=d+i-i*d,t},ortho:u,diagonalizer:c,catmullRomSpline:function(t,n,i,o,s,a){o=o||.5;var u=null,c=3*e(n,i,s=s||!1);u=a?a.request(c):new Float32Array(c);var l,f,d,_=0,v=1/i,m=r.create(),b=r.create(),p=r.create(),g=r.create(),y=r.create(),A=r.create();for(r.set(g,t[0],t[1],t[2]),r.set(y,t[3],t[4],t[5]),s?(r.set(p,t[t.length-3],t[t.length-2],t[t.length-1]),r.sub(m,y,p),r.scale(m,m,o)):(r.set(p,t[0],t[1],t[2]),r.set(m,0,0,0)),l=1,d=n-1;d>l;++l){for(r.set(A,t[3*(l+1)],t[3*(l+1)+1],t[3*(l+1)+2]),r.sub(b,A,g),r.scale(b,b,o),f=0;i>f;++f)h(u,g,m,y,b,v*f,_),_+=3;r.copy(p,g),r.copy(g,y),r.copy(y,A),r.copy(m,b)}for(s?(r.set(A,t[0],t[1],t[3]),r.sub(b,A,g),r.scale(b,b,o)):r.set(b,0,0,0),f=0;i>f;++f)h(u,g,m,y,b,v*f,_),_+=3;if(!s)return u[_]=t[3*(n-1)+0],u[_+1]=t[3*(n-1)+1],u[_+2]=t[3*(n-1)+2],u;for(r.copy(p,g),r.copy(g,y),r.copy(y,A),r.copy(m,b),r.set(A,t[3],t[4],t[5]),r.sub(b,A,g),r.scale(b,b,o),f=0;i>f;++f)h(u,g,m,y,b,v*f,_),_+=3;return u},cubicHermiteInterpolate:h,interpolateScalars:function(t,e){for(var n=new Float32Array(e*(t.length-1)+1),r=0,i=0,o=0,s=1/e,a=0;a<t.length-1;++a){i=t[a],o=t[a+1];for(var u=0;e>u;++u){var h=s*u;n[r+0]=i*(1-h)+o*h,r+=1}}return n[r+0]=o,n},catmullRomSplineNumPoints:e,Sphere:n,buildRotation:l}}(),f=function(){function e(t,e){this._f=e,this._b2=t,this._h=new Uint16Array(3*e*t*2),this._n=new Float32Array(3*e*t);var n,r,i=Math.PI/(t-1),o=2*Math.PI/e;for(n=0;n<this._b2;++n){var s=Math.sin(n*i),a=Math.cos(n*i);for(r=0;r<this._f;++r){var u=s*Math.cos(r*o),h=s*Math.sin(r*o);this._n[3*(r+n*this._f)]=u,this._n[3*(r+n*this._f)+1]=h,this._n[3*(r+n*this._f)+2]=a}}var c=0;for(n=0;n<this._b2-1;++n)for(r=0;r<this._f;++r)this._h[c]=n*this._f+r,this._h[c+1]=n*this._f+(r+1)%this._f,this._h[c+2]=(n+1)*this._f+r,c+=3,this._h[c]=n*this._f+(r+1)%this._f,this._h[c+1]=(n+1)*this._f+(r+1)%this._f,this._h[c+2]=(n+1)*this._f+r,c+=3}function n(t,e,n){var r=l.catmullRomSpline(t,t.length/3,e,n,!0);this._h=new Uint16Array(2*r.length),this._n=r,this._H=new Float32Array(r.length),this._f=r.length/3;for(var o=i.create(),s=0;s<this._f;++s){var a=0===s?this._f-1:s-1,u=s===this._f-1?0:s+1;o[0]=this._n[3*u+1]-this._n[3*a+1],o[1]=this._n[3*a]-this._n[3*u],i.normalize(o,o),this._H[3*s]=o[0],this._H[3*s+1]=o[1],this._H[3*s+2]=o[2]}for(s=0;s<this._f;++s)this._h[6*s]=s,this._h[6*s+1]=s+this._f,this._h[6*s+2]=(s+1)%this._f+this._f,this._h[6*s+3]=s,this._h[6*s+4]=(s+1)%this._f+this._f,this._h[6*s+5]=(s+1)%this._f}function r(t){this._f=t,this._h=new Uint16Array(3*t*2),this._n=new Float32Array(3*t*2),this._H=new Float32Array(3*t*2);for(var e=2*Math.PI/this._f,n=0;n<this._f;++n){var r=Math.cos(e*n),i=Math.sin(e*n);this._n[3*n]=r,this._n[3*n+1]=i,this._n[3*n+2]=-.5,this._n[3*t+3*n]=r,this._n[3*t+3*n+1]=i,this._n[3*t+3*n+2]=.5,this._H[3*n]=r,this._H[3*n+1]=i,this._H[3*t+3*n]=r,this._H[3*t+3*n+1]=i}for(n=0;n<this._f;++n)this._h[6*n]=n%this._f,this._h[6*n+1]=t+(n+1)%this._f,this._h[6*n+2]=(n+1)%this._f,this._h[6*n+3]=n%this._f,this._h[6*n+4]=t+n%this._f,this._h[6*n+5]=t+(n+1)%this._f}var i=t.vec3;return e.prototype={addTransformed:function(){var t=i.create(),e=i.create();return function(n,r,o,s,a){for(var u=n.numVerts(),h=0;h<this._b2*this._f;++h)i.set(e,this._n[3*h],this._n[3*h+1],this._n[3*h+2]),i.copy(t,e),i.scale(t,t,o),i.add(t,t,r),n.addVertex(t,e,s,a);for(h=0;h<this._h.length/3;++h)n.addTriangle(u+this._h[3*h],u+this._h[3*h+1],u+this._h[3*h+2])}}(),numIndices:function(){return this._h.length},numVerts:function(){return this._n.length/3}},n.prototype={addTransformed:function(){var t=i.create(),e=i.create();return function(n,r,o,s,a,u,h,c){for(var l=this._f,f=this._H,d=this._n,_=n.numVerts()-l,v=0;l>v;++v)i.set(t,o*d[3*v],o*d[3*v+1],0),i.transformMat3(t,t,s),i.add(t,t,r),i.set(e,f[3*v],f[3*v+1],0),i.transformMat3(e,e,s),n.addVertex(t,e,a,c);if(!u)if(0!==h)for(v=0;l>v;++v)n.addTriangle(_+(v+h)%l,_+v+l,_+(v+1)%l+l),n.addTriangle(_+(v+h)%l,_+(v+1)%l+l,_+(v+1+h)%l);else for(v=0;v<this._h.length/3;++v)n.addTriangle(_+this._h[3*v],_+this._h[3*v+1],_+this._h[3*v+2])}}()},r.prototype={numVerts:function(){return this._n.length/3},numIndices:function(){return this._h.length},addTransformed:function(){var t=i.create(),e=i.create();return function(n,r,o,s,a,u,h,c,l){for(var f=n.numVerts(),d=this._n,_=this._H,v=this._f,m=0;2*v>m;++m){i.set(t,s*d[3*m],s*d[3*m+1],o*d[3*m+2]),i.transformMat3(t,t,a),i.add(t,t,r),i.set(e,_[3*m],_[3*m+1],_[3*m+2]),i.transformMat3(e,e,a);var b=v>m?c:l;n.addVertex(t,e,v>m?u:h,b)}var p=this._h;for(m=0;m<p.length/3;++m)n.addTriangle(f+p[3*m],f+p[3*m+1],f+p[3*m+2])}}()},{TubeProfile:n,ProtoCylinder:r,ProtoSphere:e}}(),L=function(){function t(t){this._bE=[],this._P=!0,this._I=name||"",this._b=t,this._cb=1}return t.prototype={order:function(t){return void 0!==t&&(this._cb=t),this._cb},add:function(t){this._bE.push(t)},draw:function(t,e,n,r){for(var i=0,o=this._bE.length;i!==o;++i)this._bE[i].draw(t,e,n,r)},show:function(){this._P=!0},hide:function(){this._P=!1},name:function(t){return void 0!==t&&(this._I=t),this._I},destroy:function(){for(var t=0;t<this._bE.length;++t)this._bE[t].destroy()},visible:function(){return this._P}},t}(),B=function(){function e(t){L.call(this,t),this._3=[],this._M=[],this._cL=null,this._bK=null}var n=t.vec3,i=function(){var t=n.create();return function(e,r,i){for(var o=0;o<r.length;++o)for(var s=r[o],a=e.chainsByName(s.chains()),u=0;u<s.matrices().length;++u)for(var h=s.matrix(u),c=0;c<a.length;++c)for(var l=a[c],f=0;f<l.residues().length;++f){var d=l.residues()[f].centralAtom();null!==d&&(n.transformMat4(t,d.pos(),h),i(d,t))}}}();return r.derive(e,L,{setShowRelated:function(t){return t&&"asym"!==t&&null===this.structure().assembly(t)?void 0:(this._cL=t,t)},symWithIndex:function(t){if("asym"===this.showRelated())return null;var e=this.structure().assembly(this.showRelated());if(!e)return null;for(var n=e.generators(),r=0;r<n.length;++r){if(n[r].matrices().length>t)return n[r].matrix(t);t-=n[r].matrices().length}return null},showRelated:function(){return this._cL},select:function(t){return this.structure().select(t)},structure:function(){return this._M[0]._i},getColorForAtom:function(t,e){return this._M[0].getColorForAtom(t,e)},addIdRange:function(t){this._3.push(t)},destroy:function(){L.prototype.destroy.call(this);for(var t=0;t<this._3.length;++t)this._3[t].recycle()},eachCentralAtom:function(t){var e=this.structure(),n=e.assembly(this.showRelated());return null===n?function(t,e){t.eachResidue(function(t){var n=t.centralAtom();null!==n&&e(n,n.pos())})}(e,t):i(e,n.generators(),t)},addVertAssoc:function(t){this._M.push(t)},_b0:function(t){for(var e=this.vertArrays(),n=[],r={},i=0;i<t.length;++i)r[t[i]]=!0;for(var o=0;o<e.length;++o)!0===r[e[o].chain()]&&n.push(e[o]);return n},_em:function(t,e,n){for(var r=n.generators(),i=0;i<r.length;++i){var o=r[i],s=this._b0(o.chains());this._cu(t,e,s,o.matrices())}},_dD:function(t,e,n,r,i,o){for(var s=this.vertArrays(),a=0;a<s.length;++a)s[a].updateProjectionIntervals(t,e,n,r,i,o)},updateProjectionIntervals:function(t,e,n,r,i,o){if(this._P){var s=this.showRelated();if("asym"===s)return this._dD(t,e,n,r,i,o);for(var a=this.structure().assembly(s),u=a.generators(),h=0;h<u.length;++h)for(var c=u[h],l=this._b0(c.chains()),f=0;f<c.matrices().length;++f)for(var d=0;d<l.length;++d){var _=c.matrix(f);l[d].updateProjectionIntervals(t,e,n,r,i,o,_)}}},_dC:function(t,e){for(var n=this.vertArrays(),r=0;r<n.length;++r)e=n[r].updateSquaredSphereRadius(t,e);return e},updateSquaredSphereRadius:function(t,e){if(!this._P)return e;var n=this.showRelated();if("asym"===n)return this._dC(t,e);for(var r=this.structure().assembly(n),i=r.generators(),o=0;o<i.length;++o)for(var s=i[o],a=this._b0(s.chains()),u=0;u<s.matrices().length;++u)for(var h=0;h<a.length;++h)e=a[h].updateSquaredSphereRadius(t,e);return e},draw:function(t,e,n,r){if(this._P){var i=this.shaderForStyleAndPass(e,n,r);if(i){var o=this.showRelated();if("asym"===o)return this._cu(t,i,this.vertArrays(),null);var s=this.structure().assembly(o);return this._em(t,i,s)}}},colorBy:function(t,e){this._p=!1,e=e||this.structure();for(var n=0;n<this._M.length;++n)this._M[n].recolor(t,e)},setOpacity:function(t,e){this._p=!1,e=e||this.structure();for(var n=0;n<this._M.length;++n)this._M[n].setOpacity(t,e)},setSelection:function(t){this._bK=t,this._p=!1;for(var e=0;e<this._M.length;++e)this._M[e].setSelection(t)},selection:function(){return null===this._bK&&(this._bK=this.structure().createEmptyView()),this._bK}}),e}(),O=function(){function e(t,e,n){this._b=t,this._cE=t.createBuffer(),this._B=n||null,this._p=!1,this._bV=null;var r=this._t*e;this._e=n.request(r)}var n=t.vec3;return e.prototype={setColor:function(t,e,n,r,i){var o=t*this._t+this._bG;this._e[o+0]=e,this._e[o+1]=n,this._e[o+2]=r,this._e[o+3]=i,this._p=!1},getColor:function(t,e){var n=t*this._t+this._bG;return e[0]=this._e[n+0],e[1]=this._e[n+1],e[2]=this._e[n+2],e[3]=this._e[n+3],e},setOpacity:function(t,e){var n=t*this._t+this._bG;this._e[n+3]=e,this._p=!1},setSelected:function(t,e){var n=t*this._t+this._cC;this._e[n]=e,this._p=!1},boundingSphere:function(){return this._bV||(this._bV=this._et()),this._bV},_et:function(){var t=this.numVerts();if(0===t)return null;var e,r,i=n.create();for(r=0;t>r;++r)e=r*this._t,i[0]+=this._e[e+0],i[1]+=this._e[e+1],i[2]+=this._e[e+2];n.scale(i,i,1/t);var o=0;for(r=0;t>r;++r){e=r*this._t;var s=i[0]-this._e[e+0],a=i[1]-this._e[e+1],u=i[2]-this._e[e+2];o=Math.max(o,s*s+a*a+u*u)}return new l.Sphere(i,Math.sqrt(o))},destroy:function(){this._b.deleteBuffer(this._cE),this._B.release(this._e)},bindBuffers:function(){this._b.bindBuffer(this._b.ARRAY_BUFFER,this._cE),this._p||(this._b.bufferData(this._b.ARRAY_BUFFER,this._e,this._b.STATIC_DRAW),this._p=!0)},updateSquaredSphereRadius:function(){var t=n.create();return function(e,r,i){var o=this.boundingSphere();if(!o)return r;if(i)return n.transformMat4(t,o.center(),i),Math.max(n.sqrDist(t,e),r);var s=o.radius()*o.radius();return Math.max(n.sqrDist(o.center(),e)+s,r)}}(),updateProjectionIntervals:function(){var t=n.create();return function(e,r,i,o,s,a,u){var h=this.boundingSphere();if(h){u?n.transformMat4(t,h.center(),u):n.copy(t,h.center());var c=n.dot(e,t),l=n.dot(r,t),f=n.dot(i,t);o.update(c-h.radius()),o.update(c+h.radius()),s.update(l-h.radius()),s.update(l+h.radius()),a.update(f-h.radius()),a.update(f+h.radius())}}}()},e}(),d=function(){function t(t,e,n){O.call(this,t,e,n),this._x=0,this._cT=this._b.LINES}return r.derive(t,O,{_t:9,_dz:0,_bG:3,_eE:7,_cC:8,numVerts:function(){return this._x},setDrawAsPoints:function(t){this._cT=t?this._b.POINTS:this._b.LINES},addPoint:function(t,e,n){var r=this._t*this._x;this._e[r++]=t[0],this._e[r++]=t[1],this._e[r++]=t[2],this._e[r++]=e[0],this._e[r++]=e[1],this._e[r++]=e[2],this._e[r++]=e[3],this._e[r++]=n,this._e[r++]=0,this._x+=1,this._p=!1,this._bV=null},addLine:function(t,e,n,r,i,o){this.addPoint(t,e,i),this.addPoint(n,r,o)},bindAttribs:function(t){this._b.vertexAttribPointer(t.posAttrib,3,this._b.FLOAT,!1,4*this._t,4*this._dz),-1!==t.colorAttrib&&(this._b.vertexAttribPointer(t.colorAttrib,4,this._b.FLOAT,!1,4*this._t,4*this._bG),this._b.enableVertexAttribArray(t.colorAttrib)),this._b.enableVertexAttribArray(t.posAttrib),-1!==t.objIdAttrib&&(this._b.vertexAttribPointer(t.objIdAttrib,1,this._b.FLOAT,!1,4*this._t,4*this._eE),this._b.enableVertexAttribArray(t.objIdAttrib)),-1!==t.selectAttrib&&(this._b.vertexAttribPointer(t.selectAttrib,1,this._b.FLOAT,!1,4*this._t,4*this._cC),this._b.enableVertexAttribArray(t.selectAttrib))},releaseAttribs:function(t){this._b.disableVertexAttribArray(t.posAttrib),-1!==t.colorAttrib&&this._b.disableVertexAttribArray(t.colorAttrib),-1!==t.objIdAttrib&&this._b.disableVertexAttribArray(t.objIdAttrib),-1!==t.selectAttrib&&this._b.disableVertexAttribArray(t.selectAttrib)},bind:function(t){this.bindBuffers(),this.bindAttribs(t)},draw:function(){this._b.drawArrays(this._cT,0,this._x)}}),t}(),_=k=function(){function t(t,e,n,r,i){O.call(this,t,e,r),this._de=t.createBuffer(),this._G=i,this._x=0,this._c7=e,this._bw=0,this._D=i.request(n)}return r.derive(t,O,{destroy:function(){O.prototype.destroy.call(this),this._b.deleteBuffer(this._de),this._G.release(this._D)},setIndexData:function(t){this._p=!1,this._bw=t.length/3;for(var e=0;e<t.length;++e)this._D[e]=t[e]},setVertData:function(t){this._p=!1,this._x=t.length/this._t;for(var e=0;e<t.length;++e)this._e[e]=t[e]},numVerts:function(){return this._x},maxVerts:function(){return this._c7},numIndices:function(){return 3*this._bw},addVertex:function(t,e,n,r){if(this._x!==this._c7){var i=this._x*this._t;this._e[i++]=t[0],this._e[i++]=t[1],this._e[i++]=t[2],this._e[i++]=e[0],this._e[i++]=e[1],this._e[i++]=e[2],this._e[i++]=n[0],this._e[i++]=n[1],this._e[i++]=n[2],this._e[i++]=n[3],this._e[i++]=r,this._e[i++]=0,this._x+=1,this._p=!1}},_t:12,_eG:48,_eM:10,_eC:40,_cC:11,_eA:44,_bG:6,_eF:24,_eN:3,_eD:12,_dz:0,_eB:0,addTriangle:function(t,e,n){var r=3*this._bw;r+2>=this._D.length||(this._D[r++]=t,this._D[r++]=e,this._D[r++]=n,this._bw+=1,this._p=!1)},bindBuffers:function(){var t=this._p,e=this._b;O.prototype.bindBuffers.call(this),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._de),t||e.bufferData(e.ELEMENT_ARRAY_BUFFER,this._D,e.STATIC_DRAW)},bindAttribs:function(t){var e=this._b,n=this._eG;e.enableVertexAttribArray(t.posAttrib),e.vertexAttribPointer(t.posAttrib,3,e.FLOAT,!1,n,this._eB),-1!==t.normalAttrib&&(e.enableVertexAttribArray(t.normalAttrib),e.vertexAttribPointer(t.normalAttrib,3,e.FLOAT,!1,n,this._eD)),-1!==t.colorAttrib&&(e.vertexAttribPointer(t.colorAttrib,4,e.FLOAT,!1,n,this._eF),e.enableVertexAttribArray(t.colorAttrib)),-1!==t.objIdAttrib&&(e.vertexAttribPointer(t.objIdAttrib,1,e.FLOAT,!1,n,this._eC),e.enableVertexAttribArray(t.objIdAttrib)),-1!==t.selectAttrib&&(e.vertexAttribPointer(t.selectAttrib,1,e.FLOAT,!1,n,this._eA),e.enableVertexAttribArray(t.selectAttrib))},releaseAttribs:function(t){var e=this._b;e.disableVertexAttribArray(t.posAttrib),-1!==t.colorAttrib&&e.disableVertexAttribArray(t.colorAttrib),-1!==t.normalAttrib&&e.disableVertexAttribArray(t.normalAttrib),-1!==t.objIdAttrib&&e.disableVertexAttribArray(t.objIdAttrib),-1!==t.selectAttrib&&e.disableVertexAttribArray(t.selectAttrib)},bind:function(t){this.bindBuffers(),this.bindAttribs(t)},draw:function(){var t=this._b;t.drawElements(t.TRIANGLES,3*this._bw,t.UNSIGNED_SHORT,0)}}),t}(),v=function(t){function e(e,n,r,i){t.call(this,n,r,i),this._J=e}function n(t,e,n,r,i,o){k.call(this,e,n,r,i,o),this._J=t}return r.derive(e,t,{chain:function(){return this._J},drawSymmetryRelated:function(t,e,n){this.bind(e);for(var r=0;r<n.length;++r)t.bind(e,n[r]),this._b.uniform1i(e.symId,r),this.draw();this.releaseAttribs(e)}}),r.derive(n,k,{chain:function(){return this._J}}),n.prototype.drawSymmetryRelated=e.prototype.drawSymmetryRelated,{LineChainData:e,MeshChainData:n}}(d),m=function(t,e){function n(t,e,n){B.call(this,t),this._z=[],this._B=e,this._G=n,this._bL=null,this._bt=null}var i=t.MeshChainData;return r.derive(n,B,{_cz:function(t){return Math.min(65536,t)},addChainVertArray:function(t,e,n){this._bL=e,this._bt=n;var r=new i(t.name(),this._b,this._cz(e),n,this._B,this._G);return this._z.push(r),r},addVertArray:function(t,n){this._bL=t,this._bt=n;var r=new e(this._b,this._cz(t),n,this._B,this._G);return this._z.push(r),r},vertArrayWithSpaceFor:function(t){var n=this._z[this._z.length-1],r=n.maxVerts()-n.numVerts();if(r>=t)return n;this._bL-=n.numVerts(),this._bt-=n.numIndices(),t=this._cz(this._bL);var o=null;return o=n instanceof i?new i(n.chain(),this._b,t,this._bt,this._B,this._G):new e(this._b,t,this._bt,this._B,this._G),this._z.push(o),o},vertArray:function(t){return this._z[t]},destroy:function(){B.prototype.destroy.call(this);for(var t=0;t<this._z.length;++t)this._z[t].destroy();this._z=[]},numVerts:function(){return this._z[0].numVerts()},shaderForStyleAndPass:function(t,e,n){if("normal"===n)return"hemilight"===e?t.hemilight:t.phong;if("select"===n)return t.select;if("outline"===n)return t.outline;var r=t[n];return void 0!==r?r:null},_cu:function(t,e,n,r){var i;if(r)for(i=0;i<n.length;++i)n[i].drawSymmetryRelated(t,e,r);else for(t.bind(e),this._b.uniform1i(e.symId,255),i=0;i<n.length;++i)n[i].bind(e),n[i].draw(),n[i].releaseAttribs(e)},vertArrays:function(){return this._z},addVertex:function(t,e,n,r){var i=this._z[0];i.addVertex(t,e,n,r)},addTriangle:function(t,e,n){var r=this._z[0];r.addTriangle(t,e,n)}}),n}(v,_),b=function(t){function e(t,e){B.call(this,t),this._bo=[],this._B=e,this._ce=.5,this._b8=1}var n=t.LineChainData;return r.derive(e,B,{addChainVertArray:function(t,e){var r=new n(t.name(),this._b,e,this._B);return this._bo.push(r),r},setLineWidth:function(t){this._ce=t},setPointSize:function(t){this._b8=t},vertArrays:function(){return this._bo},shaderForStyleAndPass:function(t,e,n){return"outline"===n?t.selectLines:"select"===n?t.select:t.lines},destroy:function(){B.prototype.destroy.call(this);for(var t=0;t<this._bo.length;++t)this._bo[t].destroy();this._bo=[]},_cu:function(t,e,n,r){var i,o=t.upsamplingFactor();if(-1!==e.selectAttrib&&(o=4*t.upsamplingFactor()),r)for(t.bind(e),this._b.lineWidth(o*this._ce),e.pointSize&&this._b.uniform1f(e.pointSize,o*this._b8),i=0;i<n.length;++i)n[i].drawSymmetryRelated(t,e,r);else for(t.bind(e),this._b.lineWidth(o*this._ce),this._b.uniform1i(e.symId,255),e.pointSize&&this._b.uniform1f(e.pointSize,o*this._b8),i=0;i<n.length;++i)n[i].bind(e),n[i].draw(),n[i].releaseAttribs(e)},vertArray:function(){return this._W}}),e}(v),p=function(){function t(t,e){this._i=t,this._s=[],this._bF=e}function n(t,e,n){this._i=t,this._s=[],this._bF=n,this._bf=e||1,this._bv={}}return t.prototype={addAssoc:function(t,e,n,r){this._s.push({atom:t,vertexArray:e,vertStart:n,vertEnd:r})},recolor:function(t,e){var n=new Float32Array(4*e.atomCount());this._bF&&t.begin(this._i);var r={};e.eachAtom(function(e,i){r[e.index()]=i,t.colorFor(e,n,4*i)}),this._bF&&t.end(this._i);for(var i=0;i<this._s.length;++i){var o=this._s[i],s=r[o.atom.index()];if(void 0!==s)for(var a=n[4*s+0],u=n[4*s+1],h=n[4*s+2],c=n[4*s+3],l=o.vertexArray,f=o.vertStart;f<o.vertEnd;++f)l.setColor(f,a,u,h,c)}},getColorForAtom:function(t,e){for(var n=0;n<this._s.length;++n){var r=this._s[n];if(r.atom.full()===t.full())return r.vertexArray.getColor(r.vertStart,e)}return null},setSelection:function(t){var e={};t.eachAtom(function(t){e[t.index()]=!0});for(var n=0;n<this._s.length;++n)for(var r=this._s[n],i=e[r.atom.index()],o=!0!==i?0:1,s=r.vertexArray,a=r.vertStart;a<r.vertEnd;++a)s.setSelected(a,o)},setOpacity:function(t,e){var n={};e.eachAtom(function(t){n[t.index()]=!0});for(var r=0;r<this._s.length;++r){var i=this._s[r],o=n[i.atom.index()];if(!0===o)for(var s=i.vertexArray,a=i.vertStart;a<i.vertEnd;++a)s.setOpacity(a,t)}}},n.prototype={setPerResidueColors:function(t,e){this._bv[t]=e},addAssoc:function(t,e,n,r,i){this._s.push({traceIndex:t,slice:n,vertStart:r,vertEnd:i,vertexArray:e})},recolor:function(t,n){this._bF&&t.begin(this._i);var r,i,o=[],s=this._i.backboneTraces();for(r=0;r<s.length;++r){var a=this._bv[r],u=0,h=s[r];for(i=0;i<h.length();++i)n.containsResidue(h.residueAt(i))?(t.colorFor(h.centralAtomAt(i),a,u),u+=4):u+=4;o.push(this._bf>1?e.interpolateColor(a,this._bf):a)}for(r=0;r<this._s.length;++r){var c=this._s[r],l=c.slice,f=o[c.traceIndex],d=f[4*l],_=f[4*l+1],v=f[4*l+2],m=f[4*l+3],b=c.vertexArray;for(i=c.vertStart;i<c.vertEnd;++i)b.setColor(i,d,_,v,m)}this._bF&&t.end(this._i)},getColorForAtom:function(t,e){var n,r,i=this._i.backboneTraces(),o=t.full().residue();for(n=0;n<i.length;++n){var s=this._bv[n],a=0,u=i[n];for(r=0;r<u.length();++r){if(o===u.residueAt(r).full())return e[0]=s[a+0],e[1]=s[a+1],e[2]=s[a+2],e[3]=s[a+3],e;a+=4}}return null},setSelection:function(t){var e,n,r=[],i=this._i.backboneTraces();for(e=0;e<i.length;++e){var o=new Float32Array(this._bv[e].length),s=0,a=i[e];for(n=0;n<a.length();++n){var u=t.containsResidue(a.residueAt(n))?1:0;o[s]=u,s+=1}r.push(this._bf>1?l.interpolateScalars(o,this._bf):o)}for(e=0;e<this._s.length;++e){var h=this._s[e],c=h.slice,f=r[h.traceIndex],d=f[c],_=h.vertexArray;for(n=h.vertStart;n<h.vertEnd;++n)_.setSelected(n,d)}},setOpacity:function(t,n){var r,i,o=[],s=this._i.backboneTraces();for(r=0;r<s.length;++r){var a=this._bv[r],u=0,h=s[r];for(i=0;i<h.length();++i)n.containsResidue(h.residueAt(i))?(a[u+3]=t,u+=4):u+=4;o.push(this._bf>1?e.interpolateColor(a,this._bf):a)}for(r=0;r<this._s.length;++r){var c=this._s[r],l=c.slice,f=o[c.traceIndex],d=f[4*l+3],_=c.vertexArray;for(i=c.vertStart;i<c.vertEnd;++i)_.setOpacity(i,d)}}},{TraceVertexAssoc:n,AtomVertexAssoc:t}}(),g=function(n,r,i,o){var s=t.vec3,a=t.vec4,u=t.mat3,h=n.TubeProfile,c=n.ProtoSphere,f=n.ProtoCylinder,d=o.TraceVertexAssoc,_=o.AtomVertexAssoc,v=e.interpolateColor,m={},b=.7071,p=[-b,-b,0,b,-b,0,b,b,0,-b,b,0],g=[-6*b,-.9*b,0,-5.8*b,-1*b,0,5.8*b,-1*b,0,6*b,-.9*b,0,6*b,.9*b,0,5.8*b,1*b,0,-5.8*b,1*b,0,-6*b,.9*b,0],y=[-10*b,-.9*b,0,-9.8*b,-1*b,0,9.8*b,-1*b,0,10*b,-.9*b,0,10*b,.9*b,0,9.8*b,1*b,0,-9.8*b,1*b,0,-10*b,.9*b,0],A=function(){var t=s.create(),e=s.create(),n=s.create();return function(r,i,o,a){i=Math.max(i,1),o=Math.min(a-1,o);var u=3*(i-1);s.set(t,r[u],r[u+1],r[u+2]),s.set(n,r[3*i],r[3*i+1],r[3*i+2]);for(var h=i;o>h;++h)u=3*(h+1),s.set(e,r[u],r[u+1],r[u+2]),r[3*h+0]=.25*e[0]+.5*n[0]+.25*t[0],r[3*h+1]=.25*e[1]+.5*n[1]+.25*t[1],r[3*h+2]=.25*e[2]+.5*n[2]+.25*t[2],s.copy(t,n),s.copy(n,e)}}(),w=function(){var t=a.fromValues(0,0,0,1);return function(e,n,r,i){var o=i.atomCount(),s=r.idPool.getContinuousRange(o);e.addIdRange(s);var a=r.protoSphere.numVerts(),u=r.protoSphere.numIndices(),h=1.5*r.radiusMultiplier;e.addChainVertArray(i,a*o,u*o),i.eachAtom(function(i){var o=e.vertArrayWithSpaceFor(a);r.color.colorFor(i,t,0);var u=o.numVerts(),c=s.nextId({geom:e,atom:i});r.protoSphere.addTransformed(o,i.pos(),h,t,c);var l=o.numVerts();n.addAssoc(i,o,u,l)})}}();m.spheres=function(t,e,n){var i=new c(n.sphereDetail,n.sphereDetail);n.protoSphere=i;var o=new r(e,n.float32Allocator,n.uint16Allocator),s=new _(t,!0);return o.addVertAssoc(s),o.setShowRelated(n.showRelated),n.color.begin(t),t.eachChain(function(t){w(o,s,n,t)}),n.color.end(t),o};var S=function(){var t=s.create(),e=s.create(),n=a.fromValues(0,0,0,1),r=s.create(),i=s.create(),o=u.create();return function(a,u,h,c){var f=c.atomCount(),d=0;c.eachAtom(function(t){d+=t.bonds().length});var _=f*h.protoSphere.numVerts()+d*h.protoCyl.numVerts(),v=f*h.protoSphere.numIndices()+d*h.protoCyl.numIndices();a.addChainVertArray(c,_,v);var m=h.idPool.getContinuousRange(f);a.addIdRange(m),c.eachAtom(function(c){var f=h.protoSphere.numVerts()+c.bondCount()*h.protoCyl.numVerts(),d=a.vertArrayWithSpaceFor(f),_=d.numVerts(),v=m.nextId({geom:a,atom:c});h.color.colorFor(c,n,0),h.protoSphere.addTransformed(d,c.pos(),h.radius,n,v),c.eachBond(function(a){a.mid_point(t),s.sub(e,c.pos(),t);var u=s.length(e);s.scale(e,e,1/u),l.buildRotation(o,e,r,i,!1),s.add(t,t,c.pos()),s.scale(t,t,.5),h.protoCyl.addTransformed(d,t,u,h.radius,o,n,n,v,v)});var b=d.numVerts();u.addAssoc(c,d,_,b)})}}();m.ballsAndSticks=function(t,e,n){var i=new _(t,!0),o=new c(n.sphereDetail,n.sphereDetail),s=new f(n.arcDetail);n.protoSphere=o,n.protoCyl=s;var a=new r(e,n.float32Allocator,n.uint16Allocator);return a.addVertAssoc(i),a.setShowRelated(n.showRelated),n.color.begin(t),t.eachChain(function(t){S(a,i,n,t)}),n.color.end(t),a};var C=function(){var t=a.fromValues(0,0,0,1);return function(e,n,r,i){var o=r.atomCount(),s=i.idPool.getContinuousRange(o);e.addIdRange(s);var a=e.addChainVertArray(r,o);a.setDrawAsPoints(!0),r.eachAtom(function(r){var o=a.numVerts();i.color.colorFor(r,t,0);var u=s.nextId({geom:e,atom:r});a.addPoint(r.pos(),t,u);var h=a.numVerts();n.addAssoc(r,a,o,h)})}}();m.points=function(t,e,n){var r=new _(t,!0);n.color.begin(t);var o=new i(e,n.float32Allocator);return o.setPointSize(n.pointSize),o.addVertAssoc(r),o.setShowRelated(n.showRelated),t.eachChain(function(t){C(o,r,t,n)}),n.color.end(t),o};var E=function(){var t=s.create(),e=a.fromValues(0,0,0,1);return function(n,r,i,o){var s=0,a=i.atomCount(),u=o.idPool.getContinuousRange(a);n.addIdRange(u),i.eachAtom(function(t){var e=t.bonds().length;s+=e||3});var h=n.addChainVertArray(i,2*s);i.eachAtom(function(i){var s=h.numVerts(),a=u.nextId({geom:n,atom:i});if(i.bonds().length)i.eachBond(function(n){n.mid_point(t),o.color.colorFor(i,e,0),h.addLine(i.pos(),e,t,e,a,a)});else{var c=.2,l=i.pos();o.color.colorFor(i,e,0),h.addLine([l[0]-c,l[1],l[2]],e,[l[0]+c,l[1],l[2]],e,a,a),h.addLine([l[0],l[1]-c,l[2]],e,[l[0],l[1]+c,l[2]],e,a,a),h.addLine([l[0],l[1],l[2]-c],e,[l[0],l[1],l[2]+c],e,a,a)}var f=h.numVerts();r.addAssoc(i,h,s,f)})}}();m.lines=function(t,e,n){var r=new _(t,!0);n.color.begin(t);var o=new i(e,n.float32Allocator);return o.setLineWidth(n.lineWidth),o.addVertAssoc(r),o.setShowRelated(n.showRelated),t.eachChain(function(t){E(o,r,t,n)}),n.color.end(t),o};var R=function(){var t=a.fromValues(0,0,0,1),e=a.fromValues(0,0,0,1),n=s.create(),r=s.create();return function(i,o,s,a,u,h){o.addAssoc(a,s,0,s.numVerts(),s.numVerts()+1);var c=h.float32Allocator.request(4*u.length()),l=h.idPool.getContinuousRange(u.length());i.addIdRange(l);for(var f,d=l.nextId({geom:i,atom:u.centralAtomAt(0)}),_=1;_<u.length();++_){h.color.colorFor(u.centralAtomAt(_-1),t,0),c[4*(_-1)+0]=t[0],c[4*(_-1)+1]=t[1],c[4*(_-1)+2]=t[2],c[4*(_-1)+3]=t[3],h.color.colorFor(u.centralAtomAt(_),e,0),u.posAt(n,_-1),u.posAt(r,_),f=l.nextId({geom:i,atom:u.centralAtomAt(_)}),s.addLine(n,t,r,e,d,f),d=f,f=null;var v=s.numVerts();o.addAssoc(a,s,_,v-1,v+(_===u.length()-1?0:1))}return c[4*u.length()-4]=e[0],c[4*u.length()-3]=e[1],c[4*u.length()-2]=e[2],c[4*u.length()-1]=e[3],o.setPerResidueColors(a,c),a+1}}();m.lineTrace=function(t,e,n){var r=new d(t,1,!0);n.color.begin(t);var o=new i(e,n.float32Allocator);o.setLineWidth(n.lineWidth);var s=0;return t.eachChain(function(t){s=function(t,e,n,r,i){for(var o=i.backboneTraces(),s=function(t){for(var e=0,n=0;n<t.length;++n)e+=2*(t[n].length()-1);return e}(o),a=t.addChainVertArray(i,s),u=0;u<o.length;++u)r=R(t,e,a,r,o[u],n);return r}(o,r,n,s,t)}),o.addVertAssoc(r),o.setShowRelated(n.showRelated),n.color.end(t),o};var x=function(){var t=s.create(),e=s.create(),n=a.fromValues(0,0,0,1),r=a.fromValues(0,0,0,1);return function(i,o,s,a,u,h){var c,f=h.fullTraceIndex(0),d=a.float32Allocator.request(3*h.length()),_=a.float32Allocator.request(4*h.length()),m=[],b=a.idPool.getContinuousRange(h.length());for(i.addIdRange(b),c=0;c<h.length();++c){var p=h.centralAtomAt(c);h.smoothPosAt(t,c,a.strength),a.color.colorFor(p,_,4*c),d[3*c]=t[0],d[3*c+1]=t[1],d[3*c+2]=t[2],m.push(b.nextId({geom:i,atom:p}))}var g=m[0],y=0,A=l.catmullRomSpline(d,h.length(),a.splineDetail,a.strength,!1,a.float32Allocator),w=v(_,a.splineDetail),S=s.numVerts();o.addAssoc(u,s,f,S,S+1);var C=Math.floor(a.splineDetail/2),E=l.catmullRomSplineNumPoints(h.length(),a.splineDetail,!1);for(c=1;E>c;++c){t[0]=A[3*(c-1)],t[1]=A[3*(c-1)+1],t[2]=A[3*(c-1)+2],e[0]=A[3*(c-0)],e[1]=A[3*(c-0)+1],e[2]=A[3*(c-0)+2],n[0]=w[4*(c-1)+0],n[1]=w[4*(c-1)+1],n[2]=w[4*(c-1)+2],n[3]=w[4*(c-1)+3],r[0]=w[4*(c-0)+0],r[1]=w[4*(c-0)+1],r[2]=w[4*(c-0)+2],r[3]=w[4*(c-0)+3];var R=Math.floor((c+C)/a.splineDetail);y=m[Math.min(m.length-1,R)],s.addLine(t,n,e,r,g,y),g=y;var x=s.numVerts();o.addAssoc(u,s,f+c,x-1,x+(c===h.length-1?0:1))}return o.setPerResidueColors(u,_),a.float32Allocator.release(d),a.float32Allocator.release(A),u+1}}();m.sline=function(t,e,n){n.color.begin(t);var r=new d(t,n.splineDetail,1,!0),o=new i(e,n.float32Allocator);o.addVertAssoc(r),o.setLineWidth(n.lineWidth),o.setShowRelated(n.showRelated);var s=0;return t.eachChain(function(t){s=function(t,e,n,r,i){for(var o=r.backboneTraces(),s=function(t,e){for(var n=0,r=0;r<t.length;++r)n+=2*(e*(t[r].length()-1)+1);return n}(o,n.splineDetail),a=t.addChainVertArray(r,s),u=0;u<o.length;++u)i=x(t,e,a,n,i,o[u]);return i}(o,r,n,t,s)}),n.color.end(t),o};var T=function(t,e,n){for(var r=0,i=0;i<t.length;++i)r+=t[i].length()*e,r+=(t[i].length()-1)*n;return r};m.trace=function(t,e,n){n.protoCyl=new f(n.arcDetail),n.protoSphere=new c(n.sphereDetail,n.sphereDetail);var i=new r(e,n.float32Allocator,n.uint16Allocator),o=new d(t,1,!0);i.addVertAssoc(o),i.setShowRelated(n.showRelated),n.color.begin(t);var s=0;return t.eachChain(function(t){s=function(t,e,n,r,i){var o=i.backboneTraces(),s=T(o,n.protoSphere.numVerts(),n.protoCyl.numVerts()),a=function(t,e,n){for(var r=0,i=0;i<t.length;++i)r+=t[i].length()*e,r+=(t[i].length()-1)*n;return r}(o,n.protoSphere.numIndices(),n.protoCyl.numIndices());t.addChainVertArray(i,s,a);for(var u=0;u<o.length;++u)P(t,e,o[u],r,n),r++;return r}(i,o,n,s,t)}),n.color.end(t),i};var M=function(t,e,n){for(var r=0,i=0;i<t.length;++i){var o=((t[i].length()-1)*n+1)*e,s=Math.ceil((o+2)/65536);r+=o+(s-1)*e,r+=2}return r},F=function(){var t=u.create(),e=s.create(),n=s.create(),r=s.create(),i=s.create(),o=a.create();return function(a,u,h,c){for(var f=1.8*c.radius,d=c.protoCyl.numVerts()+2*c.protoSphere.numVerts(),_=0;_<h.length;++_){var v=h[_],m=c.idPool.getContinuousRange(v.length());a.addIdRange(m);for(var b=0;b<v.length();++b){var p=a.vertArrayWithSpaceFor(d),g=p.numVerts(),y=v.residueAt(b),A=y.name(),w=y.atom("C3'"),S=null;if(null!==(S=y.atom("A"===A||"G"===A||"DA"===A||"DG"===A?"N1":"N3"))&&null!==w){var C=m.nextId({geom:a,atom:S});s.add(i,w.pos(),S.pos()),s.scale(i,i,.5),c.color.colorFor(S,o,0),s.sub(r,S.pos(),w.pos());var E=s.length(r);s.scale(r,r,1/E),l.buildRotation(t,r,n,e,!1),c.protoCyl.addTransformed(p,i,E,f,t,o,o,C,C),c.protoSphere.addTransformed(p,S.pos(),f,o,C),c.protoSphere.addTransformed(p,w.pos(),f,o,C);var R=p.numVerts();u.addAssoc(S,p,g,R)}}}}}();m.cartoon=function(t,e,n){n.arrowSkip=Math.floor(3*n.splineDetail/4),n.coilProfile=new h(p,n.arcDetail,1),n.arrowProfile=new h(y,n.arcDetail/2,.1),n.helixProfile=new h(g,n.arcDetail/2,.1),n.strandProfile=new h(g,n.arcDetail/2,.1),n.protoCyl=new f(4*n.arcDetail),n.protoSphere=new c(4*n.arcDetail,4*n.arcDetail);var i=new r(e,n.float32Allocator,n.uint16Allocator),o=new d(t,n.splineDetail,!0);i.addVertAssoc(o),i.setShowRelated(n.showRelated),n.color.begin(t);var s=0,a=t.select({anames:["N1","N3"]}),u=new _(a,!0);return i.addVertAssoc(u),t.eachChain(function(t){s=function(t,e,n,r,i,o){for(var s=o.backboneTraces(),a=M(s,4*r.arcDetail,r.splineDetail),u=function(t,e,n){for(var r=0,i=0;i<t.length;++i)r+=(t[i].length()*n-1)*e*6,r+=6*e;return r}(s,4*r.arcDetail,r.splineDetail),h=[],c=r.protoCyl.numVerts()+2*r.protoSphere.numVerts(),l=r.protoCyl.numIndices()+2*r.protoSphere.numIndices(),f=0;f<s.length;++f){var d=s[f];d.residueAt(0).isNucleotide()&&(h.push(d),a+=d.length()*c,u+=d.length()*l)}t.addChainVertArray(o,a,u);for(var _=0;_<s.length;++_)i=D(t,e,s[_],i,r);return F(t,n,h,r),i}(i,o,u,n,s,t)}),n.color.end(t),i},m.surface=function(){var t=s.create(),e=s.create(),n=a.fromValues(.8,.8,.8,1);return function(i,o,a){var u=0;i.getUint32(0),u+=4;var h=i.getUint32(u),c=24*h+(u+=4),l=i.getUint32(c),f=new r(o,a.float32Allocator,a.uint16Allocator);f.setShowRelated("asym");var d,_=f.addVertArray(h,3*l);for(d=0;h>d;++d)s.set(t,i.getFloat32(u+0),i.getFloat32(u+4),i.getFloat32(u+8)),u+=12,s.set(e,i.getFloat32(u+0),i.getFloat32(u+4),i.getFloat32(u+8)),u+=12,_.addVertex(t,e,n,0);for(u=c+4,d=0;l>d;++d){var v=i.getUint32(u+0),m=i.getUint32(u+4),b=i.getUint32(u+8);u+=12,_.addTriangle(v-1,b-1,m-1)}return f}}();var N=function(){var t=u.create(),e=s.create();return function(n,r,i,o,a,u,h,c,f,d,_){var v=f.coilProfile;"C"===o||f.forceTube?c?l.ortho(i,a):s.cross(i,e,a):"H"===o?v=f.helixProfile:"E"===o?v=f.strandProfile:"A"===o&&(v=f.arrowProfile),l.buildRotation(t,a,i,e,!0),v.addTransformed(n,r,h,t,u,c,d,_)}}(),I=function(){var t=s.create(),e=s.create(),n=s.create();return function(r,i,o,a,u,h,c,l){var f=null,d=null,_=i.length();s.set(n,0,0,0);for(var v=0;_>v;++v){h.push(c.nextId({geom:r,atom:i.centralAtomAt(v)})),i.smoothPosAt(t,v,l.strength),a[3*v]=t[0],a[3*v+1]=t[1],a[3*v+2]=t[2],i.smoothNormalAt(e,v,l.strength);var m=i.centralAtomAt(v);l.color.colorFor(m,o,4*v),s.dot(e,n)<0&&s.scale(e,e,-1),"E"!==i.residueAt(v).ss()||l.forceTube||(null===f&&(f=v),d=v),"C"===i.residueAt(v).ss()&&null!==f&&(A(a,f,d,_),A(u,f,d,_),f=null,d=null),u[3*v]=a[3*v]+e[0]+n[0],u[3*v+1]=a[3*v+1]+e[1]+n[1],u[3*v+2]=a[3*v+2]+e[2]+n[2],s.copy(n,e)}}}(),D=function(){var t=s.create(),e=s.create(),n=a.fromValues(0,0,0,1),r=s.create(),i=s.create();return function(o,u,h,c,f){var d=M([h],4*f.arcDetail,f.splineDetail),_=f.float32Allocator.request(3*h.length()),m=f.float32Allocator.request(4*h.length()),b=f.float32Allocator.request(3*h.length()),p=[],g=f.idPool.getContinuousRange(h.length());o.addIdRange(g),I(o,h,m,_,b,p,g,f);var y=o.vertArrayWithSpaceFor(d),A=l.catmullRomSpline(_,h.length(),f.splineDetail,f.strength,!1,f.float32Allocator),w=l.catmullRomSpline(b,h.length(),f.splineDetail,f.strength,!1,f.float32Allocator);u.setPerResidueColors(c,m);var S=f.radius*(h.residueAt(0).isAminoacid()?1:1.8),C=v(m,f.splineDetail);s.set(t,A[3]-A[0],A[4]-A[1],A[5]-A[2]),s.set(e,A[0],A[1],A[2]),s.set(r,w[0]-A[0],w[1]-A[0],w[2]-A[2]),s.normalize(t,t),s.normalize(r,r),a.set(n,C[0],C[1],C[2],C[3]);var E=y.numVerts();y.addVertex(e,[-t[0],-t[1],-t[2]],n,p[0]),N(y,e,r,h.residueAt(0).ss(),t,n,S,!0,f,0,p[0]),function(t,e,n){for(var r=0;n-1>r;++r)t.addTriangle(e,e+1+r,e+2+r);t.addTriangle(e,e+n,e+1)}(y,E,4*f.arcDetail);var R=y.numVerts(),x=0;u.addAssoc(c,y,x,E,R),x+=1;for(var T=Math.floor(f.splineDetail/2),F=l.catmullRomSplineNumPoints(h.length(),f.splineDetail,!1),D=4*f.arcDetail,P=1,V=F;V>P;++P){var L=3*P,O=4*P,k=3*(P+1),B=3*(P-1);s.set(e,A[L],A[L+1],A[L+2]),P===V-1?s.set(t,A[L]-A[B],A[L+1]-A[B+1],A[L+2]-A[B+2]):s.set(t,A[k]-A[B],A[k+1]-A[B+1],A[k+2]-A[B+2]),s.normalize(t,t),a.set(n,C[O],C[O+1],C[O+2],C[O+3]);var q=0,j=Math.floor(P/f.splineDetail),U=Math.floor((P-1)/f.splineDetail),z=Math.floor((P+f.arrowSkip)/f.splineDetail),W=!1,H=h.residueAt(j).ss();if(!f.forceTube){if(j!==U){var G=h.residueAt(U).ss();if("C"===G&&("H"===H||"E"===H)){s.set(i,w[B]-A[B],w[B+1]-A[B+1],w[B+2]-A[B+2]),s.normalize(i,i);var X=2*Math.PI/(4*f.arcDetail),Y=l.signedAngle(r,i,t);q=((q=Math.round(Y/X))+4*f.arcDetail)%(4*f.arcDetail)}}if(z!==j&&z<h.length()){var K=h.residueAt(z).ss();"C"===K&&"E"===H&&(W=!0)}}s.set(r,w[3*P]-A[L],w[L+1]-A[L+1],w[L+2]-A[L+2]),s.normalize(r,r),E=y.numVerts();var Q=Math.floor((P+T)/f.splineDetail),J=p[Math.min(p.length-1,Q)];N(y,e,r,H,t,n,S,!1,f,q,J);var $=P===V-1?1:D;y.numVerts()+$>y.maxVerts()&&(R=y.numVerts(),u.addAssoc(c,y,x,E,R),y=o.vertArrayWithSpaceFor($),E=0,N(y,e,r,H,t,n,S,!0,f,0,J)),W&&(u.addAssoc(c,y,x,E,R),N(y,e,r,"A",t,n,S,!1,f,0,J),P+=f.arrowSkip),R=y.numVerts(),P===V-1&&(R+=1),u.addAssoc(c,y,x,E,R),x+=1,W&&(x+=f.arrowSkip)}return y.addVertex(e,t,n,p[p.length-1]),function(t,e,n){for(var r=e+n,i=0;n-1>i;++i)t.addTriangle(r,e+i+1,e+i);t.addTriangle(r,e,e+n-1)}(y,E,4*f.arcDetail),f.float32Allocator.release(b),f.float32Allocator.release(_),c+1}}(),P=function(){var t=u.create(),e=s.create(),n=s.create(),r=s.create(),i=s.create(),o=s.create(),h=s.create(),c=a.fromValues(0,0,0,1),f=a.fromValues(0,0,0,1);return function(a,u,d,_,v){if(0!==d.length()){var m=v.idPool.getContinuousRange(d.length());a.addIdRange(m),v.color.colorFor(d.centralAtomAt(0),c,0);var b=T([d],v.protoSphere.numVerts(),v.protoCyl.numVerts()),p=b,g=a.vertArrayWithSpaceFor(b),y=g.maxVerts(),A=g.numVerts();d.posAt(o,0);var w=m.nextId({geom:a,atom:d.centralAtomAt(0)}),S=0;v.protoSphere.addTransformed(g,o,v.radius,c,w);var C=null;u.addAssoc(_,g,0,A,C);var E=v.float32Allocator.request(4*d.length());E[0]=c[0],E[1]=c[1],E[2]=c[2],E[3]=c[3];for(var R=v.protoCyl.numVerts()+v.protoSphere.numVerts(),x=1;x<d.length();++x){S=m.nextId({geom:a,atom:d.centralAtomAt(x)}),d.posAt(o,x-1),d.posAt(h,x),v.color.colorFor(d.centralAtomAt(x),f,0),E[4*x+0]=f[0],E[4*x+1]=f[1],E[4*x+2]=f[2],E[4*x+3]=f[3],s.sub(e,h,o);var M=s.length(e);s.scale(e,e,1/M),l.buildRotation(t,e,n,r,!1),s.copy(i,o),s.add(i,i,h),s.scale(i,i,.5),R>y-g.numVerts()&&(g=a.vertArrayWithSpaceFor(p)),p-=R;var F=g.numVerts();v.protoCyl.addTransformed(g,i,M,v.radius,t,c,f,w,S),C=g.numVerts(),C-=(C-F)/2,v.protoSphere.addTransformed(g,h,v.radius,f,S),w=S,u.addAssoc(_,g,x,A,C),A=C,s.copy(c,f)}u.setPerResidueColors(_,E),u.addAssoc(_,g,d.length()-1,A,g.numVerts())}}}();return m}(f,m,b,p),y=function(){function t(t,e,n,r,i,o){L.call(this,t);var s=o||{};this._={},this._.fillStyle=s.fillStyle||"#000",this._.backgroundAlpha=s.backgroundAlpha||0,this._.fontSize=s.fontSize||24,this._.font=s.font||"Verdana",this._.fontStyle=s.fontStyle||"normal",this._.fontColor=s.fontColor||"#000",this._cb=100,this._bu=r,this._ec=this._b.createBuffer(),this._g=new Float32Array(30),this._dT(e,n,i);var a=.5,u=.5;this._g[0]=r[0],this._g[1]=r[1],this._g[2]=r[2],this._g[3]=-a,this._g[4]=-u,this._g[5]=r[0],this._g[6]=r[1],this._g[7]=r[2],this._g[8]=a,this._g[9]=u,this._g[10]=r[0],this._g[11]=r[1],this._g[12]=r[2],this._g[13]=a,this._g[14]=-u,this._g[15]=r[0],this._g[16]=r[1],this._g[17]=r[2],this._g[18]=-a,this._g[19]=-u,this._g[20]=r[0],this._g[21]=r[1],this._g[22]=r[2],this._g[23]=-a,this._g[24]=u,this._g[25]=r[0],this._g[26]=r[1],this._g[27]=r[2],this._g[28]=a,this._g[29]=u}function e(t){for(var e=1;t>e;)e*=2;return e}return r.derive(t,L,{updateProjectionIntervals:function(){},updateSquaredSphereRadius:function(t,e){return e},_cN:function(t){t.fillStyle=this._.fontColor,t.textAlign="left",t.textBaseline="bottom",t.font=this._.fontStyle+" "+this._.fontSize+"px "+this._.font},_dT:function(t,n,r){this._cN(n);var i=n.measureText(r).width;t.width=e(i),t.height=e(24),n.fillStyle=this._.fillStyle,n.globalAlpha=this._.backgroundAlpha,n.fillRect(0,0,t.width,t.height),this._cN(n),n.globalAlpha=1,n.lineWidth=.5,n.lineStyle="none",n.fillText(r,0,t.height),n.strokeText(r,0,t.height),this._cJ=this._b.createTexture(),this._dH(this._cJ,t),this._dB=i/t.width,this._dA=24/t.height,this._k=i,this._l=24},_dH:function(t,e){var n=this._b;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0),n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.generateMipmap(n.TEXTURE_2D),n.bindTexture(n.TEXTURE_2D,null)},bind:function(){var t=this._b;t.bindBuffer(t.ARRAY_BUFFER,this._ec),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._cJ),this._p||(t.bufferData(t.ARRAY_BUFFER,this._g,t.STATIC_DRAW),this._p=!0)},draw:function(t,e,n,r){if(this._P&&"normal"===r){var i=e.text;t.bind(i),this.bind();var o=this._b,s=t.upsamplingFactor();o.uniform1f(o.getUniformLocation(i,"xScale"),this._dB),o.uniform1f(o.getUniformLocation(i,"yScale"),this._dA),o.uniform1f(o.getUniformLocation(i,"width"),2*s*this._k/t.viewportWidth()),o.uniform1f(o.getUniformLocation(i,"height"),2*s*this._l/t.viewportHeight()),o.uniform1i(o.getUniformLocation(i,"sampler"),0);var a=o.getAttribLocation(i,"attrCenter");o.enableVertexAttribArray(a),o.vertexAttribPointer(a,3,o.FLOAT,!1,20,0);var u=o.getAttribLocation(i,"attrCorner");o.vertexAttribPointer(u,2,o.FLOAT,!1,20,12),o.enableVertexAttribArray(u),o.enable(o.BLEND),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),o.drawArrays(o.TRIANGLES,0,6),o.disableVertexAttribArray(a),o.disableVertexAttribArray(u),o.disable(o.BLEND)}}}),t}(),A=function(n){function i(){this._e=[],this._D=[],this._x=0}function o(t,e,r,o,s){L.call(this,e),this._B=r,this._G=o,this._C=new i,this._dQ=new n.ProtoSphere(8,8),this._dR=new n.ProtoCylinder(8),this._W=null,this._3=[],this._ek=s,this._p=!1,this._bC=null}var s=t.vec3,a=t.mat3,u=e.forceRGB;return i.prototype={numVerts:function(){return this._x},addVertex:function(t,e,n,r){this._x+=1,this._e.push(t[0],t[1],t[2],e[0],e[1],e[2],n[0],n[1],n[2],n[3],r,0)},addTriangle:function(t,e,n){this._D.push(t,e,n)},numIndices:function(){return this._D.length},indexData:function(){return this._D},vertData:function(){return this._e}},r.derive(o,L,{updateProjectionIntervals:function(){},updateSquaredSphereRadius:function(t,e){return e},addTube:function(){var t=s.create(),e=s.create(),n=s.create(),r=s.create(),i=a.create();return function(o,a,h,c){var f=u((c=c||{}).color||"white"),d=!0;void 0!==c.cap&&(d=c.cap),s.sub(r,a,o);var _=s.length(r);if(s.normalize(r,r),s.add(t,o,a),s.scale(t,t,.5),l.buildRotation(i,r,e,n,!1),d){var v=this._C.numVerts();this._C.addVertex(o,[-r[0],-r[1],-r[2]],f,0),function(t,e,n){for(var r=0;n-1>r;++r)t.addTriangle(e,e+1+r,e+2+r);t.addTriangle(e,e+n,e+1)}(this._C,v,8)}var m=void 0!==c.userData?c.userData:null,b=this._c2({center:t,userData:m,geom:this});if(this._dR.addTransformed(this._C,t,_,h,i,f,f,b,b),d){var p=this._C.numVerts();this._C.addVertex(a,r,f,0),function(t,e,n){for(var r=e+n,i=0;n-1>i;++i)t.addTriangle(r,e+i+1,e+i);t.addTriangle(r,e,e+n-1)}(this._C,p-8,8)}this._p=!1}}(),_c2:function(t){return this._bC&&this._bC.hasLeft()||(this._bC=this._ek.getContinuousRange(100),this._3.push(this._bC)),this._bC.nextId(t)},destroy:function(){L.prototype.destroy.call(this);for(var t=0;t<this._3.length;++t)this._3[t].recycle()},addSphere:function(t,e,n){var r=u((n=n||{}).color||"white"),i=void 0!==n.userData?n.userData:null,o=this._c2({center:t,userData:i,geom:this});this._dQ.addTransformed(this._C,t,e,r,o),this._p=!1},_dS:function(){this._p=!0,null!==this._W&&this._W.destroy(),this._W=new k(this._b,this._C.numVerts(),this._C.numIndices(),this._B,this._G),this._W.setIndexData(this._C.indexData()),this._W.setVertData(this._C.vertData())},draw:function(t,e,n,r){if(this._P){this._p||this._dS();var i=this.shaderForStyleAndPass(e,n,r);if(i){t.bind(i),this._b.uniform1i(i.symId,255);var o=this._W;o.bind(i),o.draw(),o.releaseAttribs(i)}}},shaderForStyleAndPass:function(t,e,n){if("normal"===n)return"hemilight"===e?t.hemilight:t.phong;if("select"===n)return t.select;if("outline"===n)return t.outline;var r=t[n];return void 0!==r?r:null}}),o}(f),w=function(){function e(t,e,n){this._co=t,this._b1=e,this._bi=n,this._eK=n,this._bq=Date.now(),this._c8=!1,this._cq=!1}function n(t,n,r){e.call(this,u.clone(t),u.clone(n),r),this._T=u.clone(t)}function i(t,n,r){var i=c.create(),o=c.create();c.fromMat4(i,t),c.fromMat4(o,n);var s=h.create(),a=h.create();h.fromMat3(s,i),h.fromMat3(a,o),this._T=c.create(),e.call(this,s,a,r)}function o(t,n){e.call(this,null,null,n),this._bW=u.clone(t),this.setLooping(!0),this._cV=0}function s(t,n){var r=2*Math.PI/n*1e3;e.call(this,null,null,r),this._bW=u.clone(t),this.setLooping(!0),this._dL=n,this._cU=0}function a(){this._bn=[]}var u=t.vec3,h=t.quat,c=t.mat3;return e.prototype={setLooping:function(t){this._c8=t},step:function(t){var e,n=Date.now(),r=n-this._bq;if(0===this._bi)e=1;else if(this._c8){var i=Math.floor(r/this._bi);e=(r-i*this._bi)/this._bi}else r=Math.min(this._bi,r),e=r/this._bi,this._cq=1===e;return this.apply(t,e),this._cq},apply:function(t,e){var n=(1-Math.cos(e*Math.PI))/2;this._T=this._co*(1-n)+this._b1*n,t.setZoom(this._T)},finished:function(){return this._cq}},r.derive(n,e,{apply:function(t,e){var n=(1-Math.cos(e*Math.PI))/2;u.lerp(this._T,this._co,this._b1,n),t.setCenter(this._T)}}),r.derive(i,e,{apply:function(){var t=h.create();return function(e,n){h.slerp(t,this._co,this._b1,n),c.fromQuat(this._T,t),e.setRotation(this._T)}}()}),r.derive(o,e,{apply:function(){var t=c.create(),e=c.create();return function(n,r){c.fromMat4(e,n.rotation());var i=.2*Math.sin(2*r*Math.PI),o=i-this._cV;this._cV=i,l.axisRotation(t,this._bW,o),c.mul(e,t,e),n.setRotation(e)}}()}),r.derive(s,e,{apply:function(){var t=c.create(),e=c.create();return function(n,r){c.fromMat4(e,n.rotation());var i=2*Math.PI*(r-this._cU);this._cU=r,l.axisRotation(t,this._bW,i),c.mul(e,t,e),n.setRotation(e)}}(),setSpeed:function(t){this._dL=t},setAxis:function(t){this._bW=t}}),a.prototype={run:function(t){var e=Date.now();return this._bn=this._bn.filter(function(n){return!n.step(t,e)}),this._bn.length>0},add:function(t){this._bn.push(t)},remove:function(t){this._bn=this._bn.filter(function(e){return e!==t})}},{AnimationControl:a,move:function(t,e,r){return new n(t,e,r)},rotate:function(t,e,n){return new i(t,e,n)},zoom:function(t,n,r){return new e(t,n,r)},rockAndRoll:function(){return new o([0,1,0],2e3)},spin:function(t,e){return new s(t,e)}}}(),S=function(){function t(t,e){this.near=t,this.far=e}function e(t){t=t||{},this._bd=t.near||.1,this._5=t.far||400}function n(){this._5=100}return e.prototype.update=function(){return new t(this._bd,this._5)},n.prototype.update=function(e,n){for(var r=n.center(),i=null,o=0;o<e.length;++o){var s=e[o];s.visible()&&(i=s.updateSquaredSphereRadius(r,i))}if(null===i)return null;i=Math.sqrt(i);var a=n.zoom(),u=1.05*(i+a);return new t(.1,u)},{FixedSlab:e,AutoSlab:n,Slab:t}}(),C=function(n,i,o,s,a,u,h,c,l,f,d,_){function v(t,e){return"fixed"===(t=t||"auto")?new S.FixedSlab(e):"auto"===t?new S.AutoSlab(e):null}function m(t,e,n,r,i,o){this._bu=r,this._dJ=t,this._dW=e,this._dK=n,this._d8=i,this._d7=o}function b(t,e){this._=this._ef(e,t),this._bQ=!1,this._m=[],this._E=t,this._b6=!1,this._2=!1,this._d9=null,this._c1=new n,this._R=null,this._ba=null,this.listenerMap={},this._V=new _.AnimationControl,this._eg(),this._cj(),this.quality(this._.quality),null!==this._.click&&this.on("click",this._.click),null!==this._.doubleClicked&&this.on("doubleClick",this._.doubleClick),"complete"===document.readyState||"loaded"===document.readyState||"interactive"===document.readyState?this._dc():document.addEventListener("DOMContentLoaded",r.bind(this,this._dc))}function p(t,e,n){return e in t?t[e]:n}function g(t){return t.atomDoubleClick?t.atomDoubleClick:t.atomDoubleClicked?t.atomDoubleClicked:t.doubleClick?t.doubleClick:"center"}function y(t){return t.atomClick?t.atomClick:t.atomClicked?t.atomClicked:t.click?t.click:null}var A=t.vec3,w=t.mat4,C=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};return m.prototype={symIndex:function(){return this._dK},target:function(){return this._dJ},pos:function(){return this._bu},node:function(){return this._dW},transform:function(){return this._d7},object:function(){return this._d8}},b.prototype={_ef:function(t,n){var r={width:(t=t||{}).width||500,height:t.height||500,animateTime:t.animateTime||0,antialias:t.antialias,quality:p(t,"quality","low"),style:p(t,"style","hemilight"),background:e.forceRGB(t.background||"white"),slabMode:v(t.slabMode),outline:p(t,"outline",!0),outlineColor:e.forceRGB(p(t,"outlineColor","black")),outlineWidth:p(t,"outlineWidth",1.5),selectionColor:e.forceRGB(p(t,"selectionColor","#3f3")),fov:p(t,"fov",45),doubleClick:g(t),click:y(t),fog:p(t,"fog",!0),transparency:p(t,"transparency","alpha")},i=n.getBoundingClientRect();return"auto"===r.width&&(r.width=i.width),"auto"===r.height&&(r.height=i.height),r},_cs:function(){this._2&&(this._2=!1,this._d.setViewportSize(this._c.viewportWidth(),this._c.viewportHeight()),this._b9.resize(this._.width,this._.height))},resize:function(t,e){(t!==this._.width||e!==this._.height)&&(this._c.resize(t,e),this._2=!0,this._.width=t,this._.height=e,this.requestRedraw())},fitParent:function(){var t=this._E.getBoundingClientRect();this.resize(t.width,t.height)},gl:function(){return this._c.gl()},ok:function(){return this._bQ},options:function(t,n){if(void 0!==n)if(this._[t]=n,"fog"===t)this._d.fog(n),this.requestRedraw();else if("fov"===t)this._d.setFieldOfViewY(n*Math.PI/180);else if("selectionColor"===t)this._d.setSelectionColor(e.forceRGB(n));else if("outlineColor"===t)this._d.setOutlineColorColor(e.forceRGB(n));else if("outlineWidth"===t)this._d.setOutlineWidth(n+0);else if("transparency"===t){var r="screendoor"===n;this._d.setScreenDoorTransparency(r)}return this._[t]},quality:function(t){return this._.quality=t,"high"===t?(this._.arcDetail=4,this._.sphereDetail=16,void(this._.splineDetail=8)):"medium"===t?(this._.arcDetail=2,this._.sphereDetail=10,void(this._.splineDetail=5)):"low"===t?(this._.arcDetail=2,this._.sphereDetail=8,void(this._.splineDetail=3)):void 0},imageData:function(){return this._c.imageData()},_ee:function(){var t={width:this._.width,height:this._.height};this._b9=new o(this._c.gl(),t)},_dc:function(){if(!this._c.initGL())return this._E.removeChild(this._c.domElement()),this._E.innerHTML='<div style="vertical-align:middle; text-align:center;"><h1>WebGL not supported</h1><p>Your browser does not support WebGL. You might want to try Chrome, Firefox, IE 11, or newer versions of Safari</p><p>If you are using a recent version of one of the above browsers, your graphic card might be blocked. Check the browser documentation for details on how to unblock it.</p></div>',this._E.style.width=this._.width+"px",this._E.style.height=this._.height+"px",!1;this._ee(),this._eH=this._bJ.getContext("2d"),this._B=new s(Float32Array),this._G=new s(Uint16Array),this._d=new a(this._c.gl()),this._d.setUpsamplingFactor(this._c.superSamplingFactor()),this._d.setOutlineWidth(this._.outlineWidth);var t="screendoor"===this._.transparency;this._d.setScreenDoorTransparency(t),this._d.fog(this._.fog),this._d.setFogColor(this._.background),this._d.setOutlineColor(this._.outlineColor),this._d.setSelectionColor(this._.selectionColor),this._d.setFieldOfViewY(this._.fov*Math.PI/180),this._cc.setCam(this._d);var e=this._c,n=/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?"highp":"mediump";return this._dM={hemilight:e.initShader(u.HEMILIGHT_VS,u.PRELUDE_FS+u.HEMILIGHT_FS,n),phong:e.initShader(u.HEMILIGHT_VS,u.PRELUDE_FS+u.PHONG_FS,n),outline:e.initShader(u.OUTLINE_VS,u.PRELUDE_FS+u.OUTLINE_FS,n),lines:e.initShader(u.LINES_VS,u.PRELUDE_FS+u.LINES_FS,n),text:e.initShader(u.TEXT_VS,u.TEXT_FS,n),selectLines:e.initShader(u.SELECT_LINES_VS,u.SELECT_LINES_FS,n),select:e.initShader(u.SELECT_VS,u.SELECT_FS,n)},this._ew=r.bind(this,this._eo),this._eI=new h(this._c.domElement(),this,this._d),this._bQ||(this._bQ=!0,this._cv({name:"viewerReadyEvent"},"viewerReady",this)),!0},requestRedraw:function(){this._b6||(this._b6=!0,C(this._ew))},boundingClientRect:function(){return this._c.domElement().getBoundingClientRect()},_ct:function(t){for(var e=0,n=this._m.length;e!==n;++e)this._m[e].draw(this._d,this._dM,this._.style,t)},_eg:function(){var t=document.createElement("div");t.setAttribute("style","overflow:hidden;width:0;height:0"),this._by=document.createElement("textarea"),this._E.appendChild(t),t.appendChild(this._by),this._by.focus()},focus:function(){this._by.focus()},_cj:function(){var t={antialias:this._.antialias,height:this._.height,width:this._.width,backgroundColor:this._.background};this._c=new i.Canvas(this._E,t),this._bJ=document.createElement("canvas"),this._bJ.style.display="none",this._E.appendChild(this._bJ),this._cc=new c(this._c,this,this._d,this._.animateTime),this._c.domElement().addEventListener("mousedown",r.bind(this,this._el))},_el:function(){this._by.focus()},setRotation:function(t,e){if(0==(e|=0))return this._d.setRotation(t),void this.requestRedraw();var n;9===t.length?(n=w.create(),w.fromMat3(n,t)):n=w.clone(t),this._V.add(_.rotate(this._d.rotation(),n,e)),this.requestRedraw()},setCamera:function(t,e,n,r){r|=0,this.setCenter(e,r),this.setRotation(t,r),this.setZoom(n,r)},_ez:function(){var t=this._V.run(this._d);t&&this.requestRedraw()},_eo:function(){if(null!==this._c){this._b6=!1,this._ez(),this._c.bind(),this._cs();var t=this._c.gl();t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT);var e=this._.slabMode.update(this._m,this._d);null!==e&&this._d.setNearFar(e.near,e.far),t.enable(t.CULL_FACE),this._.outline&&(t.cullFace(t.BACK),t.enable(t.CULL_FACE),this._ct("outline")),t.cullFace(t.FRONT),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this._ct("normal")}},setCenter:function(t,e){return 0==(e|=0)?void this._d.setCenter(t):(this._V.add(_.move(this._d.center(),A.clone(t),e)),void this.requestRedraw())},setZoom:function(t,e){return 0==(e|=0)?void this._d.setZoom(t):(this._V.add(_.zoom(this._d.zoom(),t,e)),void this.requestRedraw())},centerOn:function(t,e){this.setCenter(t.center(),e)},clear:function(){for(var t=0;t<this._m.length;++t)this._m[t].destroy();this._m=[]},addListener:function(t,e){if("keypress"===t||"keydown"===t||"keyup"===t)this._by.addEventListener(t,e,!1);else{var n=this.listenerMap[t];if(void 0===n&&(n=[],this.listenerMap[t]=n),"center"===e){var i=r.bind(this._cc,this._cc._es);n.push(i)}else n.push(e);this._bQ&&"viewerReady"===t&&e(this,null)}},_cv:function(t,e,n){var r=this.listenerMap[e];r&&r.forEach(function(e){e(n,t)})},RENDER_MODES:["sline","lines","trace","lineTrace","cartoon","tube","spheres","ballsAndSticks","points"],renderAs:function(t,e,n,r){for(var i=!1,o=0;o<this.RENDER_MODES.length;++o)if(this.RENDER_MODES[o]===n){i=!0;break}return i?this[n](t,e,r):void 0},_S:function(t,e){return(t=this._cm(t)).showRelated=t.showRelated||"asym",t.showRelated&&"asym"!==t.showRelated&&null===e.assembly(t.showRelated)&&(t.showRelated="asym"),t},_cm:function(t){return(t=r.copy(t)).float32Allocator=this._B,t.uint16Allocator=this._G,t.idPool=this._c1,t},lineTrace:function(t,n,r){var i=this._S(r,n);i.color=i.color||e.uniform([1,0,1]),i.lineWidth=i.lineWidth||4;var o=l.lineTrace(n,this._c.gl(),i);return this.add(t,o)},spheres:function(t,n,r){var i=this._S(r,n);i.color=i.color||e.byElement(),i.sphereDetail=this.options("sphereDetail"),i.radiusMultiplier=i.radiusMultiplier||1;var o=l.spheres(n,this._c.gl(),i);return this.add(t,o)},sline:function(t,n,r){var i=this._S(r,n);i.color=i.color||e.uniform([1,0,1]),i.splineDetail=i.splineDetail||this.options("splineDetail"),i.strength=i.strength||1,i.lineWidth=i.lineWidth||4;var o=l.sline(n,this._c.gl(),i);return this.add(t,o)},cartoon:function(t,n,r){var i=this._S(r,n);i.color=i.color||e.bySS(),i.strength=i.strength||1,i.splineDetail=i.splineDetail||this.options("splineDetail"),i.arcDetail=i.arcDetail||this.options("arcDetail"),i.radius=i.radius||.3,i.forceTube=i.forceTube||!1;var o=l.cartoon(n,this._c.gl(),i),s=this.add(t,o);return s},surface:function(t,e,n){var r=this._cm(n),i=l.surface(e,this._c.gl(),r);return this.add(t,i)},tube:function(t,e,n){return(n=n||{}).forceTube=!0,this.cartoon(t,e,n)},ballsAndSticks:function(t,n,r){var i=this._S(r,n);i.color=i.color||e.byElement(),i.radius=i.radius||.3,i.arcDetail=2*(i.arcDetail||this.options("arcDetail")),i.sphereDetail=i.sphereDetail||this.options("sphereDetail");var o=l.ballsAndSticks(n,this._c.gl(),i);return this.add(t,o)},lines:function(t,n,r){var i=this._S(r,n);i.color=i.color||e.byElement(),i.lineWidth=i.lineWidth||4;var o=l.lines(n,this._c.gl(),i);return this.add(t,o)},points:function(t,n,r){var i=this._S(r,n);i.color=i.color||e.byElement(),i.pointSize=i.pointSize||1;var o=l.points(n,this._c.gl(),i);return this.add(t,o)},trace:function(t,n,r){var i=this._S(r,n);i.color=i.color||e.uniform([1,0,0]),i.radius=i.radius||.3,i.arcDetail=2*(i.arcDetail||this.options("arcDetail")),i.sphereDetail=i.sphereDetail||this.options("sphereDetail");var o=l.trace(n,this._c.gl(),i);return this.add(t,o)},_cF:function(t,e,n){n.eachAtom(function(n){for(var r=n.pos(),i=0;3>i;++i)e[i].update(A.dot(r,t[i]))});for(var r=0;3>r;++r)e[r].extend(1.5)},fitTo:function(t){var e=this._d.mainAxes(),n=[new r.Range,new r.Range,new r.Range];if(t instanceof L)t.updateProjectionIntervals(e[0],e[1],e[2],n[0],n[1],n[2]);else if(void 0!==t.eachAtom)this._cF(e,n,t);else if(void 0!==t.length)for(var i=0;i<t.length;++i)this._cF(e,n,t[i]);this._dl(e,n)},_dl:function(t,e){if(!(e[0].empty()||e[1].empty()||e[2].empty())){var n=e[0].center(),r=e[1].center(),i=e[2].center(),o=[n*t[0][0]+r*t[1][0]+i*t[2][0],n*t[0][1]+r*t[1][1]+i*t[2][1],n*t[0][2]+r*t[1][2]+i*t[2][2]],s=this._d.fieldOfViewY(),a=this._d.aspectRatio(),u=e[0].length()/a,h=e[1].length(),c=.5*Math.max(u,h),l=c/Math.tan(.5*s),f=l+.5*e[2].length(),d=Math.max(l-.5,.1),_=1+l+e[2].length();this._d.setNearFar(d,_),this.setCamera(this._d.rotation(),o,f,this._.animateTime),this.requestRedraw()}},autoZoom:function(){var t=this._d.mainAxes(),e=[new r.Range,new r.Range,new r.Range];this.forEach(function(n){n.visible()&&n.updateProjectionIntervals(t[0],t[1],t[2],e[0],e[1],e[2])}),this._dl(t,e)},slabInterval:function(){},autoSlab:function(){var t=this._._eJ.update(this._m,this._d);null!==t&&this._d.setNearFar(t.near,t.far),this.requestRedraw()},rockAndRoll:function(t){return void 0===t?null!==this._ba:t?(null===this._ba&&(this._ba=_.rockAndRoll(),this._V.add(this._ba),this.requestRedraw()),!0):(this._V.remove(this._ba),this._ba=null,this.requestRedraw(),!1)},spin:function(t,e){return void 0===t?null!==this._R:!1===t?(this._V.remove(this._R),this._R=null,this.requestRedraw(),!1):(!0===t&&(t=Math.PI/8),e=e||[0,1,0],null===this._R?(this._R=_.spin(e,t),this._V.add(this._R)):(this._R.setSpeed(t),this._R.setAxis(e)),this.requestRedraw(),!0)},slabMode:function(t,e){var n=v(t,e=e||{}),r=n.update(this._m,this._d);null!==r&&this._d.setNearFar(r.near,r.far),this._.slabMode=n,this.requestRedraw()},label:function(t,e,n,r){var i=new f(this._c.gl(),this._bJ,this._eH,n,e,r);return this.add(t,i),i},customMesh:function(t,e){var n=this._cm(e),r=new d(t,this._c.gl(),n.float32Allocator,n.uint16Allocator,n.idPool);return this.add(t,r),r},_en:function(){var t=this._c.gl();t.clearColor(0,0,0,0),t.disable(t.BLEND),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.clearColor(this._.background[0],this._.background[1],this._.background[2],1),t.cullFace(t.FRONT),t.enable(t.CULL_FACE),this._ct("select")},pick:function(t){this._b9.bind(),this._en();var e=new Uint8Array(4),n=this._c.gl();n.readPixels(t.x,this._.height-t.y,1,1,n.RGBA,n.UNSIGNED_BYTE,e),this._b9.release(),e.data&&(e=e.data);var r=e[0]|e[1]<<8|e[2]<<16,i=e[3],o=this._c1.objectForId(r);if(void 0===o)return null;var s=A.create(),a=null,u=null;return 255!==i?(a=o.atom,u=o.geom.symWithIndex(i),A.transformMat4(s,o.atom.pos(),u)):void 0!==o.atom?(a=o.atom,s=o.atom.pos()):(a=o.userData,s=o.center),new m(a,o.geom,255>i?i:null,s,o,u)},add:function(t,e){return e.name(t),this._m.push(e),this._m.sort(function(t,e){return t.order()-e.order()}),this.requestRedraw(),e},_df:function(t){var e=t.replace(".","\\.").replace("*",".*");return new RegExp("^"+e+"$")},forEach:function(){var t,e="*";2===arguments.length?(t=arguments[1],e=arguments[0]):t=arguments[0];for(var n=this._df(e),r=0;r<this._m.length;++r){var i=this._m[r];n.test(i.name())&&t(i,r)}},get:function(t){for(var e=0;e<this._m.length;++e)if(this._m[e].name()===t)return this._m[e];return null},hide:function(t){this.forEach(t,function(t){t.hide()})},show:function(t){this.forEach(t,function(t){t.show()})},rm:function(t){for(var e=[],n=this._df(t),r=0;r<this._m.length;++r){var i=this._m[r];n.test(i.name())?i.destroy():e.push(i)}this._m=e},all:function(){return this._m},isWebGLSupported:function(){return this._c.isWebGLSupported()},destroy:function(){this.clear(),this._c.destroy(),this._c=null}},b.prototype.on=b.prototype.addListener,{Viewer:function(t,e){return new b(t,e)},isWebGLSupported:i.isWebGLSupported}}(n,i,o,s,a,u,h,c,g,y,A,w),E=function(){function t(t,e){this._j=t||[],this._cd=e||[]}function e(t){this._I=t,this._cn=[]}return t.prototype={addChain:function(t){this._j.push(t)},chains:function(){return this._j},addMatrix:function(t){this._cd.push(t)},matrices:function(){return this._cd},matrix:function(t){return this._cd[t]}},e.prototype={name:function(){return this._I},generators:function(){return this._cn},generator:function(t){return this._cn[t]},addGenerator:function(t){this._cn.push(t)}},{SymGenerator:t,Assembly:e}}(),R=function(){function e(){}function n(t,n,r,i,o,s,a,u){e.call(this),this._v=t,this._cA=[],this._eb=!!s,this._I=n,this._bu=r,this._ck=o,this._bh=i,this._dU=void 0!==a?a:null,this._dI=void 0!==u?u:null}function i(t,n){e.call(this),this._dO=t,this._K=n,this._cA=[]}var o=t.vec3;return e.prototype={bondCount:function(){return this.bonds().length},eachBond:function(t){for(var e=this.bonds(),n=0,r=e.length;r>n;++n)t(e[n])},isConnectedTo:function(t){if(null===t)return!1;for(var e=t.full(),n=this.full(),r=this.bonds(),i=0,o=r.length;o>i;++i){var s=r[i];if(s.atom_one()===n&&s.atom_two()===e||s.atom_one()===e&&s.atom_two()===n)return!0}return!1}},r.derive(n,e,{addBond:function(t){this._cA.push(t)},name:function(){return this._I},bonds:function(){return this._cA},residue:function(){return this._v},structure:function(){return this._v.structure()},full:function(){return this},qualifiedName:function(){return this.residue().qualifiedName()+"."+this.name()},pos:function(){return this._bu},setPos:function(t){o.copy(this._bu,t)},element:function(){return this._bh},index:function(){return this._ck},prop:function(t){return this[t]()},occupancy:function(){return this._dU},tempFactor:function(){return this._dI},isHetatm:function(){return this._eb}}),r.derive(i,e,{full:function(){return this._K},name:function(){return this._K.name()},pos:function(){return this._K.pos()},element:function(){return this._K.element()},residue:function(){return this._dO},bonds:function(){return this._K.bonds()},index:function(){return this._K.index()},occupancy:function(){return this._K.occupancy()},tempFactor:function(){return this._K.tempFactor()},qualifiedName:function(){return this._K.qualifiedName()},isHetatm:function(){return this._K.isHetatm()}}),{Atom:n,AtomView:i}}(),x=function(e){function n(){}function i(t,e,r,i){n.call(this),this._I=e,this._dV=r,this._ed=i,this._r=[],this._cK="C",this._J=t,this._da=!1,this._c9=!1,this._ck=t.residues().length}function o(t,e){n.call(this),this._er=t,this._r=[],this._v=e}var s=t.vec3,a=e.Atom,u=e.AtomView;return n.prototype={prop:function(t){return this[t]()},isWater:function(){return"HOH"===this.name()||"DOD"===this.name()},eachAtom:function(t,e){e|=0;for(var n=0;n<this._r.length;n+=1){if(!1===t(this._r[n],e))return!1;e+=1}return e},qualifiedName:function(){var t=this.chain().name()+"."+this.name()+this.num();return"\0"===this.insCode()?t:t+this.insCode()},atom:function(t){if("string"==typeof t){for(var e=0;e<this._r.length;++e)if(this._r[e].name()===t)return this._r[e];return null}return t>=this._r.length&&0>t?null:this._r[t]},centralAtom:function(){return this.isAminoacid()?this.atom("CA"):this.isNucleotide()?this.atom("C3'"):null},center:function(){var t=0,e=s.create();return this.eachAtom(function(n){s.add(e,e,n.pos()),t+=1}),t>0&&s.scale(e,e,1/t),e},isAminoacid:function(){return this._da},isNucleotide:function(){return this._c9}},r.derive(i,n,{_ep:function(){this._c9=null!==this.atom("P")&&null!==this.atom("C3'"),this._da=null!==this.atom("N")&&null!==this.atom("CA")&&null!==this.atom("C")&&null!==this.atom("O")},name:function(){return this._I},insCode:function(){return this._ed},num:function(){return this._dV},full:function(){return this},addAtom:function(t,e,n,r,i,o){var s=new a(this,t,e,n,this.structure().nextAtomIndex(),r,i,o);return this._r.push(s),s},ss:function(){return this._cK},setSS:function(t){this._cK=t},index:function(){return this._ck},atoms:function(){return this._r},chain:function(){return this._J},structure:function(){return this._J.structure()}}),r.derive(o,n,{addAtom:function(t,e){if(e)for(var n=0;n<this._r.length;++n){var r=this._r[n];if(r.index()===t.index())return r}var i=new u(this,t.full());return this._r.push(i),i},removeAtom:function(t){var e=this._r.length;return this._r=this._r.filter(function(e){return e.index()!==t.index()}),e!==this._r.length},full:function(){return this._v},num:function(){return this._v.num()},insCode:function(){return this._v.insCode()},ss:function(){return this._v.ss()},index:function(){return this._v.index()},chain:function(){return this._er},name:function(){return this._v.name()},atoms:function(){return this._r},qualifiedName:function(){return this._v.qualifiedName()},containsResidue:function(t){return this._v.full()===t.full()},isAminoacid:function(){return this._v.isAminoacid()},isNucleotide:function(){return this._v.isNucleotide()},isWater:function(){return this._v.isWater()}}),{ResidueView:o,Residue:i}}(R),T=function(){function e(){this._u=[]}function n(t,e,n){this._bR=t,this._4=e,this._dg=n,this._ch=0===this._4,this._ci=this._bR.length()===this._dg;var r=this._dg-this._4;this._ci||++r,this._ch||(++r,this._4-=1),this._cf=r}var r=t.vec3;return e.prototype={push:function(t){this._u.push(t)},length:function(){return this._u.length},residueAt:function(t){return this._u[t]},posAt:function(t,e){return r.copy(t,this._u[e].centralAtom().pos()),t},normalAt:function(t,e){var n=this._u[e];return n.isAminoacid()&&r.sub(t,n.atom("O").pos(),n.atom("C").pos()),r.normalize(t,t),t},centralAtomAt:function(t){return this._u[t].centralAtom()},tangentAt:function(){var t=r.create(),e=r.create();return function(n,i){i>0?this.posAt(t,i-1):this.posAt(t,i),i<this._u.length-1?this.posAt(e,i+1):this.posAt(e,i),r.sub(n,e,t)}}(),fullTraceIndex:function(t){return t},subsets:function(t){for(var e=0,r=0,i=[];r<t.length&&e<this._u.length;){for(var o=t[r].full().index();this._u.length>e&&this._u[e].index()<o;)++e;if(e>=this._u.length)break;for(var s=this._u[e].index();t.length>r&&t[r].full().index()<s;)++r;if(r>=t.length)break;for(var a=e;t.length>r&&this._u.length>e&&t[r].full().index()===this._u[e].index();)++r,++e;var u=e;i.push(new n(this,a,u))}return i}},e.prototype.smoothPosAt=e.prototype.posAt,e.prototype.smoothNormalAt=e.prototype.normalAt,n.prototype={length:function(){return this._cf},residueAt:function(t){return this._bR.residueAt(this._4+t)},_db:function(){var t=r.create(),e=r.create();return function(n,i,o,s){return this.tangentAt(t,i),this.tangentAt(e,o),r.scale(t,t,s),r.scale(e,e,s),l.cubicHermiteInterpolate(n,this.centralAtomAt(i).pos(),t,this.centralAtomAt(o).pos(),e,.5,0),n}}(),smoothPosAt:function(t,e,n){if(0===e&&!this._ch)return this._db(t,e,e+1,n);if(e===this._cf-1&&!this._ci)return this._db(t,e-1,e,n);var i=this.centralAtomAt(e);return r.copy(t,i.pos()),t},smoothNormalAt:function(t,e){return this._bR.normalAt(t,e+this._4),t},posAt:function(t,e){var n=this.centralAtomAt(e),i=null;return r.copy(t,n.pos()),0!==e||this._ch||(i=this.centralAtomAt(e+1),r.add(t,t,i.pos()),r.scale(t,t,.5)),e!==this._cf-1||this._ci||(i=this.centralAtomAt(e-1),r.add(t,t,i.pos()),r.scale(t,t,.5)),t},centralAtomAt:function(t){return this.residueAt(t).centralAtom()},fullTraceIndex:function(t){return this._4+t},tangentAt:function(t,e){return this._bR.tangentAt(t,e+this._4)}},{TraceSubset:n,BackboneTrace:e}}(),M=function(e,n){function i(t,e){return t<<8|e.charCodeAt(0)}function o(t,e){return t.num()<e.num()}function s(t){return{num:function(){return t}}}function a(){}function u(t,e){a.call(this),this._i=t,this._I=e,this._bm=[],this._q=[],this._1=!0}function h(t,e,n){var r,i;if(t?(r=e.atom("C"),i=n.atom("N")):(r=e.atom("O3'"),i=n.atom("P")),r.isConnectedTo(i))return!1;var o=d.sqrDist(r.pos(),i.pos());return Math.abs(o-2.25)>1}function c(t,e){e.length()<2||t.push(e)}function l(t,e,n){if(0===t.length)return!0;if(!e)return!1;var r=i(n.num(),n.insCode()),o=t[t.length-1],s=i(o.num(),o.insCode());return r>s}function f(t,e){a.call(this),this._J=e,this._q=[],this._d6=t,this._bs={},this._1=!0}var d=t.vec3,_=e.Residue,v=e.ResidueView;return a.prototype={eachAtom:function(t,e){e|=0;for(var n=0;n<this._q.length;n+=1)if(!1===(e=this._q[n].eachAtom(t,e)))return!1;return e},atomCount:function(){for(var t=0,e=this.residues(),n=0;n<e.length;++n)t+=e[n].atoms().length;return t},eachResidue:function(t){for(var e=0;e<this._q.length;e+=1)if(!1===t(this._q[e]))return!1},residues:function(){return this._q},structure:function(){return this._i},asView:function(){var t=this.structure().createEmptyView();return t.addChain(this,!0),t},residueByRnum:function(t){var e=this.residues();if(this._1){var n=r.binarySearch(e,s(t),o);return-1===n?null:e[n]}for(var i=0;i<e.length;++i)if(e[i].num()===t)return e[i];return null},residuesInRnumRange:function(t,e){var n,i,a=[],u=this.residues();if(!0===this._1){var h=r.indexFirstLargerEqualThan(u,s(t),o);if(-1===h)return a;var c=r.indexLastSmallerEqualThan(u,s(e),o);if(-1===c)return a;for(n=h;c>=n;++n)a.push(this._q[n])}else for(n=0,i=u.length;n!==i;++n){var l=u[n];l.num()>=t&&l.num()<=e&&a.push(l)}return a},prop:function(t){return this[t]()}},r.derive(u,a,{name:function(){return this._I},full:function(){return this},addResidue:function(t,e,n){var r=new _(this,t,e,n=n||"\0");return this._1=l(this._q,this._1,r),this._q.push(r),r},assignSS:function(t,e,n){for(var r=i(t[0],t[1]),o=i(e[0],e[1]),s=1;s<this._q.length-1;++s){var a=this._q[s],u=i(a.num(),a.insCode());r>=u||u>=o||a.setSS(n)}},eachBackboneTrace:function(t){this._eu();for(var e=0;e<this._bm.length;++e)t(this._bm[e])},_eu:function(){if(!(this._bm.length>0)){for(var t=new n.BackboneTrace,e=null,r=0;r<this._q.length;r+=1){var i=this._q[r],o=i.isAminoacid(),s=i.isNucleotide();if(!0===e&&!o||!1===e&&!s||null===e&&!s&&!o)c(this._bm,t),e=null,t=new n.BackboneTrace;else if(0!==t.length()){var a=this._q[r-1];h(e,a,i)&&(c(this._bm,t),t=new n.BackboneTrace),t.push(i)}else t.push(i),e=i.isAminoacid()}c(this._bm,t)}},backboneTraces:function(){var t=[];return this.eachBackboneTrace(function(e){t.push(e)}),t}}),r.derive(f,a,{addResidue:function(t,e){var n=new v(this,t.full());if(this._1=l(this._q,this._1,t),this._q.push(n),this._bs[t.full().index()]=n,e)for(var r=t.atoms(),i=0;i<r.length;++i)n.addAtom(r[i].full(),!1);return n},addAtom:function(t){var e=this._bs[t.residue().full().index()];return void 0===e&&(e=this.addResidue(t.residue())),e.addAtom(t,!0)},removeAtom:function(t,e){var n=this._bs[t.residue().full().index()];if(void 0===n)return!1;var r=n.removeAtom(t);return r&&0===n.atoms().length&&e&&(delete this._bs[t.residue().full().index()],this._q=this._q.filter(function(t){return t!==n})),r},containsResidue:function(t){var e=this._bs[t.full().index()];return void 0!==e&&e.full()===t.full()},eachBackboneTrace:function(t){for(var e=this._J.backboneTraces(),n=0;n<e.length;++n)for(var r=e[n].subsets(this._q),i=0;i<r.length;++i)t(r[i])},backboneTraces:function(){var t=[];return this.eachBackboneTrace(function(e){t.push(e)}),t},full:function(){return this._J},name:function(){return this._J.name()},structure:function(){return this._d6}}),{Chain:u,ChainView:f}}(x,T),F=function(){var e=t.vec3;return{Bond:function(t,n){var r={atom_one:t,atom_two:n};return{atom_one:function(){return r.atom_one},atom_two:function(){return r.atom_two},mid_point:function(t){return t||(t=e.create()),e.add(t,r.atom_one.pos(),r.atom_two.pos()),e.scale(t,t,.5),t}}}}}(),N=function(){function t(t,e){for(var n=0;n<e.length;++n)if(!e[n](t))return!1;return!0}function e(t,e){var n=t.residues();e.rnumRange&&(n=t.residuesInRnumRange(e.rnumRange[0],e.rnumRange[1]));var r,i,o=[];if(void 0!==e.rindexRange){for(r=e.rindexRange[0],i=Math.min(n.length-1,e.rindexRange[1]);i>=r;++r)o.push(n[r]);return o}if(e.rindices&&void 0!==e.rindices.length){for(o=[],r=0;r<e.rindices.length;++r)o.push(n[e.rindices[r]]);return o}return n}return{dict:function(n,r,i){var o=function(t){var e=[];if(void 0!==t.rname&&e.push(function(e){return e.name()===t.rname}),void 0!==t.rnames&&e.push(function(e){for(var n=e.name(),r=0;r<t.rnames.length;++r)if(n===t.rnames[r])return!0;return!1}),void 0!==t.rnums){for(var n={},r=0;r<t.rnums.length;++r)n[t.rnums[r]]=!0;e.push(function(t){var e=t.num();return!0===n[e]})}return void 0!==t.rnum&&e.push(function(e){return e.num()===t.rnum}),e}(i),s=function(t){var e=[];return void 0!==t.aname&&e.push(function(e){return e.name()===t.aname}),void 0!==t.hetatm&&e.push(function(e){return e.isHetatm()===t.hetatm}),void 0!==t.anames&&e.push(function(e){for(var n=e.name(),r=0;r<t.anames.length;++r)if(n===t.anames[r])return!0;return!1}),e}(i),a=function(t){var e=[];return void 0!==t.cname&&(t.chain=t.cname),void 0!==t.cnames&&(t.chains=t.cnames),void 0!==t.chain&&e.push(function(e){return e.name()===t.chain}),void 0!==t.chains&&e.push(function(e){for(var n=e.name(),r=0;r<t.chains.length;++r)if(n===t.chains[r])return!0;return!1}),e}(i);i.rindex&&(i.rindices=[i.rindex]);for(var u=0;u<n._j.length;++u){var h=n._j[u];if(t(h,a))for(var c=e(h,i),l=null,f=0;f<c.length;++f)if(t(c[f],o)){l||(l=r.addChain(h,!1));for(var d=null,_=c[f].atoms(),v=0;v<_.length;++v)t(_[v],s)&&(d||(d=l.addResidue(c[f],!1)),d.addAtom(_[v]))}}return r}}}(),q=function(e,n,i){function o(t){var e=_[t.toUpperCase()];return void 0!==e?e:1.5}function s(){}function a(){s.call(this),this._j=[],this._O=[],this._c3=0}function u(t){s.call(this),this._c5=t,this._j=[]}var h=t.vec3,c=e.Chain,f=e.ChainView,d=n.Bond,_={H:.31,HE:.28,LI:1.28,BE:.96,B:.84,C:.76,N:.71,O:.66,F:.57,NE:.58,NA:1.66,MG:1.41,AL:1.21,SI:1.11,P:1.07,S:1.05,CL:1.02,AR:1.06,K:2.03,CA:1.76,SC:1.7,TI:1.6,V:1.53,CR:1.39,MN:1.39,FE:1.32,CO:1.26,NI:1.24,CU:1.32,ZN:1.22,GA:1.22,GE:1.2,AS:1.19,SE:1.2,BR:1.2,KR:1.16,RB:2.2,SR:1.95,Y:1.9,ZR:1.75,NB:1.64,MO:1.54,TC:1.47,RU:1.46,RH:1.42,PD:1.39,AG:1.45,CD:1.44,IN:1.42,SN:1.39,SB:1.39,TE:1.38,I:1.39,XE:1.4,CS:2.44,BA:2.15,LA:2.07,CE:2.04,PR:2.03,ND:2.01,PM:1.99,SM:1.98,EU:1.98,GD:1.96,TB:1.94,DY:1.92,HO:1.92,ER:1.89,TM:1.9,YB:1.87,LU:1.87,HF:1.75,TA:1.7,W:1.62,RE:1.51,OS:1.44,IR:1.41,PT:1.36,AU:1.36,HG:1.32,TL:1.45,PB:1.46,BI:1.48,PO:1.4,AT:1.5,RN:1.5,FR:2.6,RA:2.21,AC:2.15,TH:2.06,PA:2,U:1.96,NP:1.9,PU:1.87,AM:1.8,CM:1.69};return s.prototype={eachResidue:function(t){for(var e=0;e<this._j.length;e+=1)if(!1===this._j[e].eachResidue(t))return!1},eachAtom:function(t,e){e|=0;for(var n=0;n<this._j.length;n+=1)if(!1===(e=this._j[n].eachAtom(t,e)))return!1},residueCount:function(){for(var t=this.chains(),e=0,n=0;n<t.length;++n)e+=t[n].residues().length;return e},eachChain:function(t){for(var e=this.chains(),n=0;n<e.length;++n)if(!1===t(e[n]))return},atomCount:function(){for(var t=this.chains(),e=0,n=0;n<t.length;++n)e+=t[n].atomCount();return e},atoms:function(){var t=[];return this.eachAtom(function(e){t.push(e)}),t},atom:function(t){var e=t.split("."),n=this.chain(e[0]);if(null===n)return null;var r=n.residueByRnum(parseInt(e[1],10));return null===r?null:r.atom(e[2])},center:function(){var t=h.create(),e=0;return this.eachAtom(function(n){h.add(t,t,n.pos()),e+=1}),e&&h.scale(t,t,1/e),t},boundingSphere:function(){var t=this.center(),e=0;return this.eachAtom(function(n){e=Math.max(e,h.sqrDist(t,n.pos()))}),new l.Sphere(t,Math.sqrt(e))},backboneTraces:function(){for(var t=this.chains(),e=[],n=0;n<t.length;++n)Array.prototype.push.apply(e,t[n].backboneTraces());return e},select:function(t){return"protein"===t?this.residueSelect(function(t){return t.isAminoacid()}):"water"===t?this.residueSelect(function(t){return t.isWater()}):"ligand"===t?this.residueSelect(function(t){return!t.isAminoacid()&&!t.isWater()}):i.dict(this,new u(this),t||{})},residueSelect:function(t){for(var e=new u(this.full()),n=0;n<this._j.length;++n)for(var r=this._j[n],i=null,o=r.residues(),s=0;s<o.length;++s)t(o[s])&&(i||(i=e.addChain(r,!1)),i.addResidue(o[s],!0));return e},atomSelect:function(t){for(var e=new u(this.full()),n=0;n<this._j.length;++n)for(var r=this._j[n],i=null,o=r.residues(),s=0;s<o.length;++s)for(var a=null,h=o[s],c=h.atoms(),l=0;l<c.length;++l)t(c[l])&&(i||(i=e.addChain(r,!1)),a||(a=i.addResidue(h,!1)),a.addAtom(c[l]));return e},assembly:function(t){for(var e=this.assemblies(),n=0;n<e.length;++n)if(e[n].name()===t)return e[n];return null},chainsByName:function(t){for(var e={},n=this.chains(),r=0;r<n.length;++r)e[n[r].name()]=n[r];for(var i=[],o=0;o<t.length;++o){var s=e[t[o]];void 0!==s&&i.push(s)}return i},selectWithin:function(){var t=h.create();return function(e,n){var r=(n=n||{}).radius||4,i=r*r,o=!!n.matchResidues,s=[];e.eachAtom(function(t){s.push(t)});for(var a=new u(this.full()),c=null,l=null,f=this.chains(),d=!1,_=0;_<f.length;++_){var v=f[_].residues();l=null;for(var m=0;m<v.length;++m){c=null,d=!1;for(var b=v[m].atoms(),p=0;p<b.length&&!d;++p)for(var g=0;g<s.length;++g)if(h.sub(t,b[p].pos(),s[g].pos()),!(h.sqrLen(t)>i)){if(l||(l=a.addChain(f[_].full(),!1)),c||(c=l.addResidue(v[m].full(),o)),o){d=!0;break}c.addAtom(b[p].full());break}}}return a}}(),createEmptyView:function(){return new u(this.full())}},r.derive(a,s,{addAssembly:function(t){this._O.push(t)},setAssemblies:function(t){this._O=t},assemblies:function(){return this._O},chains:function(){return this._j},full:function(){return this},containsResidue:function(t){return t.full().structure()===this},chainByName:function(t){for(var e=0;e<this._j.length;++e)if(this._j[e].name()===t)return this._j[e];return null},chain:function(t){return this.chainByName(t)},nextAtomIndex:function(){var t=this._c3;return this._c3+=1,t},addChain:function(t){var e=new c(this,t);return this._j.push(e),e},connect:function(t,e){var n=new d(t,e);return t.addBond(n),e.addBond(n),n},deriveConnectivity:function(){var t=this,e=null;this.eachResidue(function(n){for(var r,i=n.atoms(),s=i.length,a=0;s>a;a+=1)for(var u=i[a],c=u.pos(),l=o(u.element()),f=0;a>f;f+=1){var d=i[f],_=o(d.element());r=h.sqrDist(c,d.pos());var v=l+_-.3,m=l+_+.3;m*m>r&&r>v*v&&t.connect(u,d)}n._ep(),null!==e&&(n.isAminoacid()&&e.isAminoacid()&&function(t,e,n){var r=e.atom("C"),i=n.atom("N");if(r&&i){var o=h.sqrDist(r.pos(),i.pos());1.6*1.6>o&&t.connect(i,r)}}(t,e,n),n.isNucleotide()&&e.isNucleotide()&&function(t,e,n){var r=e.atom("O3'"),i=n.atom("P");if(r&&i){var o=h.sqrDist(r.pos(),i.pos());1.7*1.7>o&&t.connect(r,i)}}(t,e,n)),e=n})}}),r.derive(u,s,{full:function(){return this._c5},assemblies:function(){return this._c5.assemblies()},addChain:function(t,e){var n=new f(this,t.full());if(this._j.push(n),e)for(var r=t.residues(),i=0;i<r.length;++i)n.addResidue(r[i],!0);return n},addAtom:function(t){var e=this.chain(t.residue().chain().name());return null===e&&(e=this.addChain(t.residue().chain())),e.addAtom(t)},removeAtom:function(t,e){if(null===t)return!1;var n=this.chain(t.residue().chain().name());if(null===n)return!1;var r=n.removeAtom(t,e);return r&&0===n.residues().length&&(this._j=this._j.filter(function(t){return t!==n})),r},containsResidue:function(t){if(!t)return!1;var e=this.chain(t.chain().name());return!!e&&e.containsResidue(t)},addResidues:function(t,e){var n=this,r={};return t.forEach(function(t){var i=t.chain().name();void 0===r[i]&&(r[i]=n.addChain(t.chain(),!1)),r[i].addResidue(t,e)}),r},chains:function(){return this._j},chain:function(t){for(var e=0;e<this._j.length;++e)if(this._j[e].name()===t)return this._j[e];return null}}),{MolView:u,Mol:a}}(M,F,N),I=function(t){function e(t,e){return t=Math.abs(t),e=Math.abs(e),t>e?t*Math.sqrt(1+e*e/t/t):0==e?t:e*Math.sqrt(1+t*t/e/e)}var n,r=Math.pow(2,-52),i=1e-64/r,o=0,s=0,a=0,u=0,h=0,c=t,l=c.length,f=c[0].length;if(f>l)throw"Need more rows than columns";var d=new Array(f),_=new Array(f);for(s=0;f>s;s++)d[s]=_[s]=0;for(var v=[],s=0;f>s;++s){var m=[];v.push([]);for(var a=0;f>a;++a)m.push(0);v.push(m)}var b=0,p=0,g=0,y=0,A=0,w=0,S=0;for(s=0;f>s;s++){for(d[s]=p,S=0,h=s+1,a=s;l>a;a++)S+=c[a][s]*c[a][s];if(i>=S)p=0;else for(b=c[s][s],p=Math.sqrt(S),b>=0&&(p=-p),g=b*p-S,c[s][s]=b-p,a=h;f>a;a++){for(S=0,u=s;l>u;u++)S+=c[u][s]*c[u][a];for(b=S/g,u=s;l>u;u++)c[u][a]+=b*c[u][s]}for(_[s]=p,S=0,a=h;f>a;a++)S+=c[s][a]*c[s][a];if(i>=S)p=0;else{for(b=c[s][s+1],p=Math.sqrt(S),b>=0&&(p=-p),g=b*p-S,c[s][s+1]=b-p,a=h;f>a;a++)d[a]=c[s][a]/g;for(a=h;l>a;a++){for(S=0,u=h;f>u;u++)S+=c[a][u]*c[s][u];for(u=h;f>u;u++)c[a][u]+=S*d[u]}}(A=Math.abs(_[s])+Math.abs(d[s]))>y&&(y=A)}for(s=f-1;-1!=s;s+=-1){if(0!=p){for(g=p*c[s][s+1],a=h;f>a;a++)v[a][s]=c[s][a]/g;for(a=h;f>a;a++){for(S=0,u=h;f>u;u++)S+=c[s][u]*v[u][a];for(u=h;f>u;u++)v[u][a]+=S*v[u][s]}}for(a=h;f>a;a++)v[s][a]=0,v[a][s]=0;v[s][s]=1,p=d[s],h=s}for(s=f-1;-1!=s;s+=-1){for(h=s+1,p=_[s],a=h;f>a;a++)c[s][a]=0;if(0!=p){for(g=c[s][s]*p,a=h;f>a;a++){for(S=0,u=h;l>u;u++)S+=c[u][s]*c[u][a];for(b=S/g,u=s;l>u;u++)c[u][a]+=b*c[u][s]}for(a=s;l>a;a++)c[a][s]=c[a][s]/p}else for(a=s;l>a;a++)c[a][s]=0;c[s][s]+=1}for(r*=y,u=f-1;-1!=u;u+=-1)for(var C=0;50>C;C++){var E=!1;for(h=u;-1!=h;h+=-1){if(Math.abs(d[h])<=r){E=!0;break}if(Math.abs(_[h-1])<=r)break}if(!E){o=0,S=1;var R=h-1;for(s=h;u+1>s&&(b=S*d[s],d[s]=o*d[s],!(Math.abs(b)<=r));s++)for(p=_[s],g=e(b,p),_[s]=g,o=p/g,S=-b/g,a=0;l>a;a++)A=c[a][R],w=c[a][s],c[a][R]=A*o+w*S,c[a][s]=-A*S+w*o}if(w=_[u],h==u){if(0>w)for(_[u]=-w,a=0;f>a;a++)v[a][u]=-v[a][u];break}if(C>=49)throw"Error: no convergence.";for(y=_[h],A=_[u-1],p=d[u-1],g=d[u],p=e(b=((A-w)*(A+w)+(p-g)*(p+g))/(2*g*A),1),b=0>b?((y-w)*(y+w)+g*(A/(b-p)-g))/y:((y-w)*(y+w)+g*(A/(b+p)-g))/y,o=1,S=1,s=h+1;u+1>s;s++){for(p=d[s],A=_[s],g=S*p,p*=o,w=e(b,g),d[s-1]=w,b=y*(o=b/w)+p*(S=g/w),p=-y*S+p*o,g=A*S,A*=o,a=0;f>a;a++)y=v[a][s-1],w=v[a][s],v[a][s-1]=y*o+w*S,v[a][s]=-y*S+w*o;for(w=e(b,g),_[s-1]=w,b=(o=b/w)*p+(S=g/w)*A,y=-S*p+o*A,a=0;l>a;a++)A=c[a][s-1],w=c[a][s],c[a][s-1]=A*o+w*S,c[a][s]=-A*S+w*o}d[h]=0,d[u]=b,_[u]=y}for(s=0;s<_.length;s++)_[s]<r&&(_[s]=0);for(s=0;f>s;s++)for(a=s-1;a>=0;a--)if(_[a]<_[s]){for(o=_[a],_[a]=_[s],_[s]=o,u=0;u<c.length;u++)n=c[u][s],c[u][s]=c[u][a],c[u][a]=n;for(u=0;u<v.length;u++)n=v[u][s],v[u][s]=v[u][a],v[u][a]=n;s=a}return{U:c,S:_,V:v}},D=function(){function e(t){if(null==t||"all"===t)return null;if("backbone"===t)return{CA:!0,C:!0,O:!0,N:!0};if(void 0!==t.substr){for(var e={},n=t.split(","),r=0;r<n.length;++r)e[n[r].trim()]=!0;return e}for(var e={},r=0;r<t.length;++r)e[t[r]]=!0;return e}function n(t,e,n,r,i){for(var o=t.atoms(),s=e.atoms(),a=0;a<o.length;++a){var u=o[a];if(null===i||!0===i[u.name()])for(var h=0;h<s.length;++h){var c=s[h];if(c.name()===u.name()){n.push(u),r.push(c);break}}}}function r(t,r,i,o){for(var s=t.full().createEmptyView(),a=r.full().createEmptyView(),u=Math.min(t.chains().length,r.chains().length),h=e(i),c=0;u>c;++c){var l=t.chains()[c],f=r.chains()[c],d=o(l,f),_=d[0],v=d[1];if(_.length!==v.length)return null;for(var m=s.addChain(l),b=a.addChain(f),p=0;p<_.length;++p){var g=_[p],y=v[p],A=[],w=[];if(n(g,y,A,w,h),0!==A.length)for(var S=m.addResidue(g),C=b.addResidue(y),E=0;E<A.length;++E)S.addAtom(A[E]),C.addAtom(w[E])}}return[s,a]}var i=t.vec3,o=t.mat3,s=(t.quat,function(t,e){if(i.set(e,0,0,0),0!==t.length){for(var n=0;n<t.length;++n){var r=t[n];i.add(e,e,r.pos())}i.scale(e,e,1/t.length)}}),a=function(){var t=i.create(),e=i.create();return function(n,r,o,s,a){a[0]=0,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=0,a[6]=0,a[7]=0,a[8]=0;for(var u=0;u<r.length;++u){i.sub(t,n[u].pos(),o),i.sub(e,r[u].pos(),s);var h=t,c=e;a[0]+=h[0]*c[0],a[1]+=h[0]*c[1],a[2]+=h[0]*c[2],a[3]+=h[1]*c[0],a[4]+=h[1]*c[1],a[5]+=h[1]*c[2],a[6]+=h[2]*c[0],a[7]+=h[2]*c[1],a[8]+=h[2]*c[2]}}}(),u=function(){var t=i.create(),e=i.create(),n=i.create(),r=o.create(),u=o.create(),h=o.create(),c=o.create(),l=o.create();return function(f,d){var _=f.atoms(),v=d.atoms();if(s(v,t),s(_,e),_.length!==v.length)return!1;if(_.length<3)return!1;a(_,v,e,t,u);var m=[[u[0],u[1],u[2]],[u[3],u[4],u[5]],[u[6],u[7],u[8]]],b=I(m);c[0]=b.U[0][0],c[1]=b.U[0][1],c[2]=b.U[0][2],c[3]=b.U[1][0],c[4]=b.U[1][1],c[5]=b.U[1][2],c[6]=b.U[2][0],c[7]=b.U[2][1],c[8]=b.U[2][2];var p=o.determinant(c);l[0]=b.V[0][0],l[1]=b.V[0][1],l[2]=b.V[0][2],l[3]=b.V[1][0],l[4]=b.V[1][1],l[5]=b.V[1][2],l[6]=b.V[2][0],l[7]=b.V[2][1],l[8]=b.V[2][2];var g=o.determinant(l);o.identity(h),0>p*g&&(h[8]=-1,o.mul(c,c,h)),o.mul(r,o.transpose(l,l),c);for(var y=f.full().atoms(),A=0;A<y.length;++A){var w=y[A];i.sub(n,w.pos(),e),i.transformMat3(n,n,r),i.add(n,t,n),w.setPos(n)}return!0}}();return{superpose:u,matchResiduesByNum:function(t,e,n){return r(t,e,n,function(t,e){for(var n=[],r=[],i=t.residues(),o=0;o<i.length;++o){var s=e.residueByRnum(i[o].num());null!==s&&(n.push(i[o]),r.push(s))}return[n,r]})},matchResiduesByIndex:function(t,e,n){return r(t,e,n,function(t,e){return[t.residues(),e.residues()]})},parseAtomNames:e,addAtomsPresentInBoth:n}}(),q=function(e){function n(t){for(var e=0;e<t.length();++e)t.residueAt(e).setSS(o(t,e)?"H":s(t,e)?"E":"C")}var r=t.vec3,i=function(){var t=r.create(),e=r.create();return function(n,i,o,s){for(var a=Math.max(0,i-2);i>=a;++a)for(var u=2;5>u;++u)if(!(a+u>=n.length())){var h=r.dist(n.posAt(t,a),n.posAt(e,a+u));if(Math.abs(h-o[u-2])>s)return!1}return!0}}(),o=function(t,e){return i(t,e,[5.45,5.18,6.37],2.1)},s=function(t,e){return i(t,e,[6.1,10.4,13],1.42)};return{Mol:q.Mol,MolView:q.MolView,assignHelixSheet:function(t){for(var e=t.chains(),r=0;r<e.length;++r){var i=e[r];i.eachBackboneTrace(n)}},superpose:e.superpose,matchResiduesByIndex:e.matchResiduesByIndex,matchResiduesByNum:e.matchResiduesByNum}}(D),P=function(e){function n(){this._O={},this._T=null}function r(t){if(" "!==t[0]){var e=t.trim();if(4===e.length){for(var n=0,r=e.charCodeAt(n);4>n&&(65>r||r>122||r>90&&97>r);)++n,r=e.charCodeAt(n);return e[n]}var i=e.charCodeAt(0);return i>=48&&57>=i?e[1]:e.substr(0,2)}return t[1]}function i(t){this._cl=[],this._b3=[],this._cy=[],this._b4={},this._i=new q.Mol,this._cR=new n,this._bl=null,this._bk=null,this._eq=null,this._={},this._.conectRecords=!!t.conectRecords}function o(t){return t.split(/\r\n|\r|\n/g)}function s(t,e){for(var n=e||{},r=o(t),s=new i(n),a=[],u=0;u<r.length;u++){var h=s.processLine(r[u]);if(h===s.ERROR)return null;if(h!==s.CONTINUE){var c=s.finish();if(null!==c&&a.push(c),h!==s.MODEL_COMPLETE||!n.loadAllModels)break}}var l=s.finish();return null!==l&&a.push(l),n.loadAllModels?a:a[0]}function a(){this._i=new q.Mol,this._cQ(),this._b5=!1}function u(t){for(var e=new a,n=o(t),r=0;r<n.length&&e.processLine(n[r]);r++);var i=e.finish();return i}function h(t,e){var n=new XMLHttpRequest;n.open("GET",t,!0),n.onload=function(){n.response&&e(n.response)},n.send(null)}var c=t.vec3,l=t.mat4;return n.prototype={assemblies:function(){var t=[];for(var e in this._O)this._O.hasOwnProperty(e)&&t.push(this._O[e]);return t},assembly:function(t){return this._O[t]},nextLine:function(t){if("B"===(t=t.substr(11))[0]&&"BIOMOLECULE:"===t.substr(0,12)){var n=t.substr(13).trim();return this._dr=new e.Assembly(n),void(this._O[n]=this._dr)}if("APPLY THE FOLLOWING TO CHAINS:"!==t.substr(0,30)&&"                   AND CHAINS:"!==t.substr(0,30)){if("  BIOMT"===t.substr(0,7)){for(var r=parseInt(t[7],10)-1,i=0;" "!==t[12+i];)i+=1;var o=parseFloat(t.substr(13+i,9)),s=parseFloat(t.substr(23+i,9)),a=parseFloat(t.substr(33+i,9)),u=parseFloat(t.substr(43+i,14));return this._bj[0+r]=o,this._bj[4+r]=s,this._bj[8+r]=a,this._bj[12+r]=u,void(2===r&&(this._cw.addMatrix(this._bj),this._bj=l.create()))}}else{var h=t.substr(30).split(",");"A"===t[0]&&(this._cw=new e.SymGenerator,this._dr.addGenerator(this._cw)),this._bj=l.create();for(var c=0;c<h.length;++c){var f=h[c].trim();f.length&&this._cw.addChain(f)}}}},i.prototype={CONTINUE:1,MODEL_COMPLETE:2,FILE_END:3,ERROR:4,parseHelixRecord:function(t){var e=parseInt(t.substr(21,4),10),n=" "===t[25]?"\0":t[25],r=parseInt(t.substr(33,4),10),i=" "===t[37]?"\0":t[37],o=t[19];return this._cl.push({first:[e,n],last:[r,i],chainName:o}),!0},parseSheetRecord:function(t){var e=parseInt(t.substr(22,4),10),n=" "===t[26]?"\0":t[26],r=parseInt(t.substr(33,4),10),i=" "===t[37]?"\0":t[37],o=t[21];return this._b3.push({first:[e,n],last:[r,i],chainName:o}),!0},parseAndAddAtom:function(t){var e=t[16];if(" "!==e&&"A"!==e)return!0;var n="H"===t[0],i=t[21],o=t.substr(17,3).trim(),s=t.substr(12,4),a=s.trim(),u=parseInt(t.substr(22,4),10);u!=u&&(u=1);var h=" "===t[26]?"\0":t[26],l=!1,f=!1;this._bl&&this._bl.name()===i||(f=!0,l=!0),this._bk&&this._bk.num()===u&&this._bk.insCode()===h||(l=!0),f&&(this._bl=this._i.chain(i)||this._i.addChain(i)),l&&(this._bk=this._bl.addResidue(o,u,h));for(var d=c.create(),_=0;3>_;++_)d[_]=parseFloat(t.substr(30+8*_,8));var v=t.substr(76,2).trim();""===v&&(v=r(s));var m=parseFloat(t.substr(54,6).trim()),b=parseFloat(t.substr(60,6).trim()),p=this._bk.addAtom(a,d,v,n,isNaN(m)?null:m,isNaN(b)?null:b);if(this._.conectRecords){var g=parseInt(t.substr(6,5).trim(),10);this._b4[g]=p}return!0},parseConectRecord:function(t){for(var e=parseInt(t.substr(6,5).trim(),10),n=[],r=0;4>r;++r){var i=parseInt(t.substr(11+5*r,6).trim(),10);isNaN(i)||i>e||n.push(i)}return this._cy.push({from:e,to:n}),!0},processLine:function(t){var e=t.substr(0,6);if("ATOM  "===e||"HETATM"===e)return this.parseAndAddAtom(t)?this.CONTINUE:this.ERROR;if("REMARK"===e){var n=t.substr(7,3);return"350"===n&&this._cR.nextLine(t),this.CONTINUE}return"HELIX "===e?this.parseHelixRecord(t)?this.CONTINUE:this.ERROR:"SHEET "===e?this.parseSheetRecord(t)?this.CONTINUE:this.ERROR:this._.conectRecords&&"CONECT"===e?this.parseConectRecord(t)?this.CONTINUE:this.ERROR:"END   "===e?this.FILE_END:"ENDMDL"===e?this.MODEL_COMPLETE:this.CONTINUE},finish:function(){if(null===this._bl)return null;var t,e=null;for(t=0;t<this._b3.length;++t){var n=this._b3[t];(e=this._i.chain(n.chainName))&&e.assignSS(n.first,n.last,"E")}for(t=0;t<this._cl.length;++t){var r=this._cl[t];(e=this._i.chain(r.chainName))&&e.assignSS(r.first,r.last,"H")}this._i.setAssemblies(this._cR.assemblies()),this._.conectRecords&&this._ex(this._i),this._i.deriveConnectivity();var i=this._i;return this._i=new q.Mol,this._bl=null,this._bk=null,this._eq=null,i},_ex:function(t){for(var e=0;e<this._cy.length;++e)for(var n=this._cy[e],r=this._b4[n.from],i=0;i<n.to.length;++i){var o=this._b4[n.to[i]];t.connect(r,o)}}},a.prototype={processLine:function(t){var e=this._9;if(3>e){if(0===e){var n=t.trim();if(0===n.length)return!1;this._cI=n}return this._b5=!1,this._9++,!0}if(3===e){if(this._cr=parseInt(t.substr(0,3).trim(),10),this._dn=parseInt(t.substr(3,3).trim(),10),isNaN(this._cr)||isNaN(this._dn))return!1;this._9++;var r=""+(this._i.chains().length+1);this._dq=this._i.addChain(r),this._cx=this._dq.addResidue(this._cI,1)}if(4===e){for(var i=[0,0,0],o=0;3>o;++o)if(i[o]=parseFloat(t.substr(10*o,10).trim()),isNaN(i[o]))return!1;var s=t.substr(31,3).trim();this._cx.addAtom(s,i,s,!1),this._dx++,this._dx===this._cr&&this._9++}if(5===e){var a=parseInt(t.substr(0,3).trim(),10)-1,u=parseInt(t.substr(3,3).trim(),10)-1;if(isNaN(a)||isNaN(u))return!1;var h=this._cx.atoms();this._i.connect(h[a],h[u]),this._dv++,this._dv===this._dn&&this._9++}return"M  END"===t.substr(0,6)&&(this._b5=!0,this._9++),"$$$$"===t.substr(0,4)&&this._cQ(),!0},_cQ:function(){this._9=0,this._cx=null,this._dq=null,this._cr=null,this._eL=null,this._dx=0,this._dv=0,this._cI=""},finish:function(){return this._b5?this._i:null}},{pdb:s,sdf:u,Remark350Reader:n,fetchPdb:function(t,e,n){h(t,function(t){var r=s(t,n);e(r)})},fetchSdf:function(t,e){h(t,function(t){var n=u(t);e(n)})},guessAtomElementFromName:r}}(E),V=function(){var e=t.vec3,n=t.mat3,r=function(){var t=e.create(),n=e.create();return function(r,i){e.set(t,0,0,0);var o=0;r.eachCentralAtom(function(n,r){e.add(t,t,r),o+=1}),0!==o&&(e.scale(t,t,1/o),i[0]=0,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=0,i[6]=0,i[7]=0,i[8]=0,r.eachCentralAtom(function(r,o){e.sub(n,o,t);var s=n[0],a=n[1],u=n[2];i[0]+=a*a+u*u,i[1]-=s*a,i[2]-=s*u,i[5]-=a*u,i[4]+=s*s+u*u,i[8]+=s*s+a*a}),i[3]=i[1],i[6]=i[2],i[7]=i[5])}}(),i=function(){var t=n.create(),i=n.create(),o=e.create(),s=e.create(),a=e.create(),u=e.create(),h=e.create(),c=e.create(),f=e.create();return function(d){r(d,t);var _=l.diagonalizer(t);n.fromQuat(i,_);var v=!0;d.eachCentralAtom(function(t,n){e.transformMat3(a,n,i),v?(e.copy(o,a),e.copy(s,a),v=!1):(e.min(o,o,a),e.max(s,s,a))}),e.sub(u,s,o);var m=[[u[0],0],[u[1],1],[u[2],2]];m.sort(function(t,e){return e[0]-t[0]});var b=m[0][1],p=m[1][1];e.set(h,i[b+0],i[b+3],i[b+6]),e.set(c,i[p+0],i[p+3],i[p+6]),e.cross(f,h,c);var g=n.create();return g[0]=h[0],g[1]=c[0],g[2]=f[0],g[3]=h[1],g[4]=c[1],g[5]=f[1],g[6]=h[2],g[7]=c[2],g[8]=f[2],g}}();return{principalAxes:i}}(),{Viewer:C.Viewer,isWebGLSupported:C.isWebGLSupported,io:P,color:e,mol:q,rgb:{setColorPalette:e.setColorPalette,hex2rgb:e.hex2rgb},vec3:t.vec3,vec4:t.vec4,mat3:t.mat3,mat4:t.mat4,quat:t.quat,viewpoint:V}})?r.apply(e,i):r)||(t.exports=o)},function(t,e,n){(t.exports=n(2)(!1)).push([t.i,"body {\n    font-family: Helvetica;\n    background-color: #fff;/*#f0f0f0;*/\n    font-weight: lighter;\n    margin: 0px;\n    width:100%;\n    height:100%x;\n  }\n\n  a {\n    color:#393;\n  }\n\n  #bio-pv-web {\n    position:fixed;\n    bottom:0px;\n    top:0px;\n    left:0px;\n    right:0px;\n  }\n\n  #inspector {\n    top:10px;\n    left:10px;\n    box-shadow: 2px 2px 5px #888888;\n    border-radius:8px;\n    position:absolute;\n    background-color:#fafafa;\n    padding:10px;\n    border-style:solid;\n    border-width:1px;\n    border-color:#ccc;\n    z-index: 10;\n  }\n\n  #inspector ul {\n    padding:0px;\n  }\n\n  #inspector ul li {\n    margin-left:5px;\n    margin-right:5px;\n    margin-bottom:5px;\n    list-style:none;\n    cursor: pointer;\n    color:#393\n  }\n\n  #inspector ul li:hover {\n    color:#994444;\n  }\n\n  #inspector h1 {\n    font-weight:normal;\n    font-size:12pt;\n  }",""])},function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var n=function(t,e){var n=t[1]||"",r=t[3];if(!r)return n;if(e&&"function"==typeof btoa){var i=(s=r,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),o=r.sources.map(function(t){return"/*# sourceURL="+r.sourceRoot+t+" */"});return[n].concat(o).concat([i]).join("\n")}var s;return[n].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+n+"}":n}).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var r={},i=0;i<this.length;i++){var o=this[i][0];null!=o&&(r[o]=!0)}for(i=0;i<t.length;i++){var s=t[i];null!=s[0]&&r[s[0]]||(n&&!s[2]?s[2]=n:n&&(s[2]="("+s[2]+") and ("+n+")"),e.push(s))}},e}},function(t,e,n){"use strict";n.r(e);var r={};function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.r(r),n.d(r,"set",function(){return St}),n.d(r,"resolve",function(){return Et});var o=new Map;function s(t){var e=o.get(t);return void 0===e&&(e=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),o.set(t,e)),e}function a(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.dispatchEvent(new CustomEvent(e,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){i(t,e,n[e])})}return t}({bubbles:!1},n)))}function u(t,e){var n=window.ShadyCSS;return n&&!n.nativeShadow?t(n):e}function h(t){var e=String(t.tagName).toLowerCase();return"<".concat(e,">")}var c="ActiveXObject"in window,l=Promise.resolve();function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var d=function(t){return t},_=function(t){if("object"!==f(t))throw TypeError("Assigned value must be an object: ".concat("undefined"==typeof v?"undefined":f(v)));return t&&Object.freeze(t)};function m(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function b(t){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var p=new WeakMap,g=new WeakMap,y=[],A=0,w=0,S=1e3/60;function C(){try{var t=1;w=performance.now();for(var e=function(){var e=y[A];if(p.has(e)){var n=p.get(e),r=g.get(e),i=e[n];if(i!==r&&(g.set(e,i),i(),u(r?function(t){return t.styleSubtree(e)}:function(t){return t.styleElement(e)})),A%t==0){if(A+1<y.length&&performance.now()-w>S)throw y;t*=2}}};A<y.length;A+=1)e();y=[],A=0,l.then(function(){w=0})}catch(t){if(A+=1,requestAnimationFrame(C),l.then(function(){w=0}),t!==y)throw t}}function E(t){if(t.target===t.currentTarget&&p.has(t.target)){if(w)y.length||(performance.now()-w>S?requestAnimationFrame(C):l.then(C));else{if(y.length)return void y.splice(A,0,t.target);requestAnimationFrame(C)}y.push(t.target)}}function R(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("function"!=typeof t)throw TypeError("The first argument must be a function: ".concat(b(t)));var n=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){m(t,e,n[e])})}return t}({shadowRoot:!0},e);return{get:function(e){var r=t(e);return function(){return r(e,n.shadowRoot?e.shadowRoot:e)}},connect:function(t,e){if(p.has(t))throw Error("Render factory already used in '".concat(p.get(t),"' key"));if(n.shadowRoot&&!t.shadowRoot){var r={mode:"open"};"object"===b(n.shadowRoot)&&Object.assign(r,n.shadowRoot),t.attachShadow(r)}return t.addEventListener("@invalidate",E),p.set(t,e),function(){t.removeEventListener("@invalidate",E),p.delete(t)}}}}var x=new WeakMap;function T(t,e){var n=x.get(t);n||(n=new Map,x.set(t,n));var r=n.get(e);return r||(r={target:t,key:e,value:void 0,deps:new Set,state:1,checksum:0},n.set(e,r)),r}function M(t){var e=t.state,n=t.deps,r=e;return n.forEach(function(t){t.target[t.key],r+=t.state}),r}var F=null;function N(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function I(t,e){return!e||"object"!==O(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function D(t){var e="function"==typeof Map?new Map:void 0;return(D=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return P(t,arguments,L(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),V(r,t)})(t)}function P(t,e,n){return(P=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&V(i,n.prototype),i}).apply(null,arguments)}function V(t,e){return(V=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function L(t){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function O(t){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var k=new Set;function B(t){k.size||l.then(function(){k.forEach(function(t){return a(t,"@invalidate",{bubbles:!0})}),k.clear()}),k.add(t)}var q=function(t,e){return e};function j(t,e){t.hybrids=e,t.connects=[],Object.keys(e).forEach(function(n){var r,i=e[n],o=O(i);r="function"===o?"render"===n?R(i):{get:i}:null!==i&&"object"===o&&("object"!==o||i.get||i.set||i.connect)?{get:i.get||q,set:i.set||!i.get&&q||void 0,connect:i.connect}:function(t,e){var n=f(t),r=d;switch(n){case"string":r=String;break;case"number":r=Number;break;case"boolean":r=Boolean;break;case"function":t=(r=t)();break;case"object":t&&Object.freeze(t),r=_}return{get:function(e){return arguments.length>1&&void 0!==arguments[1]?arguments[1]:t},set:function(t,e,n){return r(e,n)},connect:"object"!==n&&"undefined"!==n?function(n,r,i){if(n[r]===t){var o=s(r);if(n.hasAttribute(o)){var a=n.getAttribute(o);n[r]=""===a||a}}return e&&e(n,r,i)}:e}}(i),Object.defineProperty(t.prototype,n,{get:function(){return function(t,e,n){var r=T(t,e);if(F===r)throw F=null,Error("Circular '".concat(e,"' get invocation in '").concat(h(t),"'"));F&&F.deps.add(r);var i=F;if(F=r,r.checksum&&r.checksum===M(r))return F=i,r.value;r.deps.size&&r.deps.clear();try{var o=n(t,r.value);o!==r.value&&(r.state+=1,r.value=o),r.checksum=M(r),F=i}catch(t){throw F=null,t}return r.value}(this,n,r.get)},set:r.set&&function(t){var e=this;!function(t,e,n,r,i){if(F)throw F=null,Error("Try to set '".concat(e,"' of '").concat(h(t),"' in get call"));var o=T(t,e),s=n(t,r,o.value);s!==o.value&&(o.state+=1,o.value=s,i())}(this,n,r.set,t,function(){return B(e)})},enumerable:!0,configurable:!1}),r.connect&&t.connects.push(function(t){return r.connect(t,n,function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&function(t,e,n){if(F)throw F=null,Error("Try to invalidate '".concat(e,"' in '").concat(h(t),"' get call"));var r=T(t,e);r.checksum=0,n&&(r.value=void 0)}(t,n),B(t)})})})}var U=new WeakMap;function z(t,e){var n=O(e);if("object"!==n&&"function"!==n)throw TypeError("Second argument must be an object or a function: ".concat(n));var r=window.customElements.get(t);if("function"===n)return r!==e?window.customElements.define(t,e):r;if(r){if(r.hybrids===e)return r;throw Error("Element '".concat(t,"' already defined"))}var i=function(e){function n(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),I(this,L(n).apply(this,arguments))}var r,i,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&V(t,e)}(n,D(HTMLElement)),r=n,o=[{key:"name",get:function(){return t}}],(i=[{key:"connectedCallback",value:function(){var t=this,e=this.constructor.connects.reduce(function(e,n){var r=n(t);return r&&e.add(r),e},new Set);U.set(this,e),B(this)}},{key:"disconnectedCallback",value:function(){U.get(this).forEach(function(t){return t()})}}])&&N(r.prototype,i),o&&N(r,o),n}();return j(i,e),customElements.define(t,i),i}function W(t){return Object.keys(t).reduce(function(e,n){var r=s(n.replace(/((?!([A-Z]{2}|^))[A-Z])/g,"-$1"));return e[n]=z(r,t[n]),e},{})}function H(){return"object"===O(arguments.length<=0?void 0:arguments[0])?W(arguments.length<=0?void 0:arguments[0]):z.apply(void 0,arguments)}var G=new WeakMap,X={get:function(t,e){return G.has(t)?G.get(t):(void 0!==e&&G.set(t,e),e)},set:function(t,e){return G.set(t,e),e}};function Y(t){for(var e;t&&(e=X.get(t))&&e.endNode;)t=e.endNode;return t}function K(t){var e=X.get(t),n=e.startNode;if(n)for(var r=n,i=Y(e.endNode).nextSibling;r;){var o=r.nextSibling;r.parentNode.removeChild(r),r=o!==i&&o}}var Q=new WeakMap;function J(t,e,n){var r=Q.get(e),i=n.map(function(t,e){return{id:Object.prototype.hasOwnProperty.call(t,"id")?t.id:e,value:t,placeholder:null,available:!0}});if(Q.set(e,i),r){var o=new Set;i.forEach(function(t){return o.add(t.id)}),r=r.filter(function(t){return!!o.has(t.id)||(K(t.placeholder),t.placeholder.parentNode.removeChild(t.placeholder),!1)})}var s=e,a=n.length-1,u=X.get(e);i.forEach(function(e,n){var i,o;if(r)for(var h=0;h<r.length;h+=1)if(r[h].available&&r[h].id===e.id){i=r[h];break}i?(i.available=!1,(o=i.placeholder).previousSibling!==s&&function(t,e){var n=X.get(t),r=n.startNode,i=Y(n.endNode);e.parentNode.insertBefore(t,e.nextSibling);for(var o=t,s=r;s;){var a=s.nextSibling;o.parentNode.insertBefore(s,o.nextSibling),o=s,s=a!==i.nextSibling&&a}}(o,s),i.value!==e.value&&Z(t,o,e.value)):(o=document.createTextNode(""),s.parentNode.insertBefore(o,s.nextSibling),Z(t,o,e.value)),s=Y(X.get(o).endNode||o),0===n&&(u.startNode=o),n===a&&(u.endNode=s),e.placeholder=o}),r&&r.forEach(function(t){t.available&&(K(t.placeholder),t.placeholder.parentNode.removeChild(t.placeholder))})}function $(t){return($="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Z(t,e,n){var r=Array.isArray(n)?"array":$(n),i=X.get(e,{});switch(i.type!==r&&(K(e),"array"===r&&Q.delete(e),i=X.set(e,{type:r}),""!==e.textContent&&(e.textContent="")),r){case"function":n(t,e);break;case"array":J(t,e,n);break;default:e.textContent="number"===r||n?n:""}}function tt(t){return(tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var et=new WeakMap;function nt(t){return(nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var rt=new WeakMap;function it(t,e,n){var r=rt.get(e)||new Set,i=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;return Array.isArray(t)?t.forEach(function(t){return e.add(t)}):null!==t&&"object"===nt(t)?Object.keys(t).forEach(function(n){return t[n]&&e.add(n)}):e.add(t),e}(n);rt.set(e,i),i.forEach(function(t){e.classList.add(t),r.delete(t)}),r.forEach(function(t){e.classList.remove(t)})}function ot(t){return(ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var st=new WeakMap;function at(t,e,n){if(null===n||"object"!==ot(n))throw TypeError("Style value must be an object in ".concat(h(e),":"),n);var r=st.get(e)||new Map,i=Object.keys(n).reduce(function(t,i){var o=s(i),a=n[i];return a||0===a?e.style.setProperty(o,a):e.style.removeProperty(o),t.set(o,a),r.delete(o),t},new Map);r.forEach(function(t,n){e.style[n]=""}),st.set(e,i)}function ut(t,e,n){if("on"===e.substr(0,2))return function(t){return function(e,n,r,i){if(i&&n.removeEventListener(t,et.get(i),void 0!==i.options&&i.options),r){if("function"!=typeof r)throw Error("Event listener must be a function: ".concat(tt(r)));et.set(r,r.bind(null,e)),n.addEventListener(t,et.get(r),void 0!==r.options&&r.options)}}}(e.substr(2));switch(t){case"class":return it;case"style":return at;default:return function(r,i,o){if(n||i instanceof SVGElement||!(e in i))if(!1===o||null==o)i.removeAttribute(t);else{var s=!0===o?"":String(o);i.setAttribute(t,s)}else i[e]!==o&&(i[e]=o)}}}function ht(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ct(t){return(ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var lt=Date.now(),ft=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return"{{h-".concat(lt,"-").concat(t,"}}")},dt=ft("(\\d+)"),_t=new RegExp("^".concat(dt,"$")),vt=new RegExp(dt,"g"),mt="--".concat(lt,"--"),bt=new RegExp(mt,"g"),pt=new WeakMap;var gt="object"===ct(window.ShadyDOM)&&window.ShadyDOM.inUse?function(t){var e;return{get currentNode(){return e},nextNode:function(){return!!(e=void 0===e?t.childNodes[0]:e.childNodes.length?e.childNodes[0]:e.nextSibling?e.nextSibling:e.parentNode.nextSibling)}}}:function(t){return document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,null,!1)},yt=document.createElement("div");function At(t,e,n){var r=document.createElement("template"),i=[],o=function(t,e){var n=t.reduce(function(e,n,r){return 0===r?n:t.slice(r).join("").match(/^\s*<\/\s*(table|tr|thead|tbody|tfoot|colgroup)>/)?"".concat(e,"\x3c!--").concat(ft(r-1),"--\x3e").concat(n):e+ft(r-1)+n},"");return e&&(n+="<style>\n".concat(e.join("\n/*------*/\n"),"\n</style>")),c?n.replace(/style\s*=\s*(["][^"]+["]|['][^']+[']|[^\s"'<>\/]+)/g,function(t){return"".concat(mt).concat(t)}):n}(t,n);if(e&&(o="<svg>".concat(o,"</svg>")),c?r.innerHTML=o:(yt.innerHTML="<template>".concat(o,"</template>"),r.content.appendChild(yt.children[0].content)),e){var s=r.content.firstChild;r.content.removeChild(s),Array.from(s.childNodes).forEach(function(t){return r.content.appendChild(t)})}!function(t){for(var e,n=document.createNodeIterator(t,NodeFilter.SHOW_COMMENT,null,!1);e=n.nextNode();)_t.test(e.textContent)&&(e.parentNode.insertBefore(document.createTextNode(e.textContent),e),e.parentNode.removeChild(e))}(r.content);for(var a=gt(r.content),h=0,l=function(){var n=a.currentNode;if(n.nodeType===Node.TEXT_NODE){var r=n.textContent;if(!r.match(_t)){var o=r.match(vt);if(o){var s=n;o.reduce(function(t,e){var n=ht(t.pop().split(e),2),r=n[0],i=n[1];return r&&t.push(r),t.push(e),i&&t.push(i),t},[r]).forEach(function(t,e){0===e?s.textContent=t:s=s.parentNode.insertBefore(document.createTextNode(t),s.nextSibling)})}}var u=n.textContent.match(_t);u&&(c||(n.textContent=""),i[u[1]]=[h,Z])}else n.nodeType===Node.ELEMENT_NODE&&Array.from(n.attributes).forEach(function(r){var o=r.value.trim(),s=c?r.name.replace(mt,""):r.name,a=o.match(_t);if(a){var u=t[a[1]].replace(/\s*=\s*['"]*$/g,"").split(" ").pop();i[a[1]]=[h,ut(s,u,e)],n.removeAttribute(r.name)}else{var l=o.match(vt);if(l){var f="attr__".concat(s);l.forEach(function(t,e){var n=ht(t.match(_t),2)[1];i[n]=[h,function(n,r,i){var a=X.get(r,{});a[f]=(a[f]||o).replace(t,null==i?"":i),1!==l.length&&e+1!==l.length||(r.setAttribute(s,a[f]),a[f]=void 0)}]}),r.value="",c&&s!==r.name&&(n.removeAttribute(r.name),n.setAttribute(s,""))}}});h+=1};a.nextNode();)l();return function(t,e,n){var o=X.get(e,{type:"function"});if(r!==o.template){o.template&&K(e);var s=document.importNode(function(t,e){return e?u(function(n){var r=pt.get(t);r||(r=new Map,pt.set(t,r));var i=r.get(e);if(!i){(i=document.createElement("template")).content.appendChild(t.content.cloneNode(!0)),r.set(e,i);var o=i.content.querySelectorAll("style");Array.from(o).forEach(function(t){for(var e=t.childNodes.length+1,n=0;n<e;n+=1)t.parentNode.insertBefore(document.createTextNode(ft()),t)}),n.prepareTemplate(i,e.toLowerCase())}return i},t):t}(r,t.tagName).content,!0),a=gt(s),h=i.slice(0),l=0,f=h.shift(),d=[];for(Object.assign(o,{template:r,markers:d});a.nextNode();){var _=a.currentNode;for(_.nodeType===Node.TEXT_NODE&&(_t.test(_.textContent)?_.textContent="":c&&(_.textContent=_.textContent.replace(bt,"")));f&&f[0]===l;)d.push([_,f[1]]),f=h.shift();l+=1}if(o.startNode=s.childNodes[0],o.endNode=s.childNodes[s.childNodes.length-1],e.nodeType===Node.TEXT_NODE)for(var v=e,m=s.childNodes[0];m;)e.parentNode.insertBefore(m,v.nextSibling),v=m,m=s.childNodes[0];else e.appendChild(s)}o.markers.forEach(function(e,r){var i=ht(e,2),s=i[0],a=i[1];o.lastArgs&&o.lastArgs[r]===n[r]||a(t,s,n[r],o.lastArgs?o.lastArgs[r]:void 0)}),o.lastArgs=n}}var wt=new Map;function St(t,e){if(!t)throw Error("Target property name missing: ".concat(t));if(2===arguments.length)return function(n){n[t]=e};var n=wt.get(t);return n||(n=function(e,n){var r=n.target;e[t]=r.value},wt.set(t,n)),n}var Ct=new WeakMap;function Et(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;return function(r,i){var o;e&&(o=setTimeout(function(){o=void 0,requestAnimationFrame(function(){e(r,i)})},n)),Ct.set(i,t),t.then(function(e){o&&clearTimeout(o),Ct.get(i)===t&&(e(r,i),Ct.set(i,null))})}}var Rt=ft(),xt=new Map,Tt=new WeakMap,Mt={define:function(t){return H(t),this},key:function(t){return this.id=t,this},style:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Tt.set(this,e),this}};function Ft(t,e,n){return Object.assign(function r(i){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i,s=Tt.get(r),a=t.join(Rt);s&&(a+=s.join(Rt)),n&&(a+=ft("svg"));var u=xt.get(a);u||(u=At(t,n,s),xt.set(a,u)),u(i,o,e)},Mt)}Object.assign(function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Ft(t,n)},r),Object.assign(function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Ft(t,n,!0)},r);var Nt=n(1),It=n.n(Nt),Dt=n(0),Pt=n.n(Dt);function Vt(){var t;document.getElementById("ProteinViewerStyle")||document.head.appendChild(((t=document.createElement("style")).setAttribute("id","ProteinViewerStyle"),t.setAttribute("type","text/css"),t.innerHTML=It.a.toString(),t))}n.d(e,"ProteinViewer",function(){return Lt});var Lt={init:{get:function(t,e){return e},set:function(){},connect:function(t,e){var n,r=Pt.a.Viewer(document.getElementById("bio-pv-web"),{quality:t.getAttribute("quality"),width:"auto",height:"auto",antialias:!!t.getAttribute("antialias"),outline:"true"===t.getAttribute("outline"),animateTime:t.getAttribute("animateTime"),background:t.getAttribute("background-color"),fov:t.getAttribute("fov")}),i=t.getAttribute("structureStyle");window.onresize=function(t){r.fitParent()},document.getElementById("cartoon").onclick=function(){r.clear(),r.cartoon("structure",n,{color:Pt.a.color.ssSuccession()})},document.getElementById("line-trace").onclick=function(){r.clear(),r.lineTrace("structure",n)},document.getElementById("preset").onclick=function(){r.clear();var t=n.select({rnames:["RVP","SAH"]});r.ballsAndSticks("ligand",t),r.cartoon("protein",n)},document.getElementById("lines").onclick=function(){r.clear(),r.lines("structure",n)},document.getElementById("trace").onclick=function(){r.clear(),r.trace("structure",n)},document.getElementById("sline").onclick=function(){r.clear(),r.sline("structure",n)},document.getElementById("tube").onclick=function(){r.clear(),r.tube("structure",n)},document.addEventListener("DOMContentLoaded",function(){!function(e){document.getElementById("status").innerHTML="loading "+e;var o=new XMLHttpRequest;o.open("GET","./"+e+".pdb"),o.setRequestHeader("Content-type","application/x-pdb"),o.onreadystatechange=function(){4==o.readyState&&(n=Pt.a.io.pdb(o.responseText),"cartoon"===i?r.renderAs("structure",n,t.getAttribute("structureStyle"),{color:Pt.a.color.ssSuccession()}):r.renderAs("structure",n,t.getAttribute("structureStyle")),r.centerOn(n)),document.getElementById("status").innerHTML=""},o.send()}("1r6a")}),Vt()}}};H("bio-pv-web",Lt)}]);