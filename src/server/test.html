<!DOCTYPE html>
<html>
<head>
    <style>
        canvas {
            position: absolute;
            top: 0;
            left: 0;
        }
    </style>
</head>
<body>
<img id="img" src="./static/images/original.png"
     width="400" style="height: auto">
<canvas id="highlightCanvas" width="400" style="height: auto"></canvas>
<script>
    window.onmousemove = function (e) {
        console.log("mouse location:", e.clientX, e.clientY)
    };
    var img = document.getElementById('originalImg');
    var canvas = document.getElementById('highlightCanvas');
    var ctx = canvas.getContext('2d');

    const localisation = function () {
        const _createImage = (src) => {
            const image = new Image(400, 400);
            image.src = src;
            return image;
        };
        return {
            highlightData: {
                mithochondria: {
                    image: _createImage('./static/images/mithochondria.png'),
                    polygon: [
                        [
                            [153,117],
                            [168,109],
                            [179,112],
                            [164,131],
                            [138,137],
                            [135,126]
                        ],
                        [
                            [184,239],
                            [204,239],
                            [208,247],
                            [186,258],
                            [162,248],
                            [164,233]
                        ],
                        [
                            [220,266],
                            [246,264],
                            [249,281],
                            [228,289],
                            [201,287],
                            [204,269]
                        ]
                    ]
                },
                nucleus: {
                    image: _createImage('./static/images/nucleus.png'),
                    polygon: [
                       [
                           [198,106],
                           [218, 76],
                           [260,75],
                           [298,105],
                           [296,165],
                           [244,203],
                           [190,188],
                           [172,139]
                       ]
                    ]
                },
                cytoplasm: {
                    image: _createImage('./static/images/cytoplasm.png'),
                    polygon: [
                        [
                            [128,117],
                            [227,58],
                            [279,58],
                            [349,115],
                            [378,207],
                            [331,317],
                            [214,371],
                            [134,357],
                            [63,285],
                            [36,189],
                            [72,138]
                        ]
                    ]
                },
                original: {
                    image: _createImage('./static/images/original.png'),
                    polygon: [
                        [[0,0],
                        [400,0],
                        [500,400],
                        [0,400]]
                    ]
                },
            },
            isInside: function inside(point, vsArray) {
                for (const vs of vsArray) {
                    // ray-casting algorithm based on
                    // https://wrf.ecse.rpi.edu/Research/Short_Notes/pnpoly.html

                    const x = point[0], y = point[1];

                    let inside = false;
                    for (let i = 0, j = vs.length - 1; i < vs.length; j = i++) {
                        let xi = vs[i][0], yi = vs[i][1];
                        let xj = vs[j][0], yj = vs[j][1];

                        let intersect = ((yi > y) != (yj > y))
                            && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
                        if (intersect) inside = !inside;
                    }

                    if (inside)
                        return true;
                }
                return false;
            }
        }
    }

    const localisationManager = localisation();

    canvas.addEventListener('mousemove', function (event) {
        const rect = canvas.getBoundingClientRect();
        const x = event.clientX - rect.left;
        const y = event.clientY - rect.top;
        for (const key in localisationManager.highlightData) {
            const data = localisationManager.highlightData[key];
            if (localisationManager.isInside([x, y], data.polygon)) {
                document.getElementById('img').src = data.image.src;
                return;
            }
        }
    });

    canvas.addEventListener('mouseout', function () {
        document.getElementById('img').src = localisationManager.highlightData.original.image.src;
    });
</script>
</body>
</html>
